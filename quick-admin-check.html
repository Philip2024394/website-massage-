<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üöÄ Quick Admin Approval Check</title>
    <script src="https://cdn.jsdelivr.net/npm/appwrite@15.0.0"></script>
    <style>
        body {
            font-family: system-ui, -apple-system, sans-serif;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            padding: 30px;
            border-radius: 20px;
        }
        .button {
            background: #ff6b6b;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 50px;
            font-weight: bold;
            cursor: pointer;
            margin: 10px;
        }
        .results {
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
        }
        .success { color: #4caf50; }
        .error { color: #f44336; }
        .warning { color: #ff9800; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöÄ Quick Admin Approval Check</h1>
        
        <button class="button" onclick="quickCheck()">‚ö° Quick Check Therapist Status</button>
        <button class="button" onclick="fixAdminApproval()">‚úÖ Fix Admin Approval (Set isLive = true)</button>

        <div id="results" class="results" style="display: none;"></div>
    </div>

    <script>
        const client = new Appwrite.Client()
            .setEndpoint('https://syd.cloud.appwrite.io/v1')
            .setProject('68f23b11000d25eb3664');

        const databases = new Appwrite.Databases(client);

        function log(message, type = 'info') {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = type;
            div.textContent = message;
            results.appendChild(div);
            results.style.display = 'block';
        }

        function clear() {
            document.getElementById('results').innerHTML = '';
        }

        async function quickCheck() {
            clear();
            log('üîç QUICK THERAPIST CHECK...', 'info');
            
            try {
                const response = await databases.listDocuments(
                    '68f76ee1000e64ca8d05',
                    'therapists_collection_id',
                    []
                );
                
                if (response.documents.length === 0) {
                    log('‚ùå No therapists found!', 'error');
                    return;
                }
                
                log(`‚úÖ Found ${response.documents.length} therapists`, 'success');
                log('', 'info');
                
                // Check first few therapists
                const therapists = response.documents.slice(0, 5);
                
                therapists.forEach((t, index) => {
                    const name = t.name || `Therapist ${index + 1}`;
                    const isLive = t.isLive;
                    const status = t.status;
                    const isOnline = t.isOnline;
                    
                    log(`üë§ ${name}:`, 'info');
                    log(`   isLive: ${isLive} ${isLive ? '‚úÖ' : '‚ùå BLOCKED!'}`, isLive ? 'success' : 'error');
                    log(`   status: ${status || 'undefined'}`, 'info');
                    log(`   isOnline: ${isOnline || 'undefined'}`, 'info');
                    log(`   ID: ${t.$id}`, 'info');
                    log('', 'info');
                });
                
                const blockedCount = therapists.filter(t => !t.isLive).length;
                
                if (blockedCount > 0) {
                    log('üö® PROBLEM FOUND!', 'error');
                    log(`${blockedCount} therapists have isLive = false`, 'error');
                    log('This blocks status updates!', 'error');
                    log('', 'info');
                    log('üí° SOLUTION: Click "Fix Admin Approval" button', 'warning');
                } else {
                    log('üéâ All therapists are approved (isLive = true)', 'success');
                    log('Admin approval is not the issue.', 'info');
                }
                
            } catch (error) {
                log('‚ùå Error: ' + error.message, 'error');
            }
        }

        async function fixAdminApproval() {
            clear();
            log('üîß FIXING ADMIN APPROVAL...', 'info');
            log('Setting all therapists to isLive = true', 'info');
            log('', 'info');
            
            try {
                const response = await databases.listDocuments(
                    '68f76ee1000e64ca8d05',
                    'therapists_collection_id',
                    []
                );
                
                const therapists = response.documents;
                log(`üìä Processing ${therapists.length} therapists...`, 'info');
                log('', 'info');
                
                for (const therapist of therapists) {
                    const name = therapist.name || therapist.$id;
                    
                    if (!therapist.isLive) {
                        log(`üîß Activating: ${name}`, 'warning');
                        
                        try {
                            await databases.updateDocument(
                                '68f76ee1000e64ca8d05',
                                'therapists_collection_id',
                                therapist.$id,
                                { isLive: true }
                            );
                            log(`‚úÖ ${name} - ACTIVATED!`, 'success');
                        } catch (updateError) {
                            log(`‚ùå ${name} - FAILED: ${updateError.message}`, 'error');
                        }
                    } else {
                        log(`‚úÖ ${name} - Already active`, 'success');
                    }
                }
                
                log('', 'info');
                log('üéâ ADMIN APPROVAL FIX COMPLETE!', 'success');
                log('All therapists should now be able to update their status!', 'success');
                log('', 'info');
                log('üß™ TEST: Try changing therapist status now!', 'warning');
                
            } catch (error) {
                log('‚ùå Fix failed: ' + error.message, 'error');
            }
        }

        // Auto-run quick check on load
        window.addEventListener('load', quickCheck);
    </script>
</body>
</html>