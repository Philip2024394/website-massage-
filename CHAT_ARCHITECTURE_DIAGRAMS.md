# Chat System Architecture & Flow

## System Architecture Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          CHAT SYSTEM ARCHITECTURE                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     ADMIN DASHBOARD       â”‚              â”‚    MEMBER DASHBOARDS      â”‚
â”‚  (AdminDashboardPage)     â”‚              â”‚  (Therapist/Place/Hotel)  â”‚
â”‚                           â”‚              â”‚                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚              â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Navigation Drawer  â”‚  â”‚              â”‚  â”‚   Fixed Chat Button â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚              â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚  â”‚  â”‚ â—‹ Analytics   â”‚  â”‚  â”‚              â”‚  â”‚   â”‚ ğŸ’¬ Messages â”‚   â”‚  â”‚
â”‚  â”‚  â”‚ â—‹ Therapists  â”‚  â”‚  â”‚              â”‚  â”‚   â”‚   Badge: 3  â”‚   â”‚  â”‚
â”‚  â”‚  â”‚ â—‹ Places      â”‚  â”‚  â”‚              â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚  â”‚  â”‚ â— Messages â—„â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”€â”€â”€â”        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”‚  â”‚ â—‹ Payments    â”‚  â”‚  â”‚     â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚     â”‚                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚     â”‚                    â”‚
â”‚            â”‚               â”‚     â”‚                    â”‚ onClick()
â”‚            â”‚ Route         â”‚     â”‚                    â–¼
â”‚            â–¼               â”‚     â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚     â”‚        â”‚   MemberChatWindow.tsx    â”‚
â”‚  â”‚ AdminChatListPage   â”‚â—„â”€â”˜     â”‚        â”‚   (Modal Popup)           â”‚
â”‚  â”‚  .tsx               â”‚        â”‚        â”‚                           â”‚
â”‚  â”‚                     â”‚        â”‚        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚        â”‚        â”‚  â”‚  Chat with Admin    â”‚  â”‚
â”‚  â”‚ â”‚  Chat List      â”‚ â”‚        â”‚        â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚ â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚        â”‚        â”‚  â”‚ Messages...         â”‚  â”‚
â”‚  â”‚ â”‚  â”‚ Therapist â”‚  â”‚ â”‚        â”‚        â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚ â”‚  â”‚ Place     â”‚  â”‚ â”‚        â”‚        â”‚  â”‚ â”‚ Admin: Hello!   â”‚ â”‚  â”‚
â”‚  â”‚ â”‚  â”‚ Hotel     â”‚  â”‚ â”‚        â”‚        â”‚  â”‚ â”‚ You: Hi there   â”‚ â”‚  â”‚
â”‚  â”‚ â”‚  â”‚ User      â”‚  â”‚ â”‚        â”‚        â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â”‚ â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚        â”‚        â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚        â”‚        â”‚  â”‚ [ğŸ˜Š][ğŸ“][ğŸ“] Input â”‚  â”‚
â”‚  â”‚                     â”‚        â”‚        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚        â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚  â”‚ â”‚  Chat Window    â”‚ â”‚        â”‚
â”‚  â”‚ â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚        â”‚
â”‚  â”‚ â”‚  â”‚ Messages  â”‚  â”‚ â”‚        â”‚
â”‚  â”‚ â”‚  â”‚ [ğŸ˜Š][ğŸ“] â”‚  â”‚ â”‚        â”‚
â”‚  â”‚ â”‚  â”‚ [ğŸ“][ğŸš«] â”‚  â”‚ â”‚        â”‚
â”‚  â”‚ â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚        â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
            â”‚                      â”‚
            â”‚ Calls                â”‚ Calls
            â–¼                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          VALIDATION LAYER                                 â”‚
â”‚                      (chatValidation.ts)                                  â”‚
â”‚                                                                           â”‚
â”‚  Admin Message? â”€â”€YESâ”€â”€> âœ… ALLOW (No Validation)                        â”‚
â”‚        â”‚                                                                  â”‚
â”‚       NO                                                                  â”‚
â”‚        â–¼                                                                  â”‚
â”‚  Check: containsPhoneDigits() â”€â”€YESâ”€â”€> âŒ BLOCK "Cannot share phones"   â”‚
â”‚        â”‚                                                                  â”‚
â”‚       NO                                                                  â”‚
â”‚        â–¼                                                                  â”‚
â”‚  Check: containsNumberWords() â”€â”€YESâ”€â”€> âŒ BLOCK "Cannot use number words"â”‚
â”‚        â”‚                                                                  â”‚
â”‚       NO                                                                  â”‚
â”‚        â–¼                                                                  â”‚
â”‚  Check: containsPhonePattern() â”€â”€YESâ”€â”€> âŒ BLOCK "Cannot share contacts" â”‚
â”‚        â”‚                                                                  â”‚
â”‚       NO                                                                  â”‚
â”‚        â–¼                                                                  â”‚
â”‚  Check: containsAlternativeNumbers() â”€â”€YESâ”€â”€> âŒ BLOCK "Invalid format"  â”‚
â”‚        â”‚                                                                  â”‚
â”‚       NO                                                                  â”‚
â”‚        â–¼                                                                  â”‚
â”‚  âœ… ALLOW MESSAGE                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â”‚ If Valid
            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        APPWRITE DATABASE                                  â”‚
â”‚                                                                           â”‚
â”‚  Collection: chat_messages                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Message {                                                            â”‚ â”‚
â”‚  â”‚   senderId: "user123"                                                â”‚ â”‚
â”‚  â”‚   senderName: "John Doe"                                             â”‚ â”‚
â”‚  â”‚   senderType: "therapist"                                            â”‚ â”‚
â”‚  â”‚   recipientId: "admin"                                               â”‚ â”‚
â”‚  â”‚   message: "Hello, I need help"                                      â”‚ â”‚
â”‚  â”‚   timestamp: "2025-01-15T10:30:00Z"                                  â”‚ â”‚
â”‚  â”‚   read: false                                                        â”‚ â”‚
â”‚  â”‚   messageType: "text"                                                â”‚ â”‚
â”‚  â”‚ }                                                                    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                           â”‚
â”‚  Storage Bucket: chat_attachments                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Files: payment-proof.jpg, document.pdf, etc.                        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â”‚ New Message Event
            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      NOTIFICATION SERVICE                                 â”‚
â”‚                   (chatNotificationService.ts)                            â”‚
â”‚                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚   Sound Notification â”‚          â”‚ Browser Notificationâ”‚               â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚          â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚               â”‚
â”‚  â”‚   â”‚ ğŸ”Š Beep!      â”‚  â”‚          â”‚  â”‚ ğŸ’¬ New Messageâ”‚  â”‚               â”‚
â”‚  â”‚   â”‚ (Web Audio)   â”‚  â”‚          â”‚  â”‚ From: Admin   â”‚  â”‚               â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚          â”‚  â”‚ "Hello..."    â”‚  â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚               â”‚
â”‚                                     â”‚  (Auto-close 5s)  â”‚               â”‚
â”‚                                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Message Flow Diagrams

### Flow 1: Admin Sends Message to Member

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Admin   â”‚                â”‚   Appwrite   â”‚               â”‚  Member  â”‚
â”‚Dashboard â”‚                â”‚   Database   â”‚               â”‚Dashboard â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜               â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚                             â”‚                            â”‚
     â”‚ 1. Type message             â”‚                            â”‚
     â”‚    "Hello, how can I help?" â”‚                            â”‚
     â”‚                             â”‚                            â”‚
     â”‚ 2. Click Send               â”‚                            â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>  â”‚                            â”‚
     â”‚    (No validation)          â”‚                            â”‚
     â”‚                             â”‚                            â”‚
     â”‚ 3. Create document          â”‚                            â”‚
     â”‚    chat_messages            â”‚                            â”‚
     â”‚                             â”‚                            â”‚
     â”‚ 4. Success âœ…               â”‚                            â”‚
     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚                            â”‚
     â”‚                             â”‚                            â”‚
     â”‚                             â”‚ 5. Poll for new messages   â”‚
     â”‚                             â”‚    (every 3 seconds)       â”‚
     â”‚                             â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
     â”‚                             â”‚                            â”‚
     â”‚                             â”‚ 6. Return new messages     â”‚
     â”‚                             â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>   â”‚
     â”‚                             â”‚                            â”‚
     â”‚                             â”‚    7. Show notification    â”‚
     â”‚                             â”‚       ğŸ”Š Sound plays       â”‚
     â”‚                             â”‚       ğŸ’¬ Browser popup     â”‚
     â”‚                             â”‚                            â”‚
     â”‚                             â”‚ 8. Mark as read            â”‚
     â”‚                             â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
     â”‚                             â”‚                            â”‚
     â”‚                             â”‚ 9. Update read status      â”‚
     â”‚                             â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>   â”‚
     â”‚                             â”‚                            â”‚
```

---

### Flow 2: Member Sends Message (With Validation)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Member  â”‚         â”‚ Validation  â”‚        â”‚ Appwrite â”‚        â”‚  Admin   â”‚
â”‚Dashboard â”‚         â”‚   Service   â”‚        â”‚ Database â”‚        â”‚Dashboard â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚                      â”‚                     â”‚                   â”‚
     â”‚ 1. Type message      â”‚                     â”‚                   â”‚
     â”‚    "Call me 081234" â”‚                     â”‚                   â”‚
     â”‚                      â”‚                     â”‚                   â”‚
     â”‚ 2. Click Send        â”‚                     â”‚                   â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>    â”‚                     â”‚                   â”‚
     â”‚                      â”‚                     â”‚                   â”‚
     â”‚ 3. validateChatMessage()                   â”‚                   â”‚
     â”‚    containsPhoneDigits()                   â”‚                   â”‚
     â”‚                      â”‚                     â”‚                   â”‚
     â”‚ 4. BLOCKED âŒ        â”‚                     â”‚                   â”‚
     â”‚    "Cannot share     â”‚                     â”‚                   â”‚
     â”‚     phone numbers"   â”‚                     â”‚                   â”‚
     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚                     â”‚                   â”‚
     â”‚                      â”‚                     â”‚                   â”‚
     â”‚ 5. Show error        â”‚                     â”‚                   â”‚
     â”‚    âš ï¸ Warning box    â”‚                     â”‚                   â”‚
     â”‚                      â”‚                     â”‚                   â”‚
     â”‚ 6. User types new    â”‚                     â”‚                   â”‚
     â”‚    message:          â”‚                     â”‚                   â”‚
     â”‚    "I need help"     â”‚                     â”‚                   â”‚
     â”‚                      â”‚                     â”‚                   â”‚
     â”‚ 7. Click Send        â”‚                     â”‚                   â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>    â”‚                     â”‚                   â”‚
     â”‚                      â”‚                     â”‚                   â”‚
     â”‚ 8. validateChatMessage()                   â”‚                   â”‚
     â”‚    No phone numbers found                  â”‚                   â”‚
     â”‚                      â”‚                     â”‚                   â”‚
     â”‚ 9. ALLOWED âœ…        â”‚                     â”‚                   â”‚
     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚                     â”‚                   â”‚
     â”‚                      â”‚                     â”‚                   â”‚
     â”‚ 10. Create document  â”‚                     â”‚                   â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>     â”‚                   â”‚
     â”‚                      â”‚                     â”‚                   â”‚
     â”‚ 11. Success          â”‚                     â”‚                   â”‚
     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚                   â”‚
     â”‚                      â”‚                     â”‚                   â”‚
     â”‚                      â”‚                     â”‚ 12. Poll          â”‚
     â”‚                      â”‚                     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
     â”‚                      â”‚                     â”‚                   â”‚
     â”‚                      â”‚                     â”‚ 13. New msg       â”‚
     â”‚                      â”‚                     â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>   â”‚
     â”‚                      â”‚                     â”‚                   â”‚
```

---

### Flow 3: File Upload

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Member  â”‚         â”‚ Appwrite â”‚        â”‚ Appwrite â”‚        â”‚  Admin   â”‚
â”‚          â”‚         â”‚ Storage  â”‚        â”‚ Database â”‚        â”‚          â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚                    â”‚                    â”‚                   â”‚
     â”‚ 1. Click file btn  â”‚                    â”‚                   â”‚
     â”‚    Select image    â”‚                    â”‚                   â”‚
     â”‚                    â”‚                    â”‚                   â”‚
     â”‚ 2. Validate file   â”‚                    â”‚                   â”‚
     â”‚    - Type: JPG âœ…  â”‚                    â”‚                   â”‚
     â”‚    - Size: 2MB âœ…  â”‚                    â”‚                   â”‚
     â”‚                    â”‚                    â”‚                   â”‚
     â”‚ 3. Upload file     â”‚                    â”‚                   â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>  â”‚                    â”‚                   â”‚
     â”‚    to bucket:      â”‚                    â”‚                   â”‚
     â”‚    chat_attachmentsâ”‚                    â”‚                   â”‚
     â”‚                    â”‚                    â”‚                   â”‚
     â”‚ 4. File ID         â”‚                    â”‚                   â”‚
     â”‚    & URL           â”‚                    â”‚                   â”‚
     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚                    â”‚                   â”‚
     â”‚                    â”‚                    â”‚                   â”‚
     â”‚ 5. Create message  â”‚                    â”‚                   â”‚
     â”‚    with fileUrl    â”‚                    â”‚                   â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>    â”‚                   â”‚
     â”‚                    â”‚                    â”‚                   â”‚
     â”‚ 6. Success         â”‚                    â”‚                   â”‚
     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚                   â”‚
     â”‚                    â”‚                    â”‚                   â”‚
     â”‚                    â”‚                    â”‚ 7. Poll           â”‚
     â”‚                    â”‚                    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
     â”‚                    â”‚                    â”‚                   â”‚
     â”‚                    â”‚                    â”‚ 8. New message    â”‚
     â”‚                    â”‚                    â”‚    with file      â”‚
     â”‚                    â”‚                    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>   â”‚
     â”‚                    â”‚                    â”‚                   â”‚
     â”‚                    â”‚                    â”‚ 9. Click download â”‚
     â”‚                    â”‚                    â”‚    link           â”‚
     â”‚                    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
     â”‚                    â”‚                    â”‚                   â”‚
     â”‚                    â”‚ 10. Download file  â”‚                   â”‚
     â”‚                    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>   â”‚
     â”‚                    â”‚                    â”‚                   â”‚
```

---

## User Permission Matrix

| Feature | Admin | Therapist | Place | Hotel | Villa | User |
|---------|-------|-----------|-------|-------|-------|------|
| **Chat with Admin** | â– N/A | âœ… Yes | âœ… Yes | âœ… Yes | âœ… Yes | âœ… Yes |
| **Chat with Members** | âœ… Yes | âŒ No | âŒ No | âŒ No | âŒ No | âŒ No |
| **Send Text Messages** | âœ… Yes | âœ… Yes | âœ… Yes | âœ… Yes | âœ… Yes | âœ… Yes |
| **Send Emojis** | âœ… Yes | âœ… Yes | âœ… Yes | âœ… Yes | âœ… Yes | âœ… Yes |
| **Send Files** | âœ… Yes | âœ… Admin only | âœ… Admin only | âœ… Admin only | âœ… Admin only | âŒ No |
| **Share Location** | âœ… Yes | âœ… Yes | âœ… Yes | âœ… Yes | âœ… Yes | âœ… Yes |
| **Block Chats** | âœ… Yes | âŒ No | âŒ No | âŒ No | âŒ No | âŒ No |
| **Phone Validation** | âŒ Exempt | âœ… Yes | âœ… Yes | âœ… Yes | âœ… Yes | âœ… Yes |
| **See All Chats** | âœ… Yes | âŒ No | âŒ No | âŒ No | âŒ No | âŒ No |
| **Notifications** | âœ… Yes | âœ… Yes | âœ… Yes | âœ… Yes | âœ… Yes | âœ… Yes |
| **Read Receipts** | âœ… Yes | âœ… Yes | âœ… Yes | âœ… Yes | âœ… Yes | âœ… Yes |

---

## Phone Number Validation Logic

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 PHONE NUMBER DETECTION                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Input Message: "Call me at 08123456789"

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 1: Check User Type                 â”‚
â”‚                                         â”‚
â”‚ Is sender "admin"? â”€â”€YESâ”€â”€> âœ… ALLOW    â”‚
â”‚        â”‚                                â”‚
â”‚       NO                                â”‚
â”‚        â–¼                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 2: containsPhoneDigits()           â”‚
â”‚                                         â”‚
â”‚ Normalize: "Callmeat08123456789"        â”‚
â”‚ Regex: /\d{6,}/g                        â”‚
â”‚ Found: "08123456789" (11 digits)        â”‚
â”‚                                         â”‚
â”‚ Result: âŒ BLOCKED                      â”‚
â”‚ Error: "Cannot share phone numbers"     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Input Message: "Massage costs $50"

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 1: Check User Type                 â”‚
â”‚ Is sender "admin"? â”€â”€NOâ”€â”€>              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 2: containsPhoneDigits()           â”‚
â”‚                                         â”‚
â”‚ Normalize: "Massagecosts$50"            â”‚
â”‚ Regex: /\d{6,}/g                        â”‚
â”‚ Found: "50" (only 2 digits)             â”‚
â”‚                                         â”‚
â”‚ Result: âœ… PASS                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 3: containsNumberWords()           â”‚
â”‚                                         â”‚
â”‚ Words: ["massage", "costs", "$50"]      â”‚
â”‚ Number words found: 0                   â”‚
â”‚                                         â”‚
â”‚ Result: âœ… PASS                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 4: containsPhonePattern()          â”‚
â”‚                                         â”‚
â”‚ Keywords: ["call", "phone", "whatsapp"] â”‚
â”‚ Found: None                             â”‚
â”‚                                         â”‚
â”‚ Result: âœ… PASS                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 5: containsAlternativeNumbers()    â”‚
â”‚                                         â”‚
â”‚ Substitutions: oâ†’0, iâ†’1, etc.           â”‚
â”‚ Converted: "Massagec0sts$50"            â”‚
â”‚ Found: "50" (only 2 digits)             â”‚
â”‚                                         â”‚
â”‚ Result: âœ… PASS                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Final Result: âœ… ALLOWED                â”‚
â”‚ Message can be sent                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Database Structure

```
Appwrite Database
â”‚
â”œâ”€â”€ Collection: chat_messages
â”‚   â”‚
â”‚   â”œâ”€â”€ Documents (Messages)
â”‚   â”‚   â”œâ”€â”€ Message 1 {
â”‚   â”‚   â”‚     senderId: "therapist123"
â”‚   â”‚   â”‚     recipientId: "admin"
â”‚   â”‚   â”‚     message: "Hello"
â”‚   â”‚   â”‚     timestamp: "2025-01-15T10:00:00Z"
â”‚   â”‚   â”‚     read: false
â”‚   â”‚   â”‚   }
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ Message 2 {
â”‚   â”‚   â”‚     senderId: "admin"
â”‚   â”‚   â”‚     recipientId: "therapist123"
â”‚   â”‚   â”‚     message: "How can I help?"
â”‚   â”‚   â”‚     timestamp: "2025-01-15T10:05:00Z"
â”‚   â”‚   â”‚     read: true
â”‚   â”‚   â”‚   }
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ Message 3 {
â”‚   â”‚         senderId: "place456"
â”‚   â”‚         recipientId: "admin"
â”‚   â”‚         message: "ğŸ“ payment-proof.jpg"
â”‚   â”‚         messageType: "file"
â”‚   â”‚         fileUrl: "https://..."
â”‚   â”‚         timestamp: "2025-01-15T10:10:00Z"
â”‚   â”‚         read: false
â”‚   â”‚       }
â”‚   â”‚
â”‚   â”œâ”€â”€ Indexes
â”‚   â”‚   â”œâ”€â”€ chat_participants [senderId, recipientId]
â”‚   â”‚   â”œâ”€â”€ unread_messages [recipientId, read]
â”‚   â”‚   â””â”€â”€ message_timeline [timestamp ASC]
â”‚   â”‚
â”‚   â””â”€â”€ Permissions
â”‚       â”œâ”€â”€ Create: users
â”‚       â”œâ”€â”€ Read: users
â”‚       â”œâ”€â”€ Update: users
â”‚       â””â”€â”€ Delete: admins
â”‚
â””â”€â”€ Storage Bucket: chat_attachments
    â”‚
    â”œâ”€â”€ Files
    â”‚   â”œâ”€â”€ file_001.jpg (2.3 MB)
    â”‚   â”œâ”€â”€ file_002.pdf (1.5 MB)
    â”‚   â””â”€â”€ file_003.png (0.8 MB)
    â”‚
    â””â”€â”€ Permissions
        â”œâ”€â”€ Create: users
        â”œâ”€â”€ Read: users
        â””â”€â”€ Delete: admins
```

---

## Component Hierarchy

```
App
â”‚
â”œâ”€â”€ AdminDashboardPage
â”‚   â”‚
â”‚   â”œâ”€â”€ Navigation Drawer
â”‚   â”‚   â”œâ”€â”€ Analytics
â”‚   â”‚   â”œâ”€â”€ Therapists
â”‚   â”‚   â”œâ”€â”€ Places
â”‚   â”‚   â”œâ”€â”€ Accounts
â”‚   â”‚   â”œâ”€â”€ Messages â—„â”€â”€ Routes to AdminChatListPage
â”‚   â”‚   â”œâ”€â”€ Payments
â”‚   â”‚   â””â”€â”€ Settings
â”‚   â”‚
â”‚   â””â”€â”€ AdminChatListPage
â”‚       â”‚
â”‚       â”œâ”€â”€ Chat List Sidebar
â”‚       â”‚   â”œâ”€â”€ Search Bar
â”‚       â”‚   â””â”€â”€ User List
â”‚       â”‚       â”œâ”€â”€ TherapistItem (with unread badge)
â”‚       â”‚       â”œâ”€â”€ PlaceItem (with unread badge)
â”‚       â”‚       â”œâ”€â”€ HotelItem (with unread badge)
â”‚       â”‚       â””â”€â”€ UserItem (with unread badge)
â”‚       â”‚
â”‚       â””â”€â”€ Chat Window
â”‚           â”œâ”€â”€ Chat Header (with block button)
â”‚           â”œâ”€â”€ Messages Area
â”‚           â”‚   â”œâ”€â”€ TextMessage
â”‚           â”‚   â”œâ”€â”€ FileMessage (with download link)
â”‚           â”‚   â”œâ”€â”€ LocationMessage (with map link)
â”‚           â”‚   â””â”€â”€ SystemMessage (block warning)
â”‚           â”‚
â”‚           â””â”€â”€ Input Area
â”‚               â”œâ”€â”€ Emoji Picker Button
â”‚               â”œâ”€â”€ File Upload Button
â”‚               â”œâ”€â”€ Location Share Button
â”‚               â””â”€â”€ Message Input + Send Button
â”‚
â”œâ”€â”€ TherapistDashboardPage
â”‚   â”‚
â”‚   â”œâ”€â”€ Dashboard Content
â”‚   â”‚
â”‚   â”œâ”€â”€ Fixed Chat Button (bottom-right)
â”‚   â”‚   â””â”€â”€ Unread Badge
â”‚   â”‚
â”‚   â””â”€â”€ MemberChatWindow (if showChatWindow)
â”‚
â”œâ”€â”€ PlaceDashboardPage
â”‚   â”‚
â”‚   â”œâ”€â”€ Dashboard Content
â”‚   â”œâ”€â”€ Fixed Chat Button
â”‚   â””â”€â”€ MemberChatWindow (if showChatWindow)
â”‚
â”œâ”€â”€ HotelDashboardPage
â”‚   â”‚
â”‚   â”œâ”€â”€ Dashboard Content
â”‚   â”œâ”€â”€ Fixed Chat Button
â”‚   â””â”€â”€ MemberChatWindow (if showChatWindow)
â”‚
â””â”€â”€ VillaDashboardPage
    â”‚
    â”œâ”€â”€ Dashboard Content
    â”œâ”€â”€ Fixed Chat Button
    â””â”€â”€ MemberChatWindow (if showChatWindow)

MemberChatWindow (Shared Component)
â”‚
â”œâ”€â”€ Modal Overlay
â”‚
â””â”€â”€ Chat Window
    â”œâ”€â”€ Header ("Chat with IndaStreet Team")
    â”œâ”€â”€ Blocked Warning (if blocked)
    â”œâ”€â”€ Validation Error (if validation failed)
    â”œâ”€â”€ Messages Area
    â”‚   â”œâ”€â”€ Admin Messages (white bubble, left)
    â”‚   â””â”€â”€ User Messages (orange bubble, right)
    â”‚
    â””â”€â”€ Input Area
        â”œâ”€â”€ Emoji Picker
        â”œâ”€â”€ File Upload Button
        â”œâ”€â”€ Location Share Button
        â””â”€â”€ Message Input + Send Button
```

---

## Security Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              SECURITY & VALIDATION LAYERS                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

User Input: "My phone is 08123456789"
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Layer 1: Client-Side Validation         â”‚
â”‚                                         â”‚
â”‚ chatValidation.ts                       â”‚
â”‚ â”œâ”€â”€ Check: Phone digits                â”‚
â”‚ â”œâ”€â”€ Check: Number words                â”‚
â”‚ â”œâ”€â”€ Check: Phone patterns              â”‚
â”‚ â””â”€â”€ Check: Alternative formats         â”‚
â”‚                                         â”‚
â”‚ Result: âŒ BLOCKED                      â”‚
â”‚ Error shown to user immediately         â”‚
â”‚ Message never sent to database          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â”‚ If validation passes âœ…
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Layer 2: Database Permissions           â”‚
â”‚                                         â”‚
â”‚ Appwrite Permissions                    â”‚
â”‚ â”œâ”€â”€ Must be authenticated              â”‚
â”‚ â”œâ”€â”€ Must have "users" role             â”‚
â”‚ â””â”€â”€ Can only create/read own messages  â”‚
â”‚                                         â”‚
â”‚ Result: âœ… ALLOWED                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Layer 3: Storage Permissions            â”‚
â”‚                                         â”‚
â”‚ Appwrite Storage                        â”‚
â”‚ â”œâ”€â”€ File type validation               â”‚
â”‚ â”œâ”€â”€ File size validation (10MB max)    â”‚
â”‚ â”œâ”€â”€ Must be authenticated              â”‚
â”‚ â””â”€â”€ Antivirus scan (if enabled)        â”‚
â”‚                                         â”‚
â”‚ Result: âœ… ALLOWED                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Layer 4: Admin Moderation               â”‚
â”‚                                         â”‚
â”‚ Admin Controls                          â”‚
â”‚ â”œâ”€â”€ Can block any chat                 â”‚
â”‚ â”œâ”€â”€ Blocked users see warning          â”‚
â”‚ â”œâ”€â”€ Blocked users cannot send          â”‚
â”‚ â””â”€â”€ System message sent to user        â”‚
â”‚                                         â”‚
â”‚ Result: Can be blocked anytime          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Real-Time Update Mechanism

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  POLLING MECHANISM                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Time: 0s
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Client   â”‚ â”€â”€â”€â”€ Initial Load â”€â”€â”€â”€> [Fetch Messages]
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Time: 3s
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Client   â”‚ â”€â”€â”€â”€ Poll #1 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> [Fetch Messages]
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           (Check for new)

Time: 6s
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Client   â”‚ â”€â”€â”€â”€ Poll #2 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> [Fetch Messages]
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           (Check for new)
                                       
                                       New message found!
                                       â–¼
                                [Compare last message ID]
                                       â–¼
                                [Trigger notification]
                                       â”œâ”€â”€> ğŸ”Š Sound
                                       â””â”€â”€> ğŸ’¬ Browser popup

Time: 9s
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Client   â”‚ â”€â”€â”€â”€ Poll #3 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> [Fetch Messages]
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           (Check for new)

... continues every 3 seconds ...

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Implementation:
```typescript
useEffect(() => {
  // Initial fetch
  fetchMessages();
  
  // Set up polling
  const interval = setInterval(() => {
    fetchMessages();
  }, 3000); // 3 seconds
  
  // Cleanup
  return () => clearInterval(interval);
}, [userId]);
```
```

---

**Last Updated:** January 2025  
**Version:** 1.0
