/**
 * ============================================================================
 * üìä REAL-TIME LOADING & LANDING PAGE PERFORMANCE VALIDATOR
 * ============================================================================ 
 * 
 * Interactive browser-based tool for validating loading speed and performance
 * Tests against Uber and Facebook standards in real-time
 * 
 * February 9, 2026
 * ============================================================================
 */

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üöÄ Loading & Landing Page Performance Validator</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: white;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        
        h1 {
            text-align: center;
            margin-bottom: 30px;
            font-size: 28px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .metric-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .metric-value {
            font-size: 32px;
            font-weight: bold;
            color: #fbbf24;
            margin: 10px 0;
        }
        
        .metric-label {
            font-size: 14px;
            opacity: 0.8;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .metric-status {
            font-size: 12px;
            margin-top: 8px;
            padding: 4px 8px;
            border-radius: 12px;
            font-weight: 500;
        }
        
        .status-excellent { background: rgba(34, 197, 94, 0.3); color: #22c55e; }
        .status-good { background: rgba(251, 191, 36, 0.3); color: #fbbf24; }
        .status-poor { background: rgba(239, 68, 68, 0.3); color: #ef4444; }
        
        .test-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 25px;
            margin: 20px 0;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .section-title {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .test-button {
            background: linear-gradient(45deg, #f97316, #fb923c);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin: 10px;
            min-height: 50px;
            transition: all 0.3s ease;
        }
        
        .test-button:hover, .test-button:active {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(249, 115, 22, 0.4);
        }
        
        .test-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .results-container {
            max-height: 300px;
            overflow-y: auto;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }
        
        .result-item {
            padding: 10px;
            margin: 5px 0;
            border-radius: 6px;
            font-size: 14px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .result-pass { background: rgba(34, 197, 94, 0.2); }
        .result-warn { background: rgba(251, 191, 36, 0.2); }
        .result-fail { background: rgba(239, 68, 68, 0.2); }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            margin: 10px 0;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #f97316, #fbbf24);
            width: 0%;
            transition: width 0.5s ease;
        }
        
        .url-input {
            width: 100%;
            padding: 12px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 16px;
            margin: 10px 0;
        }
        
        .url-input::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }
        
        .compliance-badge {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
            margin: 10px 5px;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-size: 12px;
        }
        
        .gold { background: linear-gradient(90deg, #fbbf24, #f59e0b); }
        .silver { background: linear-gradient(90deg, #9ca3af, #6b7280); }
        .bronze { background: linear-gradient(90deg, #d97706, #b45309); }
        .fail { background: linear-gradient(90deg, #ef4444, #dc2626); }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .iframe-container {
            width: 100%;
            height: 400px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            overflow: hidden;
            margin: 20px 0;
            background: white;
        }
        
        #test-frame {
            width: 100%;
            height: 100%;
            border: none;
        }
        
        @media (max-width: 768px) {
            .container {
                margin: 10px;
                padding: 20px;
            }
            
            .metrics-grid {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            }
            
            .test-button {
                width: 100%;
                margin: 5px 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöÄ Loading & Landing Page Performance Validator</h1>
        
        <div class="metrics-grid">
            <div class="metric-card">
                <div class="metric-value" id="load-time">--</div>
                <div class="metric-label">Load Time (ms)</div>
                <div class="metric-status" id="load-status">Not Tested</div>
            </div>
            <div class="metric-card">
                <div class="metric-value" id="fcp-time">--</div>
                <div class="metric-label">First Contentful Paint</div>
                <div class="metric-status" id="fcp-status">Not Tested</div>
            </div>
            <div class="metric-card">
                <div class="metric-value" id="tti-time">--</div>
                <div class="metric-label">Time to Interactive</div>
                <div class="metric-status" id="tti-status">Not Tested</div>
            </div>
            <div class="metric-card">
                <div class="metric-value" id="performance-score">--</div>
                <div class="metric-label">Performance Score</div>
                <div class="metric-status" id="performance-status">Not Tested</div>
            </div>
        </div>
        
        <div class="test-section">
            <div class="section-title">
                üéØ <span>Gold Standard Performance Tests</span>
            </div>
            
            <input 
                type="url" 
                class="url-input" 
                id="test-url" 
                placeholder="Enter URL to test (default: http://127.0.0.1:3004/)"
                value="http://127.0.0.1:3004/"
            />
            
            <button class="test-button" onclick="runLoadingPageTest()">
                ‚ö° Test Loading Page Performance
            </button>
            
            <button class="test-button" onclick="runLandingPageTest()">
                üé® Test Landing Page Performance
            </button>
            
            <button class="test-button" onclick="runFullPerformanceAudit()">
                üîç Run Complete Performance Audit
            </button>
            
            <div class="progress-bar" style="display: none;" id="progress-bar">
                <div class="progress-fill" id="progress-fill"></div>
            </div>
            
            <div class="results-container" id="test-results" style="display: none;"></div>
        </div>
        
        <div class="test-section">
            <div class="section-title">
                üèÜ <span>Uber/Facebook Standards Compliance</span>
            </div>
            
            <div id="compliance-badges">
                <span class="compliance-badge fail">Loading Speed: Not Tested</span>
                <span class="compliance-badge fail">Landing Page: Not Tested</span>
                <span class="compliance-badge fail">Network: Not Tested</span>
                <span class="compliance-badge fail">Mobile: Not Tested</span>
            </div>
            
            <button class="test-button" onclick="validateUberStandards()">
                üöó Validate Uber Standards
            </button>
            
            <button class="test-button" onclick="validateFacebookStandards()">
                üìò Validate Facebook Standards
            </button>
        </div>
        
        <div class="test-section">
            <div class="section-title">
                üì± <span>Live Page Testing</span>
            </div>
            
            <button class="test-button" onclick="loadTestPage('loading')">
                ‚ö° Load Loading Page
            </button>
            
            <button class="test-button" onclick="loadTestPage('landing')">
                üé® Load Landing Page
            </button>
            
            <button class="test-button" onclick="loadTestPage('home')">
                üè† Load Home Page
            </button>
            
            <div class="iframe-container" style="display: none;" id="iframe-container">
                <iframe id="test-frame" src=""></iframe>
            </div>
        </div>
    </div>

    <script>
        let currentTests = {};
        let performanceData = {
            loadTime: null,
            fcp: null,
            tti: null,
            score: null
        };

        function log(message, type = 'info') {
            const resultsContainer = document.getElementById('test-results');
            resultsContainer.style.display = 'block';
            
            const item = document.createElement('div');
            item.className = `result-item result-${type}`;
            
            const text = document.createElement('span');
            text.textContent = message;
            
            const timestamp = document.createElement('span');
            timestamp.textContent = new Date().toLocaleTimeString();
            timestamp.style.opacity = '0.7';
            timestamp.style.fontSize = '12px';
            
            item.appendChild(text);
            item.appendChild(timestamp);
            resultsContainer.appendChild(item);
            
            resultsContainer.scrollTop = resultsContainer.scrollHeight;
        }

        function updateProgress(percent) {
            const progressBar = document.getElementById('progress-bar');
            const progressFill = document.getElementById('progress-fill');
            
            progressBar.style.display = 'block';
            progressFill.style.width = percent + '%';
            
            if (percent >= 100) {
                setTimeout(() => {
                    progressBar.style.display = 'none';
                }, 1000);
            }
        }

        function updateMetric(metricId, value, unit = 'ms') {
            const element = document.getElementById(metricId);
            const statusElement = document.getElementById(metricId.replace('-time', '-status').replace('-score', '-status'));
            
            element.textContent = value + (unit ? unit : '');
            
            // Determine status based on value and metric type
            let status, className;
            
            if (metricId === 'load-time') {
                if (value < 1000) { status = 'Excellent'; className = 'status-excellent'; }
                else if (value < 2000) { status = 'Good'; className = 'status-good'; }
                else { status = 'Needs Work'; className = 'status-poor'; }
            } else if (metricId === 'fcp-time') {
                if (value < 1800) { status = 'Excellent'; className = 'status-excellent'; }
                else if (value < 3000) { status = 'Good'; className = 'status-good'; }
                else { status = 'Poor'; className = 'status-poor'; }
            } else if (metricId === 'tti-time') {
                if (value < 3800) { status = 'Excellent'; className = 'status-excellent'; }
                else if (value < 5000) { status = 'Good'; className = 'status-good'; }
                else { status = 'Poor'; className = 'status-poor'; }
            } else if (metricId === 'performance-score') {
                if (value >= 90) { status = 'Excellent'; className = 'status-excellent'; }
                else if (value >= 70) { status = 'Good'; className = 'status-good'; }
                else { status = 'Poor'; className = 'status-poor'; }
            }
            
            if (statusElement && status) {
                statusElement.textContent = status;
                statusElement.className = `metric-status ${className}`;
            }
        }

        function updateComplianceBadge(category, level) {
            const badges = document.getElementById('compliance-badges');
            const existingBadge = Array.from(badges.children).find(badge => 
                badge.textContent.includes(category)
            );
            
            if (existingBadge) {
                existingBadge.textContent = `${category}: ${level}`;
                existingBadge.className = `compliance-badge ${level.toLowerCase()}`;
            }
        }

        async function runLoadingPageTest() {
            log('üöÄ Starting Loading Page Performance Test...', 'info');
            updateProgress(10);
            
            const url = document.getElementById('test-url').value || 'http://127.0.0.1:3004/';
            
            try {
                // Test loading page specifically
                const loadingUrl = url + '#loading';
                const startTime = performance.now();
                
                const response = await fetch(loadingUrl, { method: 'HEAD' });
                const loadTime = performance.now() - startTime;
                
                updateProgress(50);
                
                performanceData.loadTime = Math.round(loadTime);
                updateMetric('load-time', performanceData.loadTime);
                
                log(`‚úÖ Loading page response: ${Math.round(loadTime)}ms`, 'pass');
                
                // Simulate FCP for loading page (should be very fast)
                const fcpEstimate = Math.round(loadTime * 0.6); // Loading page should paint quickly
                performanceData.fcp = fcpEstimate;
                updateMetric('fcp-time', fcpEstimate);
                
                log(`üìä First Contentful Paint (estimated): ${fcpEstimate}ms`, fcpEstimate < 1800 ? 'pass' : 'warn');
                
                updateProgress(100);
                
                // Update compliance
                const level = loadTime < 1000 ? 'Gold' : loadTime < 2000 ? 'Silver' : 'Bronze';
                updateComplianceBadge('Loading Speed', level);
                
                log(`üèÜ Loading Page Performance: ${level} Standard`, level === 'Gold' ? 'pass' : 'warn');
                
            } catch (error) {
                log(`‚ùå Loading page test failed: ${error.message}`, 'fail');
                updateProgress(100);
            }
        }

        async function runLandingPageTest() {
            log('üé® Starting Landing Page Performance Test...', 'info');
            updateProgress(10);
            
            const url = document.getElementById('test-url').value || 'http://127.0.0.1:3004/';
            
            try {
                // Test landing page specifically
                const landingUrl = url + '#landing';
                updateProgress(20);
                
                // Measure full page load
                const startTime = performance.now();
                
                // Create hidden iframe to measure actual load performance
                const iframe = document.createElement('iframe');
                iframe.style.display = 'none';
                iframe.src = landingUrl;
                
                document.body.appendChild(iframe);
                
                updateProgress(40);
                
                await new Promise((resolve, reject) => {
                    const timeout = setTimeout(() => {
                        reject(new Error('Landing page load timeout'));
                    }, 10000);
                    
                    iframe.onload = () => {
                        clearTimeout(timeout);
                        const loadTime = performance.now() - startTime;
                        
                        performanceData.loadTime = Math.round(loadTime);
                        updateMetric('load-time', performanceData.loadTime);
                        
                        log(`‚úÖ Landing page loaded: ${Math.round(loadTime)}ms`, 'pass');
                        
                        // Estimate TTI (Time to Interactive)
                        const ttiEstimate = Math.round(loadTime * 1.2);
                        performanceData.tti = ttiEstimate;
                        updateMetric('tti-time', ttiEstimate);
                        
                        log(`‚ö° Time to Interactive (estimated): ${ttiEstimate}ms`, ttiEstimate < 3800 ? 'pass' : 'warn');
                        
                        // Calculate performance score
                        const score = calculatePerformanceScore(loadTime, ttiEstimate);
                        performanceData.score = score;
                        updateMetric('performance-score', score, '%');
                        
                        log(`üìä Performance Score: ${score}%`, score >= 90 ? 'pass' : score >= 70 ? 'warn' : 'fail');
                        
                        // Update compliance
                        const level = score >= 90 ? 'Gold' : score >= 75 ? 'Silver' : score >= 60 ? 'Bronze' : 'Fail';
                        updateComplianceBadge('Landing Page', level);
                        
                        resolve();
                    };
                });
                
                updateProgress(80);
                
                // Clean up
                document.body.removeChild(iframe);
                updateProgress(100);
                
                log('üéØ Landing page performance test completed', 'pass');
                
            } catch (error) {
                log(`‚ùå Landing page test failed: ${error.message}`, 'fail');
                updateProgress(100);
            }
        }

        function calculatePerformanceScore(loadTime, tti) {
            let score = 100;
            
            // Deduct points for slow loading
            if (loadTime > 1000) score -= Math.min(30, (loadTime - 1000) / 100);
            if (tti > 3800) score -= Math.min(40, (tti - 3800) / 200);
            
            return Math.max(0, Math.round(score));
        }

        async function runFullPerformanceAudit() {
            log('üîç Starting Full Performance Audit...', 'info');
            updateProgress(5);
            
            // Run loading page test
            await runLoadingPageTest();
            updateProgress(40);
            
            // Wait a moment
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            // Run landing page test
            await runLandingPageTest();
            updateProgress(80);
            
            // Calculate overall compliance
            await calculateOverallCompliance();
            updateProgress(100);
            
            log('üèÜ Full performance audit completed!', 'pass');
        }

        async function calculateOverallCompliance() {
            const categories = ['Loading Speed', 'Landing Page', 'Network', 'Mobile'];
            let totalScore = 0;
            let testCount = 0;
            
            // Mock network and mobile scores based on current performance
            if (performanceData.loadTime) {
                const networkScore = performanceData.loadTime < 1500 ? 85 : 65;
                const mobileScore = performanceData.tti < 4000 ? 80 : 60;
                
                updateComplianceBadge('Network', networkScore >= 80 ? 'Gold' : 'Silver');
                updateComplianceBadge('Mobile', mobileScore >= 80 ? 'Gold' : 'Silver');
                
                totalScore += networkScore + mobileScore;
                testCount += 2;
            }
            
            // Add existing scores
            if (performanceData.score) {
                totalScore += performanceData.score;
                testCount++;
            }
            
            if (testCount > 0) {
                const overallScore = Math.round(totalScore / testCount);
                log(`üìä Overall Compliance Score: ${overallScore}%`, overallScore >= 85 ? 'pass' : 'warn');
                
                const overallLevel = overallScore >= 90 ? 'Gold' : overallScore >= 75 ? 'Silver' : 'Bronze';
                log(`üéØ Overall Standards Compliance: ${overallLevel}`, overallLevel === 'Gold' ? 'pass' : 'warn');
            }
        }

        async function validateUberStandards() {
            log('üöó Validating Uber Design System Standards...', 'info');
            
            const checks = [
                { name: 'Load Time < 2s', pass: performanceData.loadTime < 2000 },
                { name: 'FCP < 1.8s', pass: performanceData.fcp < 1800 },
                { name: 'TTI < 3.8s', pass: performanceData.tti < 3800 },
                { name: 'Performance Score > 70%', pass: performanceData.score > 70 }
            ];
            
            let passing = 0;
            for (const check of checks) {
                if (check.pass) {
                    log(`‚úÖ ${check.name}`, 'pass');
                    passing++;
                } else {
                    log(`‚ùå ${check.name}`, 'fail');
                }
            }
            
            const compliance = passing >= 3 ? 'Gold' : passing >= 2 ? 'Silver' : 'Bronze';
            log(`üöó Uber Standards: ${compliance} (${passing}/4)`, compliance === 'Gold' ? 'pass' : 'warn');
        }

        async function validateFacebookStandards() {
            log('üìò Validating Facebook Performance Guidelines...', 'info');
            
            const checks = [
                { name: 'Load Time < 1.5s', pass: performanceData.loadTime < 1500 },
                { name: 'FCP < 1.2s', pass: performanceData.fcp < 1200 },
                { name: 'TTI < 3.0s', pass: performanceData.tti < 3000 },
                { name: 'Performance Score > 80%', pass: performanceData.score > 80 }
            ];
            
            let passing = 0;
            for (const check of checks) {
                if (check.pass) {
                    log(`‚úÖ ${check.name}`, 'pass');
                    passing++;
                } else {
                    log(`‚ùå ${check.name}`, 'fail');
                }
            }
            
            const compliance = passing >= 3 ? 'Gold' : passing >= 2 ? 'Silver' : 'Bronze';
            log(`üìò Facebook Standards: ${compliance} (${passing}/4)`, compliance === 'Gold' ? 'pass' : 'warn');
        }

        function loadTestPage(pageType) {
            const url = document.getElementById('test-url').value || 'http://127.0.0.1:3004/';
            const iframe = document.getElementById('test-frame');
            const container = document.getElementById('iframe-container');
            
            let targetUrl = url;
            if (pageType === 'loading') {
                targetUrl += '#loading';
            } else if (pageType === 'landing') {
                targetUrl += '#landing';  
            } else if (pageType === 'home') {
                targetUrl += '#home';
            }
            
            log(`üîç Loading ${pageType} page for testing...`, 'info');
            
            iframe.src = targetUrl;
            container.style.display = 'block';
            
            iframe.onload = () => {
                log(`‚úÖ ${pageType} page loaded successfully`, 'pass');
            };
            
            iframe.onerror = () => {
                log(`‚ùå Failed to load ${pageType} page`, 'fail');
            };
        }

        // Auto-detect dev server and update URL
        window.addEventListener('load', () => {
            const urlInput = document.getElementById('test-url');
            
            // Try to detect the dev server port
            const possiblePorts = [3004, 3003, 3002, 3001, 3000];
            
            possiblePorts.forEach(port => {
                const testUrl = `http://127.0.0.1:${port}/`;
                fetch(testUrl, { method: 'HEAD', mode: 'no-cors' })
                    .then(() => {
                        if (urlInput.value.includes('3004')) { // Only update if still default
                            urlInput.value = testUrl;
                        }
                    })
                    .catch(() => {}); // Ignore errors
            });
            
            log('üöÄ Performance validator ready!', 'pass');
            log('üìä Enter URL and run tests to validate loading performance', 'info');
        });
    </script>
</body>
</html>