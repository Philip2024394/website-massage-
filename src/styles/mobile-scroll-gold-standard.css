/**
 * ============================================================================
 * üì± MOBILE SCROLL GOLD STANDARD - FACEBOOK/INSTAGRAM BEHAVIOR
 * ============================================================================
 * 
 * HARD RULES (NON-NEGOTIABLE):
 * 1. html, body must be scrollable at all times
 * 2. Single scroll container per screen
 * 3. Native momentum scrolling only  
 * 4. No JS scroll libraries
 * 5. No overflow: hidden on body/html
 * 6. Use 100dvh or calc(var(--vh) * 100), not 100vh alone
 * 
 * Created: February 7, 2026
 * Standard: Facebook / Instagram Mobile UX
 * ============================================================================
 */

/* ============================================================================
   1Ô∏è‚É£ BASE SCROLLING - html & body ALWAYS SCROLLABLE
   ============================================================================ */

html {
  height: 100%;
  overflow-y: auto; /* Always allow vertical scroll */
  overflow-x: hidden; /* Prevent horizontal scroll without hiding scrollbar */
  -webkit-text-size-adjust: 100%;
}

body {
  height: 100%;
  overflow-y: auto; /* Always allow vertical scroll */
  overflow-x: hidden; /* Prevent horizontal scroll */
  position: relative; /* Never use position: fixed on body */
  margin: 0;
  padding: 0;
}

/* ============================================================================
   2Ô∏è‚É£ ROOT CONTAINER - NO SCROLL TRAPS
   ============================================================================ */

#root {
  min-height: 100%;
  width: 100%;
  position: relative;
  overflow: visible; /* Let content flow naturally */
}

/* ============================================================================
   3Ô∏è‚É£ NATIVE MOMENTUM SCROLLING - GLOBAL
   ============================================================================ */

* {
  -webkit-overflow-scrolling: touch; /* iOS momentum scrolling */
  touch-action: pan-y; /* Allow vertical scroll, prevent horizontal */
}

/* Allow both directions for scroll containers */
.scroll-container {
  touch-action: pan-y pan-x;
}

/* ============================================================================
   4Ô∏è‚É£ SINGLE SCROLL CONTAINER PATTERN
   ============================================================================ */

.scroll-container {
  overflow-y: auto;
  overflow-x: hidden;
  -webkit-overflow-scrolling: touch;
  overscroll-behavior: contain; /* Prevent scroll chaining */
  will-change: scroll-position;
}

/* Hide scrollbar visually WITHOUT disabling scroll */
.scroll-container::-webkit-scrollbar {
  width: 0;
  height: 0;
  display: none;
}

.scroll-container {
  scrollbar-width: none; /* Firefox */
  -ms-overflow-style: none; /* IE/Edge */
}

/* ============================================================================
   5Ô∏è‚É£ VIEWPORT HEIGHT - iOS SAFE
   ============================================================================ */

/* Use dynamic viewport height (100dvh) when possible */
.full-height {
  height: 100dvh;
  min-height: 100dvh;
}

/* Fallback for browsers without dvh support */
@supports not (height: 100dvh) {
  .full-height {
    height: calc(var(--vh, 1vh) * 100);
    min-height: calc(var(--vh, 1vh) * 100);
  }
}

/* Mobile-specific height constraints */
@media (max-width: 768px) {
  .mobile-full-height {
    height: 100dvh;
    max-height: 100dvh;
  }
  
  @supports not (height: 100dvh) {
    .mobile-full-height {
      height: calc(var(--vh, 1vh) * 100);
      max-height: calc(var(--vh, 1vh) * 100);
    }
  }
}

/* ============================================================================
   6Ô∏è‚É£ MODAL & OVERLAY - TEMPORARY SCROLL LOCK ONLY
   ============================================================================ */

/* üö® WARNING: This class violates STABILITY_SCROLL_LOCK_RULES.md 
 * 
 * ‚ùå DO NOT USE for:
 *   - Loading screens (use self-contained position: fixed instead)
 *   - Landing pages (use self-contained position: fixed instead)
 *   - Any permanent UI elements
 * 
 * ‚úÖ ONLY USE for:
 *   - True modals that overlay existing content temporarily
 *   - Components that need TEMPORARY scroll lock (< 5 seconds)
 * 
 * See: core-ui/STABILITY_SCROLL_LOCK_RULES.md for details
 */

/* When modal is open, lock body scroll temporarily */
body.modal-open {
  overflow: hidden;
  position: fixed; /* Temporary lock */
  width: 100%;
  height: 100%;
}

/* Modal content scrolls internally */
.modal-content {
  overflow-y: auto;
  overflow-x: hidden;
  -webkit-overflow-scrolling: touch;
  overscroll-behavior: contain;
  max-height: 90dvh;
}

/* Modal scrollbar hidden */
.modal-content::-webkit-scrollbar {
  width: 0;
  height: 0;
}

/* ============================================================================
   7Ô∏è‚É£ CHAT WINDOW - SINGLE SCROLL CONTAINER
   ============================================================================ */

.chat-window {
  display: flex;
  flex-direction: column;
  max-height: 90dvh;
  overflow: hidden; /* Parent doesn't scroll */
}

.chat-messages {
  flex: 1;
  overflow-y: auto; /* ONLY child scrolls */
  overflow-x: hidden;
  -webkit-overflow-scrolling: touch;
  overscroll-behavior: contain;
}

.chat-messages::-webkit-scrollbar {
  width: 0;
  height: 0;
}

.chat-input {
  flex-shrink: 0; /* Fixed at bottom */
  overflow: visible;
}

/* ============================================================================
   8Ô∏è‚É£ LIST VIEWS - FACEBOOK/INSTAGRAM PATTERN
   ============================================================================ */

.list-container {
  overflow-y: auto;
  overflow-x: hidden;
  -webkit-overflow-scrolling: touch;
  overscroll-behavior: contain;
  height: 100%;
  max-height: 100dvh;
}

.list-container::-webkit-scrollbar {
  width: 0;
  height: 0;
}

/* ============================================================================
   9Ô∏è‚É£ PREVENT 100VH BUG ON MOBILE
   ============================================================================ */

/* Never use plain 100vh on mobile Safari */
@media (max-width: 768px) {
  .h-screen,
  .min-h-screen,
  [class*="h-screen"],
  [class*="h-vh"] {
    height: 100dvh !important;
    min-height: 100dvh !important;
  }
  
  @supports not (height: 100dvh) {
    .h-screen,
    .min-h-screen,
    [class*="h-screen"],
    [class*="h-vh"] {
      height: calc(var(--vh, 1vh) * 100) !important;
      min-height: calc(var(--vh, 1vh) * 100) !important;
    }
  }
}

/* ============================================================================
   üîü SAFE CONTAINER WIDTHS - NO 100VW
   ============================================================================ */

/* 100vw includes scrollbar width, causing horizontal overflow */
.full-width {
  width: 100%;
  max-width: 100%;
}

@media (max-width: 768px) {
  .w-screen,
  [class*="w-screen"] {
    width: 100% !important;
    max-width: 100% !important;
  }
}

/* ============================================================================
   1Ô∏è‚É£1Ô∏è‚É£ IMAGE & MEDIA CONSTRAINTS
   ============================================================================ */

img,
video,
iframe {
  max-width: 100%;
  height: auto;
}

/* ============================================================================
   1Ô∏è‚É£2Ô∏è‚É£ FLEXBOX OVERFLOW PREVENTION
   ============================================================================ */

/* Flex children can overflow invisibly */
* {
  min-width: 0;
  min-height: 0;
}

/* ============================================================================
   1Ô∏è‚É£3Ô∏è‚É£ INPUT FIELDS - iOS ZOOM PREVENTION
   ============================================================================ */

input,
textarea,
select {
  font-size: 16px; /* Prevents iOS auto-zoom */
}

/* ============================================================================
   1Ô∏è‚É£4Ô∏è‚É£ MOBILE-SPECIFIC OPTIMIZATIONS
   ============================================================================ */

@media (max-width: 768px) {
  /* Smooth scrolling on mobile */
  html {
    scroll-behavior: smooth;
  }
  
  /* Ensure all containers respect width */
  * {
    max-width: 100%;
    box-sizing: border-box;
  }
  
  /* Prevent text size adjustments */
  html {
    -webkit-text-size-adjust: 100%;
    -moz-text-size-adjust: 100%;
    -ms-text-size-adjust: 100%;
  }
  
  /* Safe area insets for notch devices (exclude therapist dashboard - it handles safe area in header) */
  body:not(:has(.therapist-page-container)) {
    padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
  }
}

/* ============================================================================
   1Ô∏è‚É£5Ô∏è‚É£ PERFORMANCE OPTIMIZATIONS
   ============================================================================ */

.scroll-container {
  contain: layout style paint; /* CSS containment for performance */
  will-change: scroll-position;
  backface-visibility: hidden;
  transform: translateZ(0); /* Force GPU acceleration */
}

/* ============================================================================
   END OF MOBILE SCROLL GOLD STANDARD
   ============================================================================ */
