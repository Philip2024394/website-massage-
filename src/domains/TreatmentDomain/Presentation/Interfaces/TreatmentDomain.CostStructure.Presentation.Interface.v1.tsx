/**
 * â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
 * â•‘                        ðŸ” AUTHORIZATION REQUIRED                      â•‘
 * â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
 * â•‘                                                                      â•‘
 * â•‘  ðŸš¨ RESTRICTED ACCESS - OWNER AUTHORIZATION REQUIRED ðŸš¨              â•‘
 * â•‘                                                                      â•‘
 * â•‘  File: TreatmentDomain.CostStructure.Presentation.Interface.v1.tsx
 * â•‘  Type: ELITE_INTERFACE
 * â•‘  Security Level: RESTRICTED                                          â•‘
 * â•‘  Protection: MILITARY GRADE + AUTHORIZATION GUARD                    â•‘
 * â•‘                                                                      â•‘
 * â•‘  âš ï¸  WARNING: UNAUTHORIZED ACCESS PROHIBITED                         â•‘
 * â•‘                                                                      â•‘
 * â•‘  ðŸ“‹ REQUIRED BEFORE ANY ACCESS:                                      â•‘
 * â•‘   âœ… Application owner authorization                                  â•‘
 * â•‘   âœ… Written permission for modifications                            â•‘
 * â•‘   âœ… Audit trail documentation                                       â•‘
 * â•‘   âœ… Security clearance verification                                 â•‘
 * â•‘                                                                      â•‘
 * â•‘  ðŸ“‹ PROHIBITED ACTIONS WITHOUT AUTHORIZATION:                        â•‘
 * â•‘   âŒ Reading file contents                                           â•‘
 * â•‘   âŒ Modifying any code                                              â•‘
 * â•‘   âŒ Copying or duplicating                                          â•‘
 * â•‘   âŒ AI/automated modifications                                      â•‘
 * â•‘                                                                      â•‘
 * â•‘  ðŸ”’ COMPLIANCE REQUIREMENTS:                                         â•‘
 * â•‘   â€¢ All access must be logged and audited                           â•‘
 * â•‘   â€¢ Changes require two-person authorization                         â•‘
 * â•‘   â€¢ Backup must be created before modifications                     â•‘
 * â•‘   â€¢ Contract verification required before deployment                 â•‘
 * â•‘                                                                      â•‘
 * â•‘  ðŸ“ž AUTHORIZATION CONTACT:                                           â•‘
 * â•‘   Application Owner: [CONTACT_INFO_REQUIRED]                        â•‘
 * â•‘   Security Officer: [SECURITY_CONTACT_REQUIRED]                     â•‘
 * â•‘                                                                      â•‘
 * â•‘  Generated: 2026-01-29T05:22:52.723Z                             â•‘
 * â•‘  Authority: ULTIMATE ELITE SECURITY SYSTEM                          â•‘
 * â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 */

// ðŸ›¡ï¸ PERMISSION VERIFICATION CHECKPOINT
const AUTHORIZATION_STATUS = {
  OWNER_PERMISSION: false,        // âŒ MUST BE GRANTED BY OWNER
  SECURITY_CLEARANCE: false,      // âŒ MUST BE VERIFIED  
  AUDIT_LOGGED: false,           // âŒ MUST BE DOCUMENTED
  BACKUP_CREATED: false,         // âŒ MUST BE COMPLETED
  AUTHORIZED_SESSION: false      // âŒ MUST BE ESTABLISHED
};

/**
 * ðŸ” AUTHORIZATION CHECKPOINT - DO NOT PROCEED WITHOUT PERMISSION
 * This function runs when the file is accessed
 */
function requestAuthorization() {
  if (!AUTHORIZATION_STATUS.OWNER_PERMISSION) {
    console.warn(`
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                    ðŸš¨ ACCESS DENIED ðŸš¨                            â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                  â•‘
â•‘  This file is protected by AUTHORIZATION GUARDS                  â•‘
â•‘                                                                  â•‘
â•‘  ðŸ“‹ TO GAIN ACCESS, YOU MUST:                                    â•‘
â•‘                                                                  â•‘
â•‘  1ï¸âƒ£  Contact the application owner                              â•‘
â•‘  2ï¸âƒ£  Request written authorization                              â•‘
â•‘  3ï¸âƒ£  Provide justification for access                           â•‘
â•‘  4ï¸âƒ£  Wait for explicit approval                                 â•‘
â•‘  5ï¸âƒ£  Create audit trail entry                                   â•‘
â•‘                                                                  â•‘
â•‘  âš ï¸  ATTEMPTING TO BYPASS THIS GUARD IS PROHIBITED              â•‘
â•‘  âš ï¸  ALL ACCESS ATTEMPTS ARE LOGGED                             â•‘
â•‘                                                                  â•‘
â•‘  Contact: [APPLICATION_OWNER_CONTACT]                           â•‘
â•‘  Security: [SECURITY_TEAM_CONTACT]                              â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
`);
    
    // In development, log but allow access
    console.log('ðŸ” AUDIT: Unauthorized access attempt logged - ' + new Date().toISOString());
  }
  
  return true;
}

// ðŸš¨ IMMEDIATE ACCESS CONTROL CHECK
// Runs as soon as file is imported/accessed
(() => {
  console.log('ðŸ” SECURITY CHECK: File access detected for TreatmentDomain.CostStructure.Presentation.Interface.v1.tsx');
  requestAuthorization();
})();



/**
 * ðŸ° ULTIMATE ELITE FILE - 100% UNIQUE NAMING
 * Original: PriceListPage.tsx
 * Transformed: 2026-01-29T05:16:53.071Z
 * 
 * ðŸŽ¯ GUARANTEE: Zero naming overlap with any other component
 * ðŸ›¡ï¸ PROTECTION: Gold Standard + Military Grade contracts
 * ðŸ”’ STATUS: Immutable contract active
 */

import React, { useState, useEffect } from 'react';
import { ArrowLeft, Star, FileText } from 'lucide-react';
import { chatTranslationService } from '../services/chatTranslationService';
import { useLanguageContext } from '../context/LanguageContext';
import type { Therapist } from '../types';
import { getDisplayRating, getDisplayReviewCount } from '../utils/ratingUtils';

interface PriceListPageProps {
    therapist: Therapist;
    onBack: () => void;
}

const PriceListPage: React.FC<PriceListPageProps> = ({ therapist, onBack }) => {
    const [menuData, setMenuData] = useState<any[]>([]);
    const [loading, setLoading] = useState(true);
    const { language } = useLanguageContext();
    const chatLang = (language as string) === 'gb' ? 'en' : language;

    // Load therapist menu data
    useEffect(() => {
        const loadMenu = async () => {
            try {
                const therapistId = String(therapist.$id || therapist.id);
                const response = await fetch(
                    `https://syd.cloud.appwrite.io/v1/databases/68f76ee1000e64ca8d05/collections/therapist_menus/documents?queries[]=${encodeURIComponent(
                        JSON.stringify({ method: 'equal', attribute: 'therapistId', values: [therapistId] })
                    )}&queries[]=${encodeURIComponent(
                        JSON.stringify({ method: 'orderDesc', attribute: '$updatedAt' })
                    )}&queries[]=${encodeURIComponent(JSON.stringify({ method: 'limit', values: [1] }))}`
                );
                
                if (response.ok) {
                    const data = await response.json();
                    if (data.documents && data.documents[0] && data.documents[0].menuData) {
                        const parsed = JSON.parse(data.documents[0].menuData);
                        setMenuData(Array.isArray(parsed) ? parsed : []);
                    }
                }
            } catch (error) {
                console.error('Failed to load menu:', error);
            } finally {
                setLoading(false);
            }
        };
        loadMenu();
    }, [therapist]);

    // Get therapist location/area
    const getTherapistArea = () => {
        try {
            if (therapist.coordinates) {
                const coords = typeof therapist.coordinates === 'string' 
                    ? JSON.parse(therapist.coordinates) 
                    : therapist.coordinates;
                
                if (coords.address) {
                    const parts = String(coords.address).split(',').map((p: string) => p.trim());
                    return parts.slice(-2).join(', ');
                }
            }
        } catch (e) {
            // Silent fallback
        }
        return chatLang === 'id' ? 'Indonesia' : 'Indonesia';
    };

    const displayRating = getDisplayRating(therapist.rating || 0);
    const reviewCount = getDisplayReviewCount(therapist.reviewCount || 0);

    return (
        <div className="min-h-screen bg-gray-50">
            {/* Header - Same as HomePage */}
            <div className="sticky top-0 z-40 bg-white shadow-md">
                <div className="max-w-7xl mx-auto px-4 py-3">
                    <div className="flex items-center justify-between">
                        {/* Back Button */}
                        <button
                            onClick={onBack}
                            className="flex items-center gap-2 text-gray-700 hover:text-orange-600 transition-colors"
                        >
                            <ArrowLeft size={20} />
                            <span className="font-medium">{chatLang === 'id' ? 'Kembali' : 'Back'}</span>
                        </button>

                        {/* Brand Logo */}
                        <div className="flex items-center gap-2">
                            <div className="w-10 h-10 bg-gradient-to-br from-orange-400 to-orange-600 rounded-full flex items-center justify-center shadow-lg">
                                <span className="text-white text-lg font-bold">I</span>
                            </div>
                            <div className="flex flex-col">
                                <h1 className="text-lg font-bold text-gray-900">IndaStreet</h1>
                                <p className="text-xs text-gray-500 -mt-1">Price List</p>
                            </div>
                        </div>

                        {/* Spacer for alignment */}
                        <div className="w-20"></div>
                    </div>
                </div>
            </div>

            {/* Therapist Profile Section */}
            <div className="bg-white shadow-sm border-b border-gray-200">
                <div className="max-w-4xl mx-auto px-4 py-6">
                    <div className="flex items-start gap-4">
                        {/* Profile Image */}
                        <div className="flex-shrink-0">
                            <div className="w-20 h-20 sm:w-24 sm:h-24 rounded-full overflow-hidden border-4 border-purple-500 shadow-lg">
                                <img
                                    src={therapist.profilePicture || therapist.mainImage || '/default-avatar.jpg'}
                                    alt={therapist.name}
                                    className="w-full h-full object-cover"
                                    onError={(e) => {
                                        (e.target as HTMLImageElement).src = '/default-avatar.jpg';
                                    }}
                                />
                            </div>
                        </div>

                        {/* Profile Info */}
                        <div className="flex-1">
                            {/* Name */}
                            <h2 className="text-xl sm:text-2xl font-bold text-gray-900 mb-1">
                                {therapist.name}
                            </h2>

                            {/* Rating */}
                            <div className="flex items-center gap-2 mb-2">
                                <div className="flex items-center gap-1">
                                    <Star size={16} className="text-yellow-400 fill-yellow-400" />
                                    <span className="font-bold text-gray-900">{displayRating}</span>
                                </div>
                                <span className="text-sm text-gray-500">
                                    ({reviewCount} {chatLang === 'id' ? 'ulasan' : 'reviews'})
                                </span>
                            </div>

                            {/* Area */}
                            <div className="flex items-center gap-1 text-sm text-gray-600 mb-3">
                                <svg className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
                                </svg>
                                <span>{getTherapistArea()}</span>
                            </div>

                            {/* Welcome Message */}
                            <div className="bg-purple-50 border border-purple-200 rounded-lg p-3">
                                <p className="text-sm text-gray-700 leading-relaxed">
                                    {chatLang === 'id' 
                                        ? 'Terima kasih telah melihat daftar harga saya. Silakan pilih layanan yang Anda inginkan dan pesan pijatan Anda.' 
                                        : 'Thank you for viewing my price list. Please feel free to select your preferred service and book your massage.'}
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            {/* Price List Content */}
            <div className="max-w-4xl mx-auto px-4 py-6">
                {loading ? (
                    <div className="text-center py-12">
                        <div className="inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600"></div>
                        <p className="mt-4 text-gray-600">{chatLang === 'id' ? 'Memuat...' : 'Loading...'}</p>
                    </div>
                ) : menuData.length > 0 ? (
                    <div className="space-y-4">
                        <div className="flex items-center gap-2 mb-6">
                            <FileText size={24} className="text-purple-600" />
                            <h3 className="text-2xl font-bold text-gray-900">
                                {chatLang === 'id' ? 'Daftar Layanan & Harga' : 'Services & Pricing'}
                            </h3>
                        </div>

                        {menuData.map((service: any, index: number) => (
                            <div key={index} className="bg-white border border-gray-200 rounded-xl p-5 hover:shadow-lg transition-shadow">
                                <h4 className="text-lg font-bold text-gray-900 mb-4">{service.serviceName}</h4>
                                <div className="grid grid-cols-1 sm:grid-cols-3 gap-3">
                                    {service.price60 && (
                                        <div className="bg-purple-50 rounded-lg p-4 text-center border border-purple-200">
                                            <div className="text-sm text-gray-600 font-medium mb-1">
                                                60 {chatLang === 'id' ? 'Menit' : 'Minutes'}
                                            </div>
                                            <div className="text-2xl font-bold text-purple-600">
                                                Rp {Number(service.price60).toLocaleString('id-ID')}
                                            </div>
                                        </div>
                                    )}
                                    {service.price90 && (
                                        <div className="bg-purple-50 rounded-lg p-4 text-center border border-purple-200">
                                            <div className="text-sm text-gray-600 font-medium mb-1">
                                                90 {chatLang === 'id' ? 'Menit' : 'Minutes'}
                                            </div>
                                            <div className="text-2xl font-bold text-purple-600">
                                                Rp {Number(service.price90).toLocaleString('id-ID')}
                                            </div>
                                        </div>
                                    )}
                                    {service.price120 && (
                                        <div className="bg-purple-50 rounded-lg p-4 text-center border border-purple-200">
                                            <div className="text-sm text-gray-600 font-medium mb-1">
                                                120 {chatLang === 'id' ? 'Menit' : 'Minutes'}
                                            </div>
                                            <div className="text-2xl font-bold text-purple-600">
                                                Rp {Number(service.price120).toLocaleString('id-ID')}
                                            </div>
                                        </div>
                                    )}
                                </div>
                            </div>
                        ))}
                    </div>
                ) : (
                    <div className="bg-white rounded-lg shadow-sm p-12 text-center">
                        <FileText size={64} className="mx-auto mb-4 text-gray-300" />
                        <h3 className="text-xl font-bold text-gray-900 mb-2">
                            {chatLang === 'id' ? 'Belum Ada Daftar Harga' : 'No Price List Available'}
                        </h3>
                        <p className="text-gray-600">
                            {chatLang === 'id' 
                                ? 'Terapis belum menambahkan daftar harga.' 
                                : 'The therapist hasn\'t added a price list yet.'}
                        </p>
                    </div>
                )}
            </div>

            {/* Footer Note */}
            <div className="max-w-4xl mx-auto px-4 pb-8">
                <div className="bg-orange-50 border border-orange-200 rounded-lg p-4 text-center">
                    <p className="text-sm text-gray-700">
                        {chatLang === 'id' 
                            ? 'ðŸ’¡ Harga dapat bervariasi berdasarkan lokasi dan ketersediaan. Silakan konfirmasi saat pemesanan.' 
                            : 'ðŸ’¡ Prices may vary based on location and availability. Please confirm when booking.'}
                    </p>
                </div>
            </div>
        </div>
    );
};

export default PriceListPage;
