<!DOCTYPE html>
<html>
<head>
    <title>ğŸ› Language Save Bug Fix Test</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .success { color: green; }
        .error { color: red; }
        .info { color: blue; }
        .container { max-width: 800px; margin: 0 auto; }
        button { background: #2196F3; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin: 5px; }
        button:hover { background: #1976D2; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ› Language Save Bug Fix Test</h1>
        <p><strong>Bug Found:</strong> The Appwrite service was missing <code>if (data.languages) mappedData.languages = data.languages;</code></p>
        <p><strong>Fix Applied:</strong> Added languages field handler to appwriteService.ts update method</p>
        
        <button onclick="testLanguageSaveFix()">ğŸ”§ Test Language Save Fix</button>
        <div id="results"></div>
    </div>

    <script src="https://unpkg.com/appwrite@15.0.0/dist/iife/sdk.js"></script>
    <script>
        // Appwrite Configuration
        const CONFIG = {
            endpoint: 'https://syd.cloud.appwrite.io/v1',
            projectId: '68f23b11000d25eb3664',
            databaseId: '68f76ee1000e64ca8d05',
            therapistsCollectionId: '68f76ee1001b06e7ba5d'
        };

        // Initialize Appwrite
        const client = new Appwrite.Client()
            .setEndpoint(CONFIG.endpoint)
            .setProject(CONFIG.projectId);

        const databases = new Appwrite.Databases(client);

        function log(message, type = 'info') {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = type;
            div.innerHTML = message;
            results.appendChild(div);
            console.log(message);
        }

        async function testLanguageSaveFix() {
            log('<h2>ğŸ§ª Testing Language Save Fix</h2>');
            
            try {
                // Get Phil4's therapist ID 
                const phil4Id = '690a0a0f002949071cb4';
                
                log('ğŸ” Step 1: Getting current Phil4 data...');
                const current = await databases.getDocument(
                    CONFIG.databaseId,
                    CONFIG.therapistsCollectionId,
                    phil4Id
                );
                
                log(`ğŸ“Š Current languages: "${current.languages}"`, 'info');
                
                log('ğŸ’¾ Step 2: Testing language update with fix...');
                const testLanguages = '["English", "Indonesian", "Mandarin"]';
                
                await databases.updateDocument(
                    CONFIG.databaseId,
                    CONFIG.therapistsCollectionId,
                    phil4Id,
                    {
                        languages: testLanguages
                    }
                );
                
                log('âœ… Update sent successfully!', 'success');
                
                log('ğŸ” Step 3: Verifying save worked...');
                const updated = await databases.getDocument(
                    CONFIG.databaseId,
                    CONFIG.therapistsCollectionId,
                    phil4Id
                );
                
                log(`ğŸ“Š Updated languages: "${updated.languages}"`, updated.languages === testLanguages ? 'success' : 'error');
                
                if (updated.languages === testLanguages) {
                    log('ğŸ‰ BUG FIX SUCCESSFUL! Languages are now saving to database!', 'success');
                } else {
                    log('âŒ Bug still exists - languages not saved correctly', 'error');
                }
                
                log('ğŸ§ª Step 4: Testing parse functionality...');
                try {
                    const parsed = JSON.parse(updated.languages || '[]');
                    log(`âœ… Languages parse correctly: ${parsed.join(', ')}`, 'success');
                } catch (e) {
                    log(`âŒ Parse error: ${e.message}`, 'error');
                }
                
            } catch (error) {
                log(`âŒ Test failed: ${error.message}`, 'error');
                console.error(error);
            }
        }
    </script>
</body>
</html>