<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Therapist Discount Debug Tool</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        .debug-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background-color: #f9f9f9;
        }
        .therapist-item {
            margin: 10px 0;
            padding: 10px;
            border-left: 4px solid #007bff;
            background-color: white;
        }
        .discount-active {
            border-left-color: #28a745;
            background-color: #d4edda;
        }
        .discount-inactive {
            border-left-color: #dc3545;
            background-color: #f8d7da;
        }
        .discount-expired {
            border-left-color: #ffc107;
            background-color: #fff3cd;
        }
        button {
            padding: 10px 15px;
            margin: 5px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            background-color: #007bff;
            color: white;
        }
        button:hover { background-color: #0056b3; }
        .log {
            background-color: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
            white-space: pre-wrap;
            font-family: monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
            font-weight: bold;
        }
        .status-active { color: #28a745; font-weight: bold; }
        .status-inactive { color: #dc3545; }
        .status-expired { color: #ffc107; }
    </style>
</head>
<body>
    <h1>üîç Therapist Discount Debug Tool</h1>
    <p>This tool helps debug discount display issues on therapist cards.</p>

    <div class="debug-section">
        <h3>üè† Mock Data Analysis (HomePage Issue)</h3>
        <button onclick="analyzeMockData()">Analyze Mock Discount Logic</button>
        <div id="mock-analysis" class="log"></div>
    </div>

    <div class="debug-section">
        <h3>üéØ TherapistCard Discount Logic Test</h3>
        <button onclick="testDiscountLogic()">Test isDiscountActive Logic</button>
        <div id="discount-logic" class="log"></div>
    </div>

    <div class="debug-section">
        <h3>üìä Sample Therapist Data</h3>
        <button onclick="generateSampleData()">Generate Test Data</button>
        <div id="sample-data"></div>
    </div>

    <div class="debug-section">
        <h3>üö® Issue Summary</h3>
        <div id="issue-summary">
            <h4>üîç Problem Identified:</h4>
            <div style="background-color: #fff3cd; padding: 15px; border-radius: 5px; border-left: 4px solid #ffc107;">
                <p><strong>Root Cause:</strong> Mock discount data in <code>HomePage.tsx</code> (lines 659-663)</p>
                <p><strong>Impact:</strong> First 4 therapists always show fake discount badges (20%, 15%, 10%, 5%)</p>
                <p><strong>Fix Applied:</strong> Replaced mock data with real discount checking</p>
            </div>
            
            <h4 style="margin-top: 20px;">‚úÖ Solution Implemented:</h4>
            <div style="background-color: #d4edda; padding: 15px; border-radius: 5px; border-left: 4px solid #28a745;">
                <pre style="margin: 0; background: none; padding: 0;">// OLD (Mock data causing fake discounts):
const mockDiscount = hasDiscount ? {
    percentage: index === 0 ? 20 : index === 1 ? 15 : index === 2 ? 10 : 5,
    expiresAt: new Date(Date.now() + (index + 2) * 60 * 60 * 1000)
} : null;

// NEW (Real discount checking):
const realDiscount = (therapist.discountPercentage && 
    therapist.discountPercentage > 0 && 
    therapist.discountEndTime) ? {
    percentage: therapist.discountPercentage,
    expiresAt: new Date(therapist.discountEndTime)
} : null;</pre>
            </div>
        </div>
    </div>

    <script>
        function log(elementId, message) {
            const element = document.getElementById(elementId);
            element.innerHTML += new Date().toLocaleTimeString() + ': ' + message + '\n';
        }

        function analyzeMockData() {
            const logId = 'mock-analysis';
            document.getElementById(logId).innerHTML = '';
            
            log(logId, 'üîç Analyzing HomePage Mock Data Logic:');
            log(logId, '');
            log(logId, 'Original Code (PROBLEMATIC):');
            log(logId, 'const hasDiscount = index < 4;');
            log(logId, 'const mockDiscount = hasDiscount ? {');
            log(logId, '    percentage: index === 0 ? 20 : index === 1 ? 15 : index === 2 ? 10 : 5,');
            log(logId, '    expiresAt: new Date(Date.now() + (index + 2) * 60 * 60 * 1000)');
            log(logId, '} : null;');
            log(logId, '');
            log(logId, 'üìä This creates fake discounts on:');
            log(logId, '  ‚Ä¢ 1st therapist: 20% discount');
            log(logId, '  ‚Ä¢ 2nd therapist: 15% discount');
            log(logId, '  ‚Ä¢ 3rd therapist: 10% discount ‚Üê THIS IS YOUR 10% ISSUE!');
            log(logId, '  ‚Ä¢ 4th therapist: 5% discount');
            log(logId, '');
            log(logId, '‚úÖ Fixed Code:');
            log(logId, 'const realDiscount = (therapist.discountPercentage && ');
            log(logId, '    therapist.discountPercentage > 0 && ');
            log(logId, '    therapist.discountEndTime) ? {');
            log(logId, '    percentage: therapist.discountPercentage,');
            log(logId, '    expiresAt: new Date(therapist.discountEndTime)');
            log(logId, '} : null;');
        }

        function testDiscountLogic() {
            const logId = 'discount-logic';
            document.getElementById(logId).innerHTML = '';
            
            log(logId, 'üß™ Testing isDiscountActive Logic:');
            log(logId, '');
            
            // Test cases
            const testCases = [
                {
                    name: 'No discount set',
                    therapist: { discountPercentage: 0, discountEndTime: null }
                },
                {
                    name: 'Discount set but expired', 
                    therapist: { 
                        discountPercentage: 10, 
                        discountEndTime: new Date(Date.now() - 3600000).toISOString() 
                    }
                },
                {
                    name: 'Active discount',
                    therapist: { 
                        discountPercentage: 15, 
                        discountEndTime: new Date(Date.now() + 3600000).toISOString() 
                    }
                },
                {
                    name: 'Invalid percentage',
                    therapist: { 
                        discountPercentage: null, 
                        discountEndTime: new Date(Date.now() + 3600000).toISOString() 
                    }
                }
            ];

            testCases.forEach(testCase => {
                const result = isDiscountActiveTest(testCase.therapist);
                log(logId, `${testCase.name}: ${result ? '‚úÖ ACTIVE' : '‚ùå INACTIVE'}`);
                log(logId, `  - Percentage: ${testCase.therapist.discountPercentage}`);
                log(logId, `  - End Time: ${testCase.therapist.discountEndTime}`);
                log(logId, '');
            });
        }

        function isDiscountActiveTest(therapist) {
            return !!(
                therapist.discountPercentage && 
                therapist.discountPercentage > 0 && 
                therapist.discountEndTime &&
                (() => {
                    const now = new Date();
                    const endTime = new Date(therapist.discountEndTime);
                    return !isNaN(endTime.getTime()) && endTime > now;
                })()
            );
        }

        function generateSampleData() {
            const container = document.getElementById('sample-data');
            const now = new Date();
            
            const sampleTherapists = [
                { 
                    name: 'John (No Discount)', 
                    discountPercentage: 0, 
                    discountEndTime: null,
                    description: 'Should show NO discount badge'
                },
                { 
                    name: 'Mary (Active 10%)', 
                    discountPercentage: 10, 
                    discountEndTime: new Date(now.getTime() + 2 * 3600000).toISOString(),
                    description: 'Should show 10% discount badge'
                },
                { 
                    name: 'Bob (Expired 15%)', 
                    discountPercentage: 15, 
                    discountEndTime: new Date(now.getTime() - 3600000).toISOString(),
                    description: 'Should show NO discount badge (expired)'
                },
                { 
                    name: 'Lisa (Active 20%)', 
                    discountPercentage: 20, 
                    discountEndTime: new Date(now.getTime() + 4 * 3600000).toISOString(),
                    description: 'Should show 20% discount badge'
                }
            ];

            let html = '<table><tr><th>Therapist</th><th>Discount %</th><th>End Time</th><th>Status</th><th>Expected Display</th></tr>';
            
            sampleTherapists.forEach(therapist => {
                const isActive = isDiscountActiveTest(therapist);
                const status = isActive ? 'ACTIVE' : 'INACTIVE';
                const statusClass = isActive ? 'status-active' : 'status-inactive';
                
                html += `<tr>
                    <td>${therapist.name}</td>
                    <td>${therapist.discountPercentage}%</td>
                    <td>${therapist.discountEndTime || 'None'}</td>
                    <td class="${statusClass}">${status}</td>
                    <td>${therapist.description}</td>
                </tr>`;
            });
            
            html += '</table>';
            container.innerHTML = html;
        }

        // Initialize
        window.onload = function() {
            document.getElementById('issue-summary').style.display = 'block';
        };
    </script>
</body>
</html>