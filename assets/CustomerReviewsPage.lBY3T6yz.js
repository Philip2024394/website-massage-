import{a as r,j as e}from"./vendor-react.DJgHGAhw.js";import{n as b,r as f}from"./route-therapist.DVVqC6AH.js";import"./vendor-appwrite.BT2H32tF.js";import{P as w}from"./route-portals.BJGRQhN_.js";import"./route-booking.yuk30L8G.js";import"./vendor-misc.BCNplu90.js";const L=({user:i,onBack:p})=>{const[o,h]=r.useState([]),[d,u]=r.useState(!0),[l,c]=r.useState({}),[m,g]=r.useState(null);r.useEffect(()=>{(async()=>{try{const s=(await b.getByUser((i==null?void 0:i.$id)||(i==null?void 0:i.userId))).filter(n=>new Date(n.startTime)<new Date);h(s)}catch{}finally{u(!1)}})()},[i]);const x=(t,a,s)=>{c(n=>{const y=n[t]||{rating:0,text:""};return{...n,[t]:{...y,[a]:s}}})},v=async t=>{const a=l[String(t.id)]||{rating:0,text:""};if(!a.rating||a.rating<1){alert("Please select a rating (1-5)");return}g(String(t.id));try{await f.create({providerId:t.providerId.toString(),providerType:t.providerType,rating:a.rating,comment:a.text||"",whatsapp:"",status:"pending"}),c(s=>({...s,[String(t.id)]:{...s[String(t.id)],submitted:!0}})),alert("✅ Review submitted")}catch{alert("❌ Could not submit review")}finally{g(null)}};return e.jsxs("div",{className:"min-h-[calc(100vh-env(safe-area-inset-top)-env(safe-area-inset-bottom))] bg-gray-50 pb-20",children:[e.jsx(w,{pageNumber:302,pageName:"CustomerReviews",isLocked:!1}),e.jsxs("header",{className:"bg-white p-4 shadow-md sticky top-0 z-40 flex items-center justify-between",children:[e.jsx("button",{onClick:p,className:"text-gray-700 hover:text-orange-600 font-semibold",children:"← Back"}),e.jsx("h1",{className:"text-xl font-bold text-gray-800",children:"Leave Reviews"}),e.jsx("div",{})]}),e.jsxs("div",{className:"p-4 space-y-6",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Share feedback about therapists and massage places you have visited."}),d&&e.jsx("p",{className:"text-gray-500",children:"Loading bookings..."}),!d&&o.length===0&&e.jsx("div",{className:"bg-white p-6 rounded-lg shadow text-center text-gray-600",children:"No past bookings available for review yet."}),o.map(t=>{const a=l[String(t.id)];return e.jsxs("div",{className:"bg-white rounded-lg p-4 shadow border border-gray-100 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:t.providerName}),e.jsxs("p",{className:"text-xs text-gray-500",children:[t.providerType," • ",new Date(t.startTime).toLocaleDateString()]})]}),(a==null?void 0:a.submitted)&&e.jsx("span",{className:"text-green-600 text-sm font-semibold",children:"Submitted"})]}),!(a!=null&&a.submitted)&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex items-center gap-2",children:[1,2,3,4,5].map(s=>e.jsx("button",{type:"button",onClick:()=>x(String(t.id),"rating",s),className:"text-2xl ".concat((a==null?void 0:a.rating)>=s?"text-yellow-400":"text-gray-300"," hover:scale-110 transition-transform"),children:"★"},s))}),e.jsx("textarea",{className:"w-full border border-gray-200 rounded p-2 text-sm focus:ring-2 focus:ring-orange-400 focus:border-orange-400",rows:3,placeholder:"Optional comments",value:(a==null?void 0:a.text)||"",onChange:s=>x(String(t.id),"text",s.target.value)}),e.jsx("button",{onClick:()=>v(t),disabled:m===String(t.id),className:"px-4 py-2 rounded bg-orange-500 hover:bg-orange-600 text-white font-semibold text-sm disabled:opacity-50",children:m===String(t.id)?"Submitting...":"Submit Review"})]})]},t.id)})]})]})};export{L as default};
