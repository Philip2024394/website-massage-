import{a as m,j as e,u as M,p as T,m as B,v as F}from"./vendor-react.DJgHGAhw.js";import{B as K}from"./route-booking.yuk30L8G.js";import{r as N,a as L}from"./App.1fxTHtx8.js";import{ah as z,Q as $,O as E,ai as O}from"./route-therapist.DVVqC6AH.js";import"./vendor-appwrite.BT2H32tF.js";import"./vendor-misc.BCNplu90.js";import"./vendor-ui.D6Y-8hbd.js";import"./route-portals.BJGRQhN_.js";import"./route-payment.T2FKxZVj.js";const H=({provider:t,providerType:x,currentUserId:c,currentUserName:f,showAddReview:w=!0,onProviderUpdate:h})=>{const[o,S]=m.useState([]),[g,k]=m.useState({averageRating:$(t.rating,t.reviewCount),totalReviews:z(t.reviewCount),ratingDistribution:{5:0,4:0,3:0,2:0,1:0}}),[y,u]=m.useState(!1),[r,l]=m.useState({rating:5,comment:""}),[p,d]=m.useState(!1),[C,D]=m.useState(!1);m.useEffect(()=>{j(),c&&D(N.canUserReview(c,t.id,x))},[t.id,x,c]);const j=()=>{const a=N.getProviderReviews(t.id,x),n=N.getProviderReviewSummary(t.id,x);S(a),k(n)},P=async a=>{if(a.preventDefault(),!c||!f){alert("Please log in to leave a review");return}if(!r.comment.trim()){alert("Please write a comment");return}d(!0);try{const n=t.location||"Indonesia";N.addReview(t.id,x,c,f,r.rating,r.comment,n);const b=N.updateProviderRating(t,r.rating);j(),u(!1),l({rating:5,comment:""}),D(!1),h&&h(b),alert("Review submitted successfully!")}catch(n){alert(n instanceof Error?n.message:"Failed to submit review")}finally{d(!1)}},s=(a,n="md")=>{const b={sm:"w-3 h-3",md:"w-4 h-4",lg:"w-5 h-5"};return e.jsx("div",{className:"flex items-center gap-0.5",children:[1,2,3,4,5].map(R=>e.jsx(T,{className:"".concat(b[n]," ").concat(R<=a?"fill-yellow-400 text-yellow-400":"text-gray-300")},R))})},i=()=>e.jsx("div",{className:"space-y-1",children:[5,4,3,2,1].map(a=>{const n=g.ratingDistribution[a],b=g.totalReviews>0?n/g.totalReviews*100:0;return e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"w-8",children:a}),e.jsx(T,{className:"w-3 h-3 fill-yellow-400 text-yellow-400"}),e.jsx("div",{className:"flex-1 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-yellow-400 h-2 rounded-full transition-all duration-300",style:{width:"".concat(b,"%")}})}),e.jsx("span",{className:"w-8 text-gray-600",children:n})]},a)})}),v=a=>new Date(a).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"});return e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-800",children:"Reviews & Ratings"}),w&&C&&c&&e.jsxs("button",{onClick:()=>u(!y),className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors flex items-center gap-2",children:[e.jsx(M,{className:"w-4 h-4"}),"Write Review"]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-4xl font-bold text-gray-800 mb-2",children:E($(t.rating,t.reviewCount))}),s($(t.rating,t.reviewCount),"lg"),e.jsxs("div",{className:"text-gray-600 mt-2",children:["Based on ",z(t.reviewCount)," reviews"]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-800 mb-3",children:"Rating Distribution"}),i()]})]}),y&&e.jsxs("div",{className:"border-t pt-6 mb-6",children:[e.jsx("h4",{className:"font-medium text-gray-800 mb-4",children:"Write a Review"}),e.jsxs("form",{onSubmit:P,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Rating"}),e.jsx("div",{className:"flex gap-1",children:[1,2,3,4,5].map(a=>e.jsx("button",{type:"button",onClick:()=>l({...r,rating:a}),className:"focus:outline-none",children:e.jsx(T,{className:"w-6 h-6 ".concat(a<=r.rating?"fill-yellow-400 text-yellow-400":"text-gray-300 hover:text-yellow-300")})},a))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Comment"}),e.jsx("textarea",{value:r.comment,onChange:a=>l({...r,comment:a.target.value}),rows:4,className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Share your experience...",required:!0})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"submit",disabled:p,className:"bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:p?"Submitting...":"Submit Review"}),e.jsx("button",{type:"button",onClick:()=>u(!1),className:"border border-gray-300 text-gray-700 px-6 py-2 rounded-lg hover:bg-gray-50 transition-colors",children:"Cancel"})]})]})]}),e.jsxs("div",{className:"border-t pt-6",children:[e.jsx("h4",{className:"font-medium text-gray-800 mb-4",children:"Recent Reviews"}),o.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(M,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{children:"No reviews yet. Be the first to leave a review!"})]}):e.jsxs("div",{className:"space-y-4",children:[o.slice(0,5).map(a=>e.jsx("div",{className:"border-b border-gray-100 pb-4 last:border-0",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gray-200 rounded-full flex items-center justify-center",children:e.jsx(B,{className:"w-5 h-5 text-gray-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"font-medium text-gray-800",children:a.userName}),a.isVerified&&e.jsx("div",{title:"Verified booking",children:e.jsx(F,{className:"w-4 h-4 text-green-500"})})]}),e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s(a.rating,"sm"),e.jsx("span",{className:"text-sm text-gray-500",children:v(a.createdAt)})]}),e.jsx("p",{className:"text-gray-700 text-sm leading-relaxed",children:a.comment})]})]})},a.id)),o.length>5&&e.jsx("div",{className:"text-center pt-4",children:e.jsxs("button",{className:"text-blue-600 hover:text-blue-800 font-medium",children:["Show all ",o.length," reviews"]})})]})]})]})},I=({className:t})=>e.jsx("svg",{className:t,viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M.057 24l1.687-6.163c-1.041-1.804-1.588-3.849-1.587-5.946.003-6.556 5.338-11.891 11.893-11.891 3.181.001 6.167 1.24 8.413 3.488 2.245 2.248 3.481 5.236 3.48 8.414-.003 6.557-5.338 11.892-11.894 11.892-1.99 0-3.903-.52-5.614-1.486L.057 24zM6.591 17.419c.404.652.812 1.272 1.242 1.85 1.58 2.116 3.663 3.22 5.953 3.218 5.55-.006 10.038-4.488 10.043-10.038.005-5.55-4.488-10.038-10.038-10.043-5.55.005-10.038 4.488-10.043 10.038.002 2.13.642 4.148 1.822 5.898l-1.03 3.766 3.844-1.025z"})}),Z=({place:t,onBack:x,onQuickBookWithChat:c,onIncrementAnalytics:f,onShowRegisterPrompt:w,isCustomerLoggedIn:h=!1,t:o,loggedInProviderId:S,agentCode:g})=>{const[k,y]=m.useState(t.mainImage);o==null||o.contactButton;const u=typeof t.massageTypes=="string"?JSON.parse(t.massageTypes):t.massageTypes,r=typeof t.pricing=="string"?JSON.parse(t.pricing):t.pricing,l=t.discountPercentage&&t.discountPercentage>0,p=s=>l?Math.round(s*(1-t.discountPercentage/100)):s,d=s=>s.toLocaleString("en-US",{minimumIntegerDigits:3,useGrouping:!1});m.useEffect(()=>{L.trackProfileView(t.id,"place",void 0).catch(s=>{}),f("views")},[t.id,f]);const C=()=>{const s=typeof t.id=="string"?parseInt(t.id):t.id;S!==s&&O.createWhatsAppContactNotification({userId:String(s),providerName:t.name,customerName:"Customer"}).catch(i=>{}),L.trackWhatsAppClick(t.id,"place",void 0).catch(i=>{}),f("whatsapp_clicks"),window.open("https://wa.me/".concat(t.whatsappNumber),"_blank")},j=(()=>{if(!t.openingTime||!t.closingTime)return{text:"N/A",color:"bg-gray-500"};try{const s=new Date,i=s.getHours()*60+s.getMinutes(),[v,a]=t.openingTime.split(":").map(Number),n=v*60+a,[b,R]=t.closingTime.split(":").map(Number),A=b*60+R;return i>=n&&i<=A?{text:"Open",color:"bg-green-500"}:{text:"Closed",color:"bg-red-500"}}catch{return{text:"N/A",color:"bg-gray-500"}}})(),P=async()=>{try{const s=new URL(window.location.href);g&&s.searchParams.set("agent",g),s.searchParams.get("provider")||s.searchParams.set("provider","place-".concat(t.id));const i=s.toString(),v={title:"".concat(t.name," â€“ IndaStreet Massage Place"),text:"Check out ".concat(t.name," on IndaStreet"),url:i};navigator.share?await navigator.share(v):(await navigator.clipboard.writeText(i),alert("Link copied to clipboard"))}catch{try{const s=new URL(window.location.href);g&&s.searchParams.set("agent",g),s.searchParams.get("provider")||s.searchParams.set("provider","place-".concat(t.id)),await navigator.clipboard.writeText(s.toString()),alert("Link copied to clipboard")}catch{}}};return e.jsxs("div",{className:"min-h-[calc(100vh-env(safe-area-inset-top)-env(safe-area-inset-bottom))] bg-white",children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{className:"w-full h-64 object-cover",src:k,alt:t.name}),e.jsx("div",{className:"absolute inset-0 bg-black/20"}),e.jsx("button",{onClick:x,className:"absolute top-4 left-4 bg-white/70 rounded-full p-2 text-gray-800 hover:bg-white transition-colors z-10",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),e.jsx("button",{onClick:P,title:"Share",className:"absolute top-4 left-16 bg-white/70 rounded-full p-2 text-gray-800 hover:bg-white transition-colors z-10",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.367 2.684 3 3 0 00-5.367-2.684z"})})}),e.jsx("span",{className:"absolute top-4 right-4 px-3 py-1 rounded-full text-white font-bold text-sm ".concat(j.color," z-10 shadow-lg"),children:j.text})]}),e.jsxs("div",{className:"p-4 pb-20",children:[e.jsx("div",{className:"grid grid-cols-3 gap-2 mb-4",children:t.thumbnailImages.map((s,i)=>e.jsx("img",{src:s,alt:"".concat(t.name," thumbnail ").concat(i+1),className:"w-full h-24 object-cover rounded-lg shadow-sm cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>y(s)},i))}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:t.name}),t.openingTime&&t.closingTime&&e.jsxs("p",{className:"text-sm text-gray-500 mt-1 font-medium",children:["Today's Hours: ",t.openingTime," - ",t.closingTime]}),e.jsx("p",{className:"mt-2 text-gray-600",children:t.description})]}),e.jsxs("div",{className:"px-4 py-2",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-800 mb-3",children:"Services Offered"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:u&&Array.isArray(u)&&u.map(s=>e.jsx("span",{className:"px-3 py-1 bg-gray-100 text-gray-800 text-sm font-medium rounded-full",children:s},s))})]}),e.jsxs("div",{className:"px-4 py-2 mt-4",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-800 mb-2",children:o.pricingTitle}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 text-center text-sm text-gray-600",children:[e.jsxs("div",{className:"bg-brand-green-light p-3 rounded-lg border border-gray-200 shadow-md relative transition-all duration-500 ".concat(l?"shadow-orange-500/60 shadow-xl ring-4 ring-orange-400/40 bg-gradient-to-br from-orange-50 to-orange-100 animate-pulse border-orange-300":""),children:[e.jsx("p",{children:"60 min"}),l?e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"font-bold text-lg text-brand-green-dark",children:["Rp ",d(p(Number(r[60]))),"K"]}),e.jsxs("span",{className:"absolute -top-2 -right-2 bg-red-500 text-white text-xs font-bold rounded-full w-10 h-10 flex items-center justify-center shadow-lg animate-bounce",children:["-",t.discountPercentage,"%"]})]}):e.jsxs("p",{className:"font-bold text-lg text-brand-green-dark",children:["Rp ",d(Number(r[60])),"K"]})]}),e.jsxs("div",{className:"bg-brand-green-light p-3 rounded-lg border border-gray-200 shadow-md relative transition-all duration-500 ".concat(l?"shadow-orange-500/60 shadow-xl ring-4 ring-orange-400/40 bg-gradient-to-br from-orange-50 to-orange-100 animate-pulse border-orange-300":""),children:[e.jsx("p",{children:"90 min"}),l?e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"font-bold text-lg text-brand-green-dark",children:["Rp ",d(p(Number(r[90]))),"K"]}),e.jsxs("span",{className:"absolute -top-2 -right-2 bg-red-500 text-white text-xs font-bold rounded-full w-10 h-10 flex items-center justify-center shadow-lg animate-bounce",children:["-",t.discountPercentage,"%"]})]}):e.jsxs("p",{className:"font-bold text-lg text-brand-green-dark",children:["Rp ",d(Number(r[90])),"K"]})]}),e.jsxs("div",{className:"bg-brand-green-light p-3 rounded-lg border border-gray-200 shadow-md relative transition-all duration-500 ".concat(l?"shadow-orange-500/60 shadow-xl ring-4 ring-orange-400/40 bg-gradient-to-br from-orange-50 to-orange-100 animate-pulse border-orange-300":""),children:[e.jsx("p",{children:"120 min"}),l?e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"font-bold text-lg text-brand-green-dark",children:["Rp ",d(p(Number(r[120]))),"K"]}),e.jsxs("span",{className:"absolute -top-2 -right-2 bg-red-500 text-white text-xs font-bold rounded-full w-10 h-10 flex items-center justify-center shadow-lg animate-bounce",children:["-",t.discountPercentage,"%"]})]}):e.jsxs("p",{className:"font-bold text-lg text-brand-green-dark",children:["Rp ",d(Number(r[120])),"K"]})]})]})]}),e.jsx("div",{className:"p-4 pb-20",children:e.jsx(H,{provider:t,providerType:"place",currentUserId:h?"customer-123":void 0,currentUserName:h?"Customer":void 0,showAddReview:h})}),e.jsxs("div",{className:"p-4 pb-20 mt-4 sticky bottom-0 bg-white border-t flex gap-2",children:[e.jsxs("button",{onClick:()=>{C()},className:"w-1/2 flex items-center justify-center gap-2 bg-green-500 text-white font-bold py-3 px-4 rounded-lg hover:bg-green-600 transition-colors duration-300 shadow-md",children:[e.jsx(I,{className:"w-5 h-5"}),e.jsx("span",{children:o.contactButton})]}),e.jsxs(K,{onClick:()=>{if(!h){w==null||w();return}c==null||c(t)},className:"w-1/2 shadow-md",children:["ðŸ“… ",o.bookButton]})]})]})};export{Z as default};
