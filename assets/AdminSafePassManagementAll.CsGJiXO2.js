import{a as r,j as e,S as A,aw as B,m as D,v as S,h as $,a8 as C,ax as K,ae as Y}from"./vendor-react.DJgHGAhw.js";import{Databases as q,Query as n,Client as z,ID as H}from"./vendor-appwrite.BT2H32tF.js";const j=new z().setEndpoint("https://syd.cloud.appwrite.io/v1").setProject("68f23b11000d25eb3664"),o=new q(j),d="68f76ee1000e64ca8d05",p="safepass",Q="therapists_collection_id",X="places_collection_id",Z=()=>{const[b,E]=r.useState([]),[v,I]=r.useState([]),[m,T]=r.useState(new Map),[h,P]=r.useState(!0),[w,F]=r.useState("all"),[x,L]=r.useState("all"),[N,R]=r.useState(""),[_,f]=r.useState(null),[y]=r.useState("standard_ffc9f16272e2199be5aacef2d433ebd35cc6dec8458c781e1c459f8dea17673a42d636315964019645878affbf69fb46559adf188ad8bd435e8506070c9e00d8c2e2af426147662a99058068a864d78205f04caac2f621285cf0f7e59e5159a37a26455e88d666dddb97cbb1a54c9a16234e00c02a5283b95617f8a62ff87bb2");r.useEffect(()=>{u()},[]);const u=async()=>{P(!0);try{j.setKey(y);const[s,a,t]=await Promise.all([V(),O(),M()]);E(s),I(a);const i=new Map;t.forEach(l=>{i.set(l.entityId,l)}),T(i)}catch{}finally{P(!1)}},V=async()=>{try{let s=[],a=!0,t=0;const i=100;for(;a;){const l=await o.listDocuments(d,Q,[n.limit(i),n.offset(t)]);s=[...s,...l.documents],a=l.documents.length===i,t+=i}return s.map(l=>({$id:l.$id,name:l.name||"Unnamed Therapist",email:l.email,location:l.location||l.city,city:l.city,type:"therapist"}))}catch{return[]}},O=async()=>{try{let s=[],a=!0,t=0;const i=100;for(;a;){const l=await o.listDocuments(d,X,[n.limit(i),n.offset(t)]);s=[...s,...l.documents],a=l.documents.length===i,t+=i}return s.map(l=>({$id:l.$id,name:l.name||l.placeName||"Unnamed Place",email:l.email,location:l.location||l.address||l.city,city:l.city,type:"place"}))}catch{return[]}},M=async()=>{try{let s=[],a=!0,t=0;const i=100;for(;a;){const l=await o.listDocuments(d,p,[n.limit(i),n.offset(t)]);s=[...s,...l.documents],a=l.documents.length===i,t+=i}return s}catch{return[]}},k=async s=>{f(s.$id);try{j.setKey(y);const a=new Date().toISOString(),t=new Date;t.setFullYear(t.getFullYear()+1);const i=m.get(s.$id);i?await o.updateDocument(d,p,i.$id,{hotelVillaSafePassStatus:"active",hasSafePassVerification:!0,safePassIssuedAt:a,safePassExpiry:t.toISOString()}):await o.createDocument(d,p,H.unique(),{entityType:s.type,entityId:s.$id,entityName:s.name,hotelVillaSafePassStatus:"active",hasSafePassVerification:!0,safePassIssuedAt:a,safePassExpiry:t.toISOString(),safePassSubmittedAt:a,safePassApprovedAt:a,safePassApprovedBy:localStorage.getItem("adminId")||"admin"}),await u(),alert("âœ… SafePass activated for ".concat(s.name,"\nValid until: ").concat(t.toLocaleDateString()))}catch(a){alert("âŒ Failed to activate SafePass: ".concat(a.message))}finally{f(null)}},U=async s=>{if(confirm("Are you sure you want to deactivate SafePass for ".concat(s.name,"?"))){f(s.$id);try{j.setKey(y);const a=m.get(s.$id);a&&(await o.updateDocument(d,p,a.$id,{hotelVillaSafePassStatus:"rejected",hasSafePassVerification:!1,safePassRejectionReason:"Deactivated by admin"}),await u(),alert("âœ… SafePass deactivated for ".concat(s.name)))}catch(a){alert("âŒ Failed to deactivate SafePass: ".concat(a.message))}finally{f(null)}}},g=(()=>{let s=[];if((x==="all"||x==="therapist")&&(s=[...s,...b]),(x==="all"||x==="place")&&(s=[...s,...v]),s=s.map(a=>{const t=m.get(a.$id);return{...a,safePassStatus:(t==null?void 0:t.hotelVillaSafePassStatus)||null,safePassExpiry:t==null?void 0:t.safePassExpiry,safePassIssuedAt:t==null?void 0:t.safePassIssuedAt}}),w==="active"?s=s.filter(a=>a.safePassStatus==="active"):w==="inactive"&&(s=s.filter(a=>!a.safePassStatus||a.safePassStatus!=="active")),N){const a=N.toLowerCase();s=s.filter(t=>{var i,l;return t.name.toLowerCase().includes(a)||((i=t.email)==null?void 0:i.toLowerCase().includes(a))||((l=t.location)==null?void 0:l.toLowerCase().includes(a))})}return s.sort((a,t)=>a.safePassStatus==="active"&&t.safePassStatus!=="active"?-1:a.safePassStatus!=="active"&&t.safePassStatus==="active"?1:a.name.localeCompare(t.name)),s})(),c={totalTherapists:b.length,totalPlaces:v.length,activeTherapists:b.filter(s=>{var a;return((a=m.get(s.$id))==null?void 0:a.hotelVillaSafePassStatus)==="active"}).length,activePlaces:v.filter(s=>{var a;return((a=m.get(s.$id))==null?void 0:a.hotelVillaSafePassStatus)==="active"}).length};return e.jsxs("div",{className:"min-h-screen bg-gray-50 py-8 px-4",children:[e.jsxs("div",{className:"max-w-7xl mx-auto mb-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center gap-3",children:[e.jsx(A,{className:"w-8 h-8 text-orange-600"}),"SafePass Management"]}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Activate and manage SafePass for all therapists and places"})]}),e.jsxs("button",{onClick:u,disabled:h,className:"px-4 py-2 bg-orange-600 hover:bg-orange-700 text-white rounded-lg font-medium transition-colors disabled:opacity-50 flex items-center gap-2",children:[e.jsx(B,{className:"w-4 h-4 ".concat(h?"animate-spin":"")}),"Refresh"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsx("div",{className:"bg-white rounded-lg shadow p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Therapists"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:c.totalTherapists})]}),e.jsx(D,{className:"w-8 h-8 text-purple-600"})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Active Therapists"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:c.activeTherapists})]}),e.jsx(S,{className:"w-8 h-8 text-green-600"})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Places"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:c.totalPlaces})]}),e.jsx($,{className:"w-8 h-8 text-blue-600"})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Active Places"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:c.activePlaces})]}),e.jsx(S,{className:"w-8 h-8 text-green-600"})]})})]}),e.jsx("div",{className:"bg-white rounded-lg shadow p-4",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(C,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",value:N,onChange:s=>R(s.target.value),placeholder:"Search by name, email, or location...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500"})]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(K,{className:"w-5 h-5 text-gray-400 self-center"}),["all","therapist","place"].map(s=>e.jsxs("button",{onClick:()=>L(s),className:"px-4 py-2 rounded-lg font-medium transition-colors ".concat(x===s?"bg-orange-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:[s.charAt(0).toUpperCase()+s.slice(1),"s"]},s))]}),e.jsx("div",{className:"flex gap-2",children:["all","active","inactive"].map(s=>e.jsx("button",{onClick:()=>F(s),className:"px-4 py-2 rounded-lg font-medium transition-colors ".concat(w===s?"bg-orange-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:s.charAt(0).toUpperCase()+s.slice(1)},s))})]})})]}),e.jsxs("div",{className:"max-w-7xl mx-auto",children:[h?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-orange-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Loading entities..."})]}):g.length===0?e.jsxs("div",{className:"bg-white rounded-lg shadow p-12 text-center",children:[e.jsx(C,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"No Results Found"}),e.jsx("p",{className:"text-gray-600",children:"Try adjusting your filters or search term."})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:g.map(s=>{const a=s.safePassStatus==="active",t=_===s.$id;return e.jsxs("div",{className:"bg-white rounded-lg shadow hover:shadow-lg transition-shadow p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[e.jsx("div",{className:"p-2 rounded-lg ".concat(s.type==="therapist"?"bg-purple-100":"bg-blue-100"),children:s.type==="therapist"?e.jsx(D,{className:"w-5 h-5 text-purple-600"}):e.jsx($,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-bold text-gray-900 truncate",children:s.name}),e.jsx("p",{className:"text-sm text-gray-600 capitalize",children:s.type})]})]}),a&&e.jsx("div",{className:"flex-shrink-0",children:e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800",children:[e.jsx(A,{className:"w-3 h-3 mr-1"}),"Active"]})})]}),e.jsxs("div",{className:"space-y-2 mb-4 text-sm",children:[s.email&&e.jsxs("p",{className:"text-gray-600 truncate",children:["ðŸ“§ ",s.email]}),s.location&&e.jsxs("p",{className:"text-gray-600 truncate",children:["ðŸ“ ",s.location]}),a&&s.safePassIssuedAt&&e.jsxs("p",{className:"text-gray-600",children:["ðŸ—“ï¸ Issued: ",new Date(s.safePassIssuedAt).toLocaleDateString()]}),a&&s.safePassExpiry&&e.jsxs("p",{className:"text-gray-600",children:["â° Expires: ",new Date(s.safePassExpiry).toLocaleDateString()]})]}),a?e.jsx("button",{onClick:()=>U(s),disabled:t,className:"w-full px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg font-medium transition-colors disabled:opacity-50 flex items-center justify-center gap-2",children:t?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Processing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Y,{className:"w-4 h-4"}),"Deactivate SafePass"]})}):e.jsx("button",{onClick:()=>k(s),disabled:t,className:"w-full px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg font-medium transition-colors disabled:opacity-50 flex items-center justify-center gap-2",children:t?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Processing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(S,{className:"w-4 h-4"}),"Activate SafePass"]})})]},s.$id)})}),!h&&g.length>0&&e.jsxs("div",{className:"mt-4 text-center text-gray-600",children:["Showing ",g.length," of ",c.totalTherapists+c.totalPlaces," total entities"]})]})]})};export{Z as default};
