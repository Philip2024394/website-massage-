import{c as u}from"./route-therapist.DVVqC6AH.js";import{s as o}from"./App.1fxTHtx8.js";import"./vendor-appwrite.BT2H32tF.js";import"./vendor-react.DJgHGAhw.js";import"./route-booking.yuk30L8G.js";import"./vendor-misc.BCNplu90.js";import"./route-portals.BJGRQhN_.js";import"./vendor-ui.D6Y-8hbd.js";import"./route-payment.T2FKxZVj.js";async function _(l="protected action"){var n,i,c;try{const e=o.get();if(e!=null&&e.hasSession&&((n=e.user)!=null&&n.$id))return{success:!0,userId:e.user.$id,isAnonymous:((i=e.user.labels)==null?void 0:i.includes("guest"))||!1};try{const s=await Promise.race([u.get(),new Promise((t,r)=>setTimeout(()=>r(new Error("timeout")),3e3))]);if(s!=null&&s.$id){o.set(!0,s);const t=((c=s.labels)==null?void 0:c.includes("guest"))||!1;return{success:!0,userId:s.$id,isAnonymous:t}}}catch{}try{await Promise.race([u.createAnonymousSession(),new Promise((t,r)=>setTimeout(()=>r(new Error("timeout")),5e3))]);const s=await u.get();return o.set(!0,s),{success:!0,userId:s.$id,isAnonymous:!0}}catch(s){const t=(s==null?void 0:s.code)||(s==null?void 0:s.status),r=(s==null?void 0:s.message)||"";if(t===429||r.includes("429"))return{success:!1,userId:null,isAnonymous:!1,error:"rate_limit"};if(t===501||r.includes("501"))return{success:!1,userId:null,isAnonymous:!1,error:"anonymous_disabled"};if(r.includes("already exists"))try{const a=await u.get();return o.set(!0,a),{success:!0,userId:a.$id,isAnonymous:!0}}catch{return{success:!1,userId:null,isAnonymous:!1,error:"session_fetch_failed"}}return{success:!1,userId:null,isAnonymous:!1,error:r||"unknown_error"}}}catch(e){return{success:!1,userId:null,isAnonymous:!1,error:e.message||"unexpected_error"}}}export{_ as ensureAuthSession};
