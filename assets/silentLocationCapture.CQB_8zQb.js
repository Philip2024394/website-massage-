const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/route-therapist.DVVqC6AH.js","assets/vendor-appwrite.BT2H32tF.js","assets/vendor-react.DJgHGAhw.js","assets/route-booking.yuk30L8G.js","assets/vendor-misc.BCNplu90.js","assets/route-portals.BJGRQhN_.js","assets/route-therapist.ChBoUtyP.css"])))=>i.map(i=>d[i]);
import{l as s,_ as g}from"./route-therapist.DVVqC6AH.js";import{h as p}from"./App.1fxTHtx8.js";import"./vendor-appwrite.BT2H32tF.js";import"./vendor-react.DJgHGAhw.js";import"./route-booking.yuk30L8G.js";import"./vendor-misc.BCNplu90.js";import"./route-portals.BJGRQhN_.js";import"./vendor-ui.D6Y-8hbd.js";import"./route-payment.T2FKxZVj.js";const u="silentLocationCapture",_=24,$=async()=>{try{s.debug("ðŸŒ Facebook-style: Silently capturing location...");const e=f();if(e&&!S(e))return s.debug("âœ“ Using cached location:",e),e;const t=await p();if(t){const n={lat:t.lat,lng:t.lng,address:"Auto-detected location",timestamp:new Date().toISOString(),verified:!0};try{localStorage.setItem(u,JSON.stringify(n)),s.debug("ðŸ’¾ Location stored for chat system")}catch(r){s.warn("Failed to store location:",r)}return n}return null}catch(e){return s.debug("â„¹ï¸ Silent location capture failed (normally):",e instanceof Error?e.message:e),null}},f=()=>{try{const e=localStorage.getItem(u);if(e)return JSON.parse(e)}catch(e){s.warn("Failed to retrieve stored location:",e)}return null},S=e=>{if(!e.timestamp)return!0;const t=new Date(e.timestamp).getTime();return(new Date().getTime()-t)/(1e3*60*60)>_},b=async e=>{try{const{GOOGLE_MAPS_API_KEY:t}=await g(async()=>{const{GOOGLE_MAPS_API_KEY:n}=await import("./route-therapist.DVVqC6AH.js").then(r=>r.bt);return{GOOGLE_MAPS_API_KEY:n}},__vite__mapDeps([0,1,2,3,4,5,6]));if(t){const n="https://maps.googleapis.com/maps/api/geocode/json?latlng=".concat(e.lat,",").concat(e.lng,"&key=").concat(t,"&language=en"),a=await(await fetch(n)).json();if(a.status==="OK"&&a.results&&a.results.length>0){const d=a.results[0].formatted_address,c=a.results[0].address_components,i=c.find(o=>o.types.includes("locality")||o.types.includes("administrative_area_level_2")),m=c.find(o=>o.types.includes("sublocality")||o.types.includes("sublocality_level_1"));let l=e.address;return m&&i?l="".concat(m.long_name,", ").concat(i.long_name):i?l=i.long_name:l=d.split(",").slice(0,2).join(", "),{lat:e.lat,lng:e.lng,address:l||d,verified:!0,timestamp:new Date().toISOString()}}}return{lat:e.lat,lng:e.lng,address:e.address||"".concat(e.lat.toFixed(4),", ").concat(e.lng.toFixed(4)),verified:!1,timestamp:new Date().toISOString()}}catch(t){return s.warn("Location enhancement failed:",t),{lat:e.lat,lng:e.lng,address:e.address||"".concat(e.lat.toFixed(4),", ").concat(e.lng.toFixed(4)),verified:!1,timestamp:new Date().toISOString()}}};export{$ as captureSilentLocation,b as enhanceLocation,f as getStoredLocation,S as isLocationExpired};
