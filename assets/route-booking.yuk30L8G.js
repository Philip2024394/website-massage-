const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/route-therapist.DVVqC6AH.js","assets/vendor-appwrite.BT2H32tF.js","assets/vendor-react.DJgHGAhw.js","assets/vendor-misc.BCNplu90.js","assets/route-portals.BJGRQhN_.js","assets/route-therapist.ChBoUtyP.css"])))=>i.map(i=>d[i]);
var K=Object.defineProperty;var Z=(n,e,a)=>e in n?K(n,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[e]=a;var A=(n,e,a)=>Z(n,typeof e!="symbol"?e+"":e,a);import{j as t,a as p,Y as R,n as M,v as J,P as X,M as H,_ as ee,J as te,X as ae,L as ie}from"./vendor-react.DJgHGAhw.js";import{g as d,l as g,F as se,h as ne,A as f,d as O,_ as oe,s as L}from"./route-therapist.DVVqC6AH.js";import"./vendor-appwrite.BT2H32tF.js";import{C as Y}from"./vendor-misc.BCNplu90.js";const re=({children:n,className:e,variant:a="primary",...i})=>{const s="w-full font-bold py-3 px-4 rounded-lg focus:outline-none focus:ring-2 focus:ring-offset-2 transition-colors duration-300 disabled:opacity-50",o={primary:"bg-orange-500 text-white hover:bg-orange-600 focus:ring-orange-500",secondary:"bg-gray-200 text-gray-800 hover:bg-gray-300 focus:ring-gray-400",outline:"bg-white text-orange-500 border-2 border-orange-500 hover:bg-orange-50 focus:ring-orange-500"};return t.jsx("button",{className:"".concat(s," ").concat(o[a]," ").concat(e||""),...i,children:n})};class le{constructor(){A(this,"audioContext",null);A(this,"audioCache",new Map);A(this,"activeSounds",new Map);A(this,"masterVolume",.7);A(this,"activeAlerts",new Map);A(this,"autoplayEnabled",!1);this.initializeAudioContext()}async initializeAudioContext(){try{this.audioContext=new(window.AudioContext||window.webkitAudioContext)}catch(e){d.warn("Audio context not available:",e)}}async loadSound(e){var a;if(this.audioCache.has(e))return this.audioCache.get(e);try{const i=await fetch(e);if(!i.ok)throw new Error("HTTP ".concat(i.status,": ").concat(i.statusText));const s=await i.arrayBuffer(),o=await this.audioContext.decodeAudioData(s);return this.audioCache.set(e,o),o}catch{d.warn("Sound file not found: ".concat(e,", using generated tone fallback"));const s=((a=e.split("/").pop())==null?void 0:a.replace(".mp3",""))||"";return this.generateFallbackTone(s)}}generateFallbackTone(e){if(!this.audioContext)return null;const a=this.audioContext.sampleRate;let i=440,s=.3;switch(e){case"booking-request":i=800,s=.5;break;case"therapist-alert":i=750,s=.4;break;case"user-success":i=523,s=.6;break;case"user-alert":i=600,s=.5;break;case"notification":i=440,s=.2;break;case"booking-cancelled":i=300,s=.4;break;default:i=440,s=.3}const o=Math.floor(a*s),l=this.audioContext.createBuffer(1,o,a),c=l.getChannelData(0);for(let r=0;r<o;r++){const u=r/a;let y=.3;r<a*.05?y*=r/(a*.05):r>o-a*.1&&(y*=(o-r)/(a*.1)),c[r]=Math.sin(2*Math.PI*i*u)*y}return this.audioCache.set("/sounds/".concat(e,".mp3"),l),l}async playSound(e,a={}){var i;if(!(!this.audioContext&&(await this.initializeAudioContext(),!this.audioContext)))try{const s="/sounds/".concat(e,".mp3"),o=await this.loadSound(s);if(!o)return;!a.loop&&this.activeSounds.has(e)&&((i=this.activeSounds.get(e))==null||i.stop(),this.activeSounds.delete(e));const l=this.audioContext.createBufferSource(),c=this.audioContext.createGain();l.buffer=o,l.loop=a.loop||!1;const r={low:.3,normal:.7,high:1,urgent:1.2}[a.priority||"normal"],u=(a.volume||.8)*this.masterVolume*r;a.fadeIn?(c.gain.setValueAtTime(0,this.audioContext.currentTime),c.gain.linearRampToValueAtTime(u,this.audioContext.currentTime+.5)):c.gain.setValueAtTime(u,this.audioContext.currentTime),l.connect(c),c.connect(this.audioContext.destination),l.onended=()=>{this.activeSounds.delete(e)},this.activeSounds.set(e,l),l.start()}catch(s){d.error("Error playing sound ".concat(e,":"),s)}}stopSound(e){const a=this.activeSounds.get(e);a&&(a.stop(),this.activeSounds.delete(e))}stopAllSounds(){this.activeSounds.forEach((e,a)=>{e.stop()}),this.activeSounds.clear()}setMasterVolume(e){this.masterVolume=Math.max(0,Math.min(1,e))}enableAutoplay(){var e;this.autoplayEnabled=!0,((e=this.audioContext)==null?void 0:e.state)==="suspended"&&this.audioContext.resume().catch(a=>d.warn("Failed to resume audio context:",a)),d.info("üîä Autoplay enabled for booking sounds")}startBookingAlert(e,a){if(this.activeAlerts.has(e)){d.info("üîî Booking alert already active for: ".concat(e));return}this.activeAlerts.set(e,{status:a,intervalId:null}),d.info("üîî Started booking alert for: ".concat(e," (status: ").concat(a,")")),this.playBookingRequest().catch(i=>d.warn("Failed to play booking alert:",i))}stopBookingAlert(e){const a=this.activeAlerts.get(e);a&&(a.intervalId&&clearInterval(a.intervalId),this.activeAlerts.delete(e),d.info("üîï Stopped booking alert for: ".concat(e)))}stopAllAlerts(){this.activeAlerts.forEach((e,a)=>{e.intervalId&&clearInterval(e.intervalId)}),this.activeAlerts.clear(),d.info("üîï Stopped all booking alerts")}isAlertActive(e){return this.activeAlerts.has(e)}getActiveAlertCount(){return this.activeAlerts.size}async playBookingRequest(){try{await this.playSound("booking-request",{loop:!1,priority:"high",fadeIn:!0}),d.info("üîî Playing booking request sound for therapist")}catch(e){d.error("‚ùå Failed to play booking request:",e)}}async playBookingConfirmation(){try{await this.playSound("booking-confirmed",{loop:!1,priority:"normal",fadeIn:!1}),d.info("‚úÖ Playing booking confirmation sound")}catch(e){d.error("‚ùå Failed to play booking confirmation:",e)}}async playBookingCancellation(){try{await this.playSound("booking-cancelled",{loop:!1,priority:"normal",fadeIn:!1}),d.info("‚ùå Playing booking cancellation sound")}catch(e){d.error("‚ùå Failed to play booking cancellation:",e)}}async playCountdown(){try{const e=[5,4,3,2,1];for(let a=0;a<e.length;a++)await new Promise(i=>setTimeout(i,a*1e3)),await this.playSound("countdown-".concat(e[a]),{loop:!1,priority:"high",fadeIn:!1});d.info("‚è∞ Playing countdown sequence")}catch(e){d.error("‚ùå Failed to play countdown:",e)}}async playNotification(){try{await this.playSound("notification",{loop:!1,priority:"normal",fadeIn:!1}),d.info("üîî Playing notification sound")}catch(e){d.error("‚ùå Failed to play notification:",e)}}async playWelcomeChime(){try{if(this.audioContext||await this.initializeAudioContext(),!this.audioContext)return;const e=this.audioContext,a=[261.63,329.63,392,523.25];for(let i=0;i<a.length;i++){const s=e.createOscillator(),o=e.createGain();s.connect(o),o.connect(e.destination),s.frequency.setValueAtTime(a[i],e.currentTime+i*.2),o.gain.setValueAtTime(.1,e.currentTime+i*.2),o.gain.exponentialRampToValueAtTime(.01,e.currentTime+i*.2+.4),s.start(e.currentTime+i*.2),s.stop(e.currentTime+i*.2+.4)}}catch(e){d.warn("‚ö†Ô∏è Failed to play welcome chime:",e)}}async playUserSuccess(){try{await this.playSound("user-success",{loop:!1,priority:"normal",fadeIn:!1}),d.info("‚úÖ Playing user success sound")}catch(e){d.error("‚ùå Failed to play user success:",e)}}async playUserAlert(){try{await this.playSound("user-alert",{loop:!1,priority:"high",fadeIn:!1}),d.info("üö® Playing user alert sound")}catch(e){d.error("‚ùå Failed to play user alert:",e)}}async playTherapistAlert(){try{await this.playSound("therapist-alert",{loop:!1,priority:"urgent",fadeIn:!1}),d.info("üîî Playing therapist alert sound")}catch(e){d.error("‚ùå Failed to play therapist alert:",e)}}async playPlaceAlert(){try{await this.playSound("place-alert",{loop:!1,priority:"normal",fadeIn:!1}),d.info("üè¢ Playing place alert sound")}catch(e){d.error("‚ùå Failed to play place alert:",e)}}async playReminder(){try{await this.playSound("reminder",{loop:!1,priority:"high",fadeIn:!0}),d.info("‚è∞ Playing reminder sound")}catch(e){d.error("‚ùå Failed to play reminder:",e)}}async playScheduledReminderAlert(){try{await this.playSound("attention-tone",{loop:!1,priority:"urgent",fadeIn:!1}),await new Promise(e=>setTimeout(e,1e3)),await this.playSound("scheduled-reminder",{loop:!1,priority:"high",fadeIn:!0,fadeOut:!0}),d.info("üìÖ Playing scheduled reminder alert for therapist")}catch(e){d.error("‚ùå Failed to play scheduled reminder alert:",e)}}async playScheduledBookingSequence(){try{await this.playSound("preparation-tone",{loop:!1,priority:"high",fadeIn:!1}),await new Promise(a=>setTimeout(a,2e3));const e=["three","two","one"];for(const a of e)await this.playSound("countdown-".concat(a),{loop:!1,priority:"urgent",fadeIn:!1}),await new Promise(i=>setTimeout(i,1e3));await this.playSound("scheduled-booking-ready",{loop:!1,priority:"urgent",fadeIn:!1}),d.info("üéØ Playing scheduled booking sequence")}catch(e){d.error("‚ùå Failed to play scheduled booking sequence:",e)}}async playHourlyReminderChime(e){try{if(this.audioContext||await this.initializeAudioContext(),!this.audioContext)return;const a=this.audioContext,i=440,o={5:i*.5,4:i*.6,3:i*.75,2:i*.9,1:i*1.2}[e]||i;for(let l=0;l<e;l++){const c=a.createOscillator(),r=a.createGain();c.connect(r),r.connect(a.destination),c.frequency.setValueAtTime(o,a.currentTime+l*.8),c.type="sine",r.gain.setValueAtTime(0,a.currentTime+l*.8),r.gain.linearRampToValueAtTime(.3,a.currentTime+l*.8+.1),r.gain.linearRampToValueAtTime(0,a.currentTime+l*.8+.6),c.start(a.currentTime+l*.8),c.stop(a.currentTime+l*.8+.6)}d.info("üîî Playing ".concat(e," hour reminder chime"))}catch(a){d.error("‚ùå Failed to play ".concat(e," hour reminder chime:"),a)}}async playAppDownloadPrompt(){try{await this.playSound("app-download-prompt",{loop:!1,priority:"normal",fadeIn:!0}),d.info("üì± Playing app download prompt sound")}catch(e){d.error("‚ùå Failed to play app download prompt:",e)}}async playEnterpriseConnection(){try{if(this.audioContext||await this.initializeAudioContext(),!this.audioContext)return;const e=this.audioContext,a=[220,277,330,440];for(let i=0;i<a.length;i++){const s=e.createOscillator(),o=e.createGain();s.connect(o),o.connect(e.destination),s.frequency.setValueAtTime(a[i],e.currentTime+i*.15),s.type="triangle",o.gain.setValueAtTime(.1,e.currentTime+i*.15),o.gain.exponentialRampToValueAtTime(.01,e.currentTime+i*.15+.3),s.start(e.currentTime+i*.15),s.stop(e.currentTime+i*.15+.3)}d.info("üîó Playing enterprise connection sound")}catch(e){d.error("‚ùå Failed to play enterprise connection sound:",e)}}async playEnterpriseDisconnection(){try{if(this.audioContext||await this.initializeAudioContext(),!this.audioContext)return;const e=this.audioContext,a=[440,330,277,220];for(let i=0;i<a.length;i++){const s=e.createOscillator(),o=e.createGain();s.connect(o),o.connect(e.destination),s.frequency.setValueAtTime(a[i],e.currentTime+i*.2),s.type="sawtooth",o.gain.setValueAtTime(.08,e.currentTime+i*.2),o.gain.exponentialRampToValueAtTime(.01,e.currentTime+i*.2+.4),s.start(e.currentTime+i*.2),s.stop(e.currentTime+i*.2+.4)}d.info("üîå Playing enterprise disconnection sound")}catch(e){d.error("‚ùå Failed to play enterprise disconnection sound:",e)}}}const j=new le;class ce{constructor(){A(this,"audioContext",null);A(this,"soundCache",new Map);A(this,"scheduledNotifications",new Map);A(this,"isInitialized",!1);A(this,"availableSounds",[{id:"gentle_chime",name:"Gentle Chime",filename:"alert-notification.mp3",description:"Soft, pleasant chime for appointment reminders",category:"reminder"},{id:"booking_confirmed",name:"Booking Confirmed",filename:"booking-notification.mp3",description:"Success sound for booking confirmations",category:"booking"},{id:"payment_success",name:"Payment Success",filename:"payment-notification.mp3",description:"Confirmation sound for successful payments",category:"payment"},{id:"appointment_alert",name:"Appointment Alert",filename:"alert-notification.mp3",description:"Urgent alert for upcoming appointments",category:"reminder"},{id:"spa_bell",name:"Spa Bell",filename:"success-notification.mp3",description:"Relaxing spa-like bell sound",category:"reminder"}]);this.initialize()}async initialize(){try{"AudioContext"in window||"webkitAudioContext"in window?(this.audioContext=new(window.AudioContext||window.webkitAudioContext),this.isInitialized=!0):this.isInitialized=!0}catch{this.isInitialized=!1}}async preloadSounds(e){const i=(e?this.availableSounds.filter(s=>e.includes(s.id)):this.availableSounds).map(s=>this.loadSoundBuffer(s.filename));try{await Promise.all(i)}catch{}}async loadSoundBuffer(e){if(this.soundCache.has(e))return this.soundCache.get(e);try{const a=await fetch("/sounds/".concat(e));if(!a.ok)throw new Error("Failed to load sound: ".concat(e));const i=await a.arrayBuffer();if(this.audioContext){const s=await this.audioContext.decodeAudioData(i);return this.soundCache.set(e,s),s}return null}catch{return null}}async playNotification(e,a=.7){const i=this.availableSounds.find(s=>s.id===e);if(i)try{this.audioContext?await this.playWithAudioContext(i.filename,a):await this.playWithHtmlAudio(i.filename,a)}catch{await this.playWithHtmlAudio(i.filename,a)}}async playWithAudioContext(e,a){if(!this.audioContext)return;const i=await this.loadSoundBuffer(e);if(!i)return;const s=this.audioContext.createBufferSource(),o=this.audioContext.createGain();s.buffer=i,o.gain.value=a,s.connect(o),o.connect(this.audioContext.destination),s.start()}async playWithHtmlAudio(e,a){const i=new Audio("/sounds/".concat(e));return i.volume=a,new Promise((s,o)=>{i.onended=()=>s(),i.onerror=o,i.play().catch(o)})}scheduleNotification(e){const a=new Date,i=e.scheduledFor.getTime()-a.getTime();if(i<=0)return this.playNotification(e.soundId),e.id;const s=setTimeout(async()=>{var o;await this.playNotification(e.soundId),(o=e.repeat)!=null&&o.enabled&&this.scheduleRepeatingNotification(e),this.scheduledNotifications.delete(e.id)},i);return this.scheduledNotifications.set(e.id,s),e.id}scheduleRepeatingNotification(e){if(!e.repeat)return;let a=0;const i=e.repeat.maxRepeats,s=e.repeat.intervalMinutes*60*1e3,o=setInterval(async()=>{a++,await this.playNotification(e.soundId),a>=i&&clearInterval(o)},s)}scheduleBookingReminders(e,a,i,s,o){const l=[{hours:3,soundId:"gentle_chime",message:"3 hours until appointment"},{hours:1,soundId:"spa_bell",message:"1 hour until appointment"},{minutes:30,soundId:"appointment_alert",message:"30 minutes until appointment"},{minutes:15,soundId:"appointment_alert",message:"15 minutes until appointment"}],c=[];return l.forEach((r,u)=>{const y=new Date(a);"hours"in r?y.setHours(y.getHours()-r.hours):y.setMinutes(y.getMinutes()-r.minutes);const B={id:"".concat(e,"_reminder_").concat(u),type:"booking_reminder",scheduledFor:y,soundId:r.soundId,message:r.message,bookingId:e,metadata:{customerName:i,providerName:s,serviceType:o,appointmentTime:a.toLocaleString()}},C=this.scheduleNotification(B);c.push(C)}),c}cancelNotification(e){const a=this.scheduledNotifications.get(e);return a?(clearTimeout(a),this.scheduledNotifications.delete(e),!0):!1}cancelBookingNotifications(e){let a=0;for(const[i]of this.scheduledNotifications)i.startsWith("".concat(e,"_"))&&this.cancelNotification(i)&&a++;return a}getAvailableSounds(){return[...this.availableSounds]}getScheduledNotificationsCount(){return this.scheduledNotifications.size}async testNotification(e="gentle_chime"){await this.playNotification(e,.5)}async requestNotificationPermission(){return"Notification"in window?Notification.permission==="granted"?!0:Notification.permission!=="denied"?await Notification.requestPermission()==="granted":!1:!1}async showNotificationWithSound(e,a,i="gentle_chime",s){await this.playNotification(i),await this.requestNotificationPermission()&&new Notification(e,{body:a,icon:"/icon-192.png",tag:"massage-booking",...s})}}const E=new ce;E.preloadSounds(["gentle_chime","booking_confirmed","appointment_alert"]).catch(console.error);class de{constructor(){A(this,"activeJourneys",new Map);A(this,"locationTracking",new Map)}async setOnTheWay(e,a,i,s,o,l=30){const c=new Date,r=new Date(c.getTime()+l*6e4),u={bookingId:e,therapistId:a,therapistName:i,customerName:s,customerPhone:o,departureTime:c,estimatedArrival:r,status:"departed",notifications:{customerNotified:!1,nearbyAlertSent:!1,arrivalConfirmed:!1}};return this.activeJourneys.set(e,u),await this.notifyCustomerTherapistDeparted(u),this.startLocationTracking(e),this.scheduleArrivalReminder(u),u}async notifyCustomerTherapistDeparted(e){const a="üöó **".concat(e.therapistName," is on the way!**\n\nHi ").concat(e.customerName,"! \n\nYour therapist is now heading to your location and will be with you soon.\n\n‚è∞ **Estimated arrival:** ").concat(e.estimatedArrival.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}),"\n\nüè† **Please prepare:**\n‚Ä¢ Clear and comfortable massage area\n‚Ä¢ Have towels ready\n‚Ä¢ Ensure easy access to your location\n‚Ä¢ Keep your phone nearby for updates\n\nThank you for choosing IndasTreet Massage! üôè\n\n---\n*Your therapist will update you when they're nearby*");await this.sendToCustomerChat(e.bookingId,e.customerPhone,a),await E.playNotification("gentle_chime"),e.notifications.customerNotified=!0,this.activeJourneys.set(e.bookingId,e)}async sendToCustomerChat(e,a,i){"Notification"in window&&Notification.permission==="granted"&&new Notification("Your therapist is on the way! üöó",{body:"Please prepare your massage area. Arrival time updated.",icon:"/icon-192.png",tag:"therapist-ontheway-".concat(e)})}startLocationTracking(e){if(!navigator.geolocation)return;const a=setInterval(()=>{navigator.geolocation.getCurrentPosition(i=>{const s=this.activeJourneys.get(e);if(!s){clearInterval(a);return}s.currentLocation={latitude:i.coords.latitude,longitude:i.coords.longitude,address:"Current location",timestamp:new Date},s.status="en_route",this.activeJourneys.set(e,s),this.checkIfNearby(s)},i=>{},{enableHighAccuracy:!0,timeout:1e4,maximumAge:6e4})},3e4);this.locationTracking.set(e,a)}async checkIfNearby(e){if(!e.currentLocation||e.notifications.nearbyAlertSent)return;const a=Date.now()-e.departureTime.getTime(),i=e.estimatedArrival.getTime()-e.departureTime.getTime();a>=i*.8&&await this.notifyCustomerTherapistNearby(e)}async notifyCustomerTherapistNearby(e){const a="üìç **".concat(e.therapistName," is nearby!**\n\nYour therapist is just a few minutes away from your location.\n\n‚è∞ **Arriving very soon**\n\nüö™ Please be ready to answer the door and guide them to your massage area.\n\nSee you shortly! üòä");await this.sendToCustomerChat(e.bookingId,e.customerPhone,a),await E.playNotification("appointment_alert"),e.status="nearby",e.notifications.nearbyAlertSent=!0,this.activeJourneys.set(e.bookingId,e)}async confirmArrival(e){const a=this.activeJourneys.get(e);if(!a)return;a.status="arrived",a.notifications.arrivalConfirmed=!0;const i=this.locationTracking.get(e);i&&(clearInterval(i),this.locationTracking.delete(e));const s="‚úÖ **".concat(a.therapistName," has arrived!**\n\nYour therapist is now at your location and ready to begin your massage session.\n\nPlease let them in and enjoy your relaxing massage! üßò‚Äç‚ôÄÔ∏è‚ú®");await this.sendToCustomerChat(a.bookingId,a.customerPhone,s),await E.playNotification("booking_confirmed"),this.activeJourneys.set(e,a)}scheduleArrivalReminder(e){const a=new Date(e.estimatedArrival.getTime()-3e5),i={id:"arrival_reminder_".concat(e.bookingId),type:"booking_reminder",scheduledFor:a,soundId:"spa_bell",message:"Therapist arriving in 5 minutes",bookingId:e.bookingId,metadata:{customerName:e.customerName,therapistName:e.therapistName,serviceType:"Massage",appointmentTime:e.estimatedArrival.toLocaleString()}};E.scheduleNotification(i)}getJourneyStatus(e){return this.activeJourneys.get(e)||null}getActiveJourneys(){return Array.from(this.activeJourneys.values())}cancelJourney(e){const a=this.locationTracking.get(e);a&&(clearInterval(a),this.locationTracking.delete(e)),this.activeJourneys.delete(e),E.cancelNotification("arrival_reminder_".concat(e))}async updateEstimatedArrival(e,a){const i=this.activeJourneys.get(e);if(!i)return;const s=new Date(Date.now()+a*6e4);i.estimatedArrival=s;const o="‚è∞ **Arrival time updated**\n\n".concat(i.therapistName," will arrive at approximately **").concat(s.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}),"**\n\nThank you for your patience! üôè");await this.sendToCustomerChat(i.bookingId,i.customerPhone,o),this.activeJourneys.set(e,i)}}const W=new de,ue=({bookingId:n,therapistId:e,therapistName:a,customerName:i,customerPhone:s,customerAddress:o,isBookingAccepted:l,onStatusUpdate:c})=>{const[r,u]=p.useState(null),[y,B]=p.useState(30),[C,k]=p.useState(!1),[w,v]=p.useState(!1);p.useEffect(()=>{const m=W.getJourneyStatus(n);m&&u(m)},[n]);const $=async()=>{k(!0);try{const m=await W.setOnTheWay(n,e,a,i,s,y);u(m),c==null||c(m)}catch(m){g.error("Failed to start journey:",m),alert("‚ùå Failed to notify customer. Please try again.")}finally{k(!1),v(!1)}},_=async()=>{try{if(await W.confirmArrival(n),r){const m={...r,status:"arrived"};u(m),c==null||c(m)}}catch(m){g.error("Failed to confirm arrival:",m),alert("‚ùå Failed to confirm arrival. Please try again.")}},I=async m=>{try{if(await W.updateEstimatedArrival(n,m),r){const h=new Date(Date.now()+m*6e4),N={...r,estimatedArrival:h};u(N),c==null||c(N)}}catch(h){g.error("Failed to update arrival time:",h)}},x=m=>m.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}),T=()=>{if(!r)return"";const m=r.estimatedArrival.getTime()-Date.now();if(m<=0)return"Should be arrived";const h=Math.round(m/6e4);return"".concat(h," min")},S=()=>{if(!r)return t.jsx(R,{className:"w-5 h-5"});switch(r.status){case"departed":return t.jsx(R,{className:"w-5 h-5 text-blue-500"});case"en_route":return t.jsx(ee,{className:"w-5 h-5 text-orange-500"});case"nearby":return t.jsx(H,{className:"w-5 h-5 text-yellow-500"});case"arrived":return t.jsx(J,{className:"w-5 h-5 text-green-500"});default:return t.jsx(R,{className:"w-5 h-5"})}},b=()=>{if(!r)return"Start Journey";switch(r.status){case"departed":return"On the Way";case"en_route":return"En Route";case"nearby":return"Nearby";case"arrived":return"Arrived";default:return"On the Way"}};return l?t.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-4 shadow-sm",children:[t.jsxs("div",{className:"mb-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:[t.jsx("h3",{className:"font-semibold text-blue-800 mb-2 flex items-center gap-2",children:"üìç Journey to Customer"}),t.jsxs("div",{className:"text-sm text-blue-700 space-y-1",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"font-medium",children:"üë§ Customer:"}),t.jsx("span",{children:i})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"font-medium",children:"üìû Phone:"}),t.jsx("span",{children:s})]}),t.jsxs("div",{className:"flex items-start gap-2",children:[t.jsx("span",{className:"font-medium",children:"üè† Address:"}),t.jsx("span",{className:"flex-1",children:o})]})]})]}),r?t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 border border-gray-200 rounded-lg",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[S(),t.jsxs("div",{children:[t.jsx("div",{className:"font-semibold text-gray-800",children:b()}),t.jsxs("div",{className:"text-xs text-gray-600",children:["Started: ",x(r.departureTime)]})]})]}),t.jsxs("div",{className:"text-right",children:[t.jsxs("div",{className:"text-sm font-medium text-gray-800",children:["ETA: ",x(r.estimatedArrival)]}),t.jsx("div",{className:"text-xs text-gray-600",children:T()})]})]}),t.jsxs("div",{className:"space-y-2",children:[r.status!=="arrived"&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"flex gap-2",children:[t.jsxs("button",{onClick:()=>I(15),className:"flex-1 bg-yellow-500 hover:bg-yellow-600 text-white py-2 px-3 rounded-lg text-sm font-medium transition-colors flex items-center justify-center gap-1",children:[t.jsx(M,{className:"w-4 h-4"}),"15 min"]}),t.jsxs("button",{onClick:()=>I(30),className:"flex-1 bg-yellow-500 hover:bg-yellow-600 text-white py-2 px-3 rounded-lg text-sm font-medium transition-colors flex items-center justify-center gap-1",children:[t.jsx(M,{className:"w-4 h-4"}),"30 min"]}),t.jsxs("button",{onClick:()=>I(45),className:"flex-1 bg-yellow-500 hover:bg-yellow-600 text-white py-2 px-3 rounded-lg text-sm font-medium transition-colors flex items-center justify-center gap-1",children:[t.jsx(M,{className:"w-4 h-4"}),"45 min"]})]}),t.jsxs("button",{onClick:_,className:"w-full bg-green-500 hover:bg-green-600 text-white py-3 px-4 rounded-lg font-semibold transition-colors flex items-center justify-center gap-2",children:[t.jsx(J,{className:"w-5 h-5"}),"‚úÖ I've Arrived - Start Massage"]})]}),r.status==="arrived"&&t.jsxs("div",{className:"text-center p-4 bg-green-50 border border-green-200 rounded-lg",children:[t.jsx(J,{className:"w-8 h-8 text-green-600 mx-auto mb-2"}),t.jsx("div",{className:"font-semibold text-green-800",children:"‚úÖ Arrival Confirmed!"}),t.jsx("div",{className:"text-sm text-green-700",children:"Customer has been notified. Enjoy the massage! üßò‚Äç‚ôÄÔ∏è"})]})]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsxs("a",{href:"tel:".concat(s),className:"flex-1 bg-blue-500 hover:bg-blue-600 text-white py-2 px-3 rounded-lg text-sm font-medium transition-colors flex items-center justify-center gap-2",children:[t.jsx(X,{className:"w-4 h-4"}),"Call Customer"]}),t.jsx("a",{href:"https://wa.me/".concat(s.replace(/[^0-9]/g,"")),target:"_blank",rel:"noopener noreferrer",className:"flex-1 bg-green-500 hover:bg-green-600 text-white py-2 px-3 rounded-lg text-sm font-medium transition-colors flex items-center justify-center gap-2",children:"üí¨ WhatsApp"})]}),t.jsxs("div",{className:"text-xs text-gray-500 space-y-1",children:[t.jsx("div",{className:"font-medium",children:"üìã Journey Status:"}),t.jsx("div",{className:"".concat(r.notifications.customerNotified?"text-green-600":"text-gray-400"),children:"‚úì Customer notified of departure"}),t.jsx("div",{className:"".concat(r.notifications.nearbyAlertSent?"text-green-600":"text-gray-400"),children:"‚úì Nearby location alert sent"}),t.jsx("div",{className:"".concat(r.notifications.arrivalConfirmed?"text-green-600":"text-gray-400"),children:"‚úì Arrival confirmed"})]})]}):t.jsx(t.Fragment,{children:w?t.jsxs("div",{className:"space-y-3",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"‚è∞ Estimated travel time:"}),t.jsxs("select",{value:y,onChange:m=>B(Number(m.target.value)),className:"w-full p-2 border border-gray-300 rounded-lg text-sm",children:[t.jsx("option",{value:15,children:"15 minutes"}),t.jsx("option",{value:20,children:"20 minutes"}),t.jsx("option",{value:25,children:"25 minutes"}),t.jsx("option",{value:30,children:"30 minutes"}),t.jsx("option",{value:45,children:"45 minutes"}),t.jsx("option",{value:60,children:"1 hour"})]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsxs("button",{onClick:$,disabled:C,className:"flex-1 bg-green-500 hover:bg-green-600 disabled:bg-gray-400 text-white py-3 px-4 rounded-lg font-medium transition-colors flex items-center justify-center gap-2",children:[t.jsx(R,{className:"w-5 h-5"}),C?"Notifying...":"Start Journey üöó"]}),t.jsx("button",{onClick:()=>v(!1),className:"px-4 py-3 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-lg font-medium transition-colors",children:"Cancel"})]})]}):t.jsxs("button",{onClick:()=>v(!0),className:"w-full bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white py-4 px-6 rounded-xl font-bold text-lg transition-all shadow-lg hover:shadow-xl flex items-center justify-center gap-3",children:[t.jsx(R,{className:"w-6 h-6"}),"üöó On the Way - Notify Customer"]})}),t.jsx("div",{className:"mt-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:t.jsxs("div",{className:"text-xs text-yellow-800",children:[t.jsx("strong",{children:"üí° How it works:"}),t.jsxs("div",{className:"mt-1 space-y-1",children:[t.jsx("div",{children:'1. Click "On the Way" when you start traveling'}),t.jsx("div",{children:"2. Customer gets notified with your ETA"}),t.jsx("div",{children:"3. Update arrival time if needed"}),t.jsx("div",{children:"4. Confirm arrival when you reach the location"})]})]})})]}):null},G=new Map;let P=null;const me=()=>(P||(P=new Audio("/sounds/booking-notification.mp3"),P.loop=!1,P.volume=.8,P.load(),P.addEventListener("error",n=>{})),P),q=async()=>{try{const n=me();n.currentTime=0,await n.play()}catch(n){n.name}},Q=n=>{D(n);try{j.startBookingAlert(n,"pending")}catch{}q();const e=setInterval(()=>{q()},1e4);G.set(n,e)},D=n=>{const e=G.get(n);e&&(clearInterval(e),G.delete(n));try{j.stopBookingAlert(n)}catch{}},he=()=>{G.forEach((n,e)=>{clearInterval(n)}),G.clear();try{j.stopAllBookingAlerts()}catch{}};typeof window!="undefined"&&(window.addEventListener("beforeunload",()=>{try{he()}catch{}}),document.addEventListener("visibilitychange",()=>{}));function ge({provider:n,providerType:e,onBook:a,onBack:i,bookings:s,t:o}){const[l,c]=p.useState(new Date),[r,u]=p.useState(null),[y,B]=p.useState("60"),[C,k]=p.useState(!1),w=p.useMemo(()=>{const x=[],T=e==="place"?parseInt(n.openingTime.split(":")[0]):9,S=e==="place"?parseInt(n.closingTime.split(":")[0]):21;for(let b=T;b<S;b++){const m=new Date(l);m.setHours(b,0,0,0),s.some(N=>{const F=new Date(N.startTime);return F.getFullYear()===m.getFullYear()&&F.getMonth()===m.getMonth()&&F.getDate()===m.getDate()&&F.getHours()===m.getHours()})||x.push(m.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1}))}return x},[l,s,e,n]),v=x=>{const T=new Date(x.target.value),S=T.getTimezoneOffset()*6e4,b=new Date(T.getTime()+S);c(b),u(null)},$=()=>{r&&k(!0)},_=()=>{if(!r)return;const[x,T]=r.split(":").map(Number),S=new Date(l);S.setHours(x,T,0,0);const b=typeof n.id=="number"?n.id:parseInt(String(n.id),10)||0;a({providerId:b,providerType:e,providerName:n.name,service:y,startTime:S.toISOString(),customerName:"Guest Customer"}),k(!1)},I=new Date().toISOString().split("T")[0];return t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"p-4 bg-gray-50 min-h-[calc(100vh-env(safe-area-inset-top)-env(safe-area-inset-bottom))]",children:[t.jsxs("header",{className:"flex items-center mb-6",children:[t.jsxs("button",{onClick:i,className:"flex items-center gap-2 text-gray-600 hover:text-gray-900 transition-colors group mr-4",children:[t.jsx(te,{className:"w-5 h-5 group-hover:translate-x-[-2px] transition-transform"}),t.jsx("span",{className:"font-medium",children:"Back"})]}),t.jsx("h1",{className:"text-xl font-bold text-gray-800 truncate",children:o.title.replace("{name}",n.name)})]}),t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"bg-white p-4 pb-20 rounded-lg shadow",children:[t.jsx("label",{htmlFor:"booking-date",className:"block text-sm font-semibold text-gray-700 mb-2",children:o.selectDate}),t.jsx("input",{id:"booking-date",type:"date",min:I,value:l.toISOString().split("T")[0],onChange:v,className:"w-full px-4 py-4 border-2 border-gray-300 rounded-xl focus:border-green-500 focus:ring-2 focus:ring-green-200 text-lg font-semibold shadow-sm transition-all duration-200",style:{fontSize:"18px",minHeight:"60px",touchAction:"manipulation"}})]}),t.jsxs("div",{className:"bg-white p-4 pb-20 rounded-lg shadow",children:[t.jsx("h3",{className:"text-sm font-semibold text-gray-700 mb-2",children:o.selectTime}),w.length>0?t.jsx("div",{className:"grid grid-cols-4 gap-2",children:w.map(x=>t.jsx("button",{onClick:()=>u(x),className:"p-2 rounded-md text-sm font-medium transition-colors ".concat(r===x?"bg-brand-green text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:x},x))}):t.jsx("p",{className:"text-sm text-gray-500 text-center py-4",children:o.noSlots})]}),t.jsxs("div",{className:"bg-white p-4 pb-20 rounded-lg shadow",children:[t.jsx("h3",{className:"text-sm font-semibold text-gray-700 mb-2",children:o.selectService}),t.jsx("div",{className:"flex bg-gray-200 rounded-full p-1",children:["60","90","120"].map(x=>t.jsxs("button",{onClick:()=>B(x),className:"w-1/3 py-2 px-2 rounded-full text-sm font-semibold transition-colors duration-300 ".concat(y===x?"bg-brand-green text-white shadow":"text-gray-600"),children:[x," min"]},x))})]}),t.jsx(re,{onClick:$,disabled:!r,children:"Book Now"})]}),C&&t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 p-4 pb-20",children:t.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full p-6",children:[t.jsx("h3",{className:"text-xl font-bold text-gray-800 mb-4",children:"Confirm Booking"}),t.jsxs("div",{className:"space-y-3 mb-6",children:[t.jsxs("p",{className:"text-gray-700",children:[t.jsx("span",{className:"font-semibold",children:"Provider:"})," ",n.name]}),t.jsxs("p",{className:"text-gray-700",children:[t.jsx("span",{className:"font-semibold",children:"Date:"})," ",l.toLocaleDateString()]}),t.jsxs("p",{className:"text-gray-700",children:[t.jsx("span",{className:"font-semibold",children:"Time:"})," ",r]}),t.jsxs("p",{className:"text-gray-700",children:[t.jsx("span",{className:"font-semibold",children:"Duration:"})," ",y," minutes"]}),t.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3 mt-4",children:t.jsx("p",{className:"text-sm text-blue-800",children:"üí¨ After confirming, a chat window will open where you can communicate with the provider in real-time. The provider has 25 minutes to accept or decline your booking."})})]}),t.jsxs("div",{className:"flex gap-3",children:[t.jsx("button",{onClick:()=>k(!1),className:"flex-1 px-4 py-3 bg-gray-200 text-gray-700 rounded-xl font-semibold hover:bg-gray-300 transition",children:"Cancel"}),t.jsx("button",{onClick:_,className:"flex-1 px-4 py-3 bg-gradient-to-r from-orange-500 to-orange-600 text-white rounded-xl font-semibold hover:from-orange-600 hover:to-orange-700 transition shadow-lg",children:"Confirm Booking"})]})]})})]}),t.jsx(se,{userId:"guest",userName:"Guest User",userRole:"customer"})]})}const ke=Object.freeze(Object.defineProperty({__proto__:null,default:ge},Symbol.toStringTag,{value:"Module"})),fe={bookingCreated:"data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEAESsAACJWAAACABAJAA8AAABkYWN0YQ==",bookingAccepted:"data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEAESsAACJWAAACABAJAA8AAABkYWN0YQ==",bookingDeclined:"data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEAESsAACJWAAACABAJAA8AAABkYWN0YQ==",bookingBroadcast:"data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEAESsAACJWAAACABAJAA8AAABkYWN0YQ==",reminderPing:"data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEAESsAACJWAAACABAJAA8AAABkYWN0YQ=="},V={};function z(n,e=.6){try{let a=V[n];a?a.currentTime=0:(a=new Audio(fe[n]),a.volume=e,V[n]=a),a.play().catch(()=>{})}catch{}}async function pe(n,e=250){for(const a of n)z(a),await new Promise(i=>setTimeout(i,e))}function xe(n,e,a){return"üõéÔ∏è NEW MASSAGE REQUEST\nüë§ Client: ".concat(n.customerName,"\n‚è±Ô∏è Duration: ").concat(n.durationMinutes," min\nüí∞ Price: IDR ").concat(n.price,"\n")+(n.notes?"üìù Notes: ".concat(n.notes,"\n"):"")+"\n‚úÖ Accept: ".concat(e,"\n‚ùå Decline: ").concat(a,"\n\nüîí Contact customer through in-app chat system only.\n\nRespond within 15 minutes to secure booking.")}async function U(n,e){try{const i=(await ne.getAll()).filter(o=>{var l,c;return((c=(l=o.status)==null?void 0:l.toLowerCase)==null?void 0:c.call(l))==="available"&&String(o.$id||o.id)!==String(e)});if(i.length===0)return{broadcastCount:0,message:"No other therapists available."};let s=0;return i.slice(0,5).forEach(o=>{const l="".concat(window.location.origin,"/accept-booking/").concat(n.bookingId,"?therapist=").concat(o.$id||o.id),c="".concat(window.location.origin,"/decline-booking/").concat(n.bookingId,"?therapist=").concat(o.$id||o.id),r=xe(n,l,c),u="https://wa.me/".concat((o.whatsappNumber||"").replace(/[^\d]/g,""),"?text=").concat(encodeURIComponent(r));window.open(u,"_blank"),s++}),{broadcastCount:s,message:"Broadcasted to ".concat(s," therapists.")}}catch(a){return{broadcastCount:0,message:"Broadcast failed: "+((a==null?void 0:a.message)||"Unknown error")}}}const ye=({isOpen:n,onClose:e,bookingId:a,customerName:i="Customer",customerWhatsApp:s="",duration:o,price:l,location:c,bookingTime:r,therapistId:u,therapistName:y="Therapist",address:B=c||"Customer Location",providerType:C="therapist",bookingType:k="immediate",scheduledTime:w})=>{const[v,$]=p.useState(!1),[_,I]=p.useState(!1),[x,T]=p.useState(!1);p.useEffect(()=>{if(!(!n||!a))return j.enableAutoplay(),Q(a),j.startBookingAlert(a,"pending"),()=>{D(a),j.stopBookingAlert(a)}},[n,a]);const S=async()=>{$(!0);try{g.debug("üîí [POPUP] Accepting booking via SINGLE SOURCE OF TRUTH:",a);const{bookingService:b}=await oe(async()=>{const{bookingService:h}=await import("./route-therapist.DVVqC6AH.js").then(N=>N.bx);return{bookingService:h}},__vite__mapDeps([0,1,2,3,4,5])),m=await b.acceptBookingAndCreateCommission(a,u,y);if(g.debug("‚úÖ [POPUP] Booking accepted and commission created:",m.commission.$id),g.debug("   Commission: ".concat(m.commission.commissionAmount," IDR (30%)")),g.debug("   Payment Deadline: ".concat(m.commission.paymentDeadline)),f.collections.bookings&&f.collections.bookings!==""||g.warn("‚ö†Ô∏è Bookings collection disabled"),C==="therapist"&&f.collections.therapists&&f.collections.therapists!==""){let h=k==="immediate";if(!h&&w)try{const N=Date.now();h=new Date(w).getTime()-N<=2700*1e3}catch{}if(h){const N=new Date(Date.now()+o*6e4).toISOString();await O.updateDocument(f.databaseId,f.collections.therapists,u,{status:"Busy",currentBookingId:a,busyUntil:N})}}g.debug("‚úÖ Booking accepted:",a),g.debug("[BOOKING ACCEPT] Creating chat session for booking:",a),g.debug("[BOOKING ACCEPT] Buyer ID: customer (derived from booking)"),g.debug("[BOOKING ACCEPT] Therapist ID:",u);try{const h={buyerId:"customer",therapistId:String(u),bookingId:String(a),status:"pending",createdAt:new Date().toISOString()};if(g.debug("[BOOKING ACCEPT] Chat session payload:",h),g.debug("[BOOKING ACCEPT] STEP 4 VALIDATION:"),g.debug("[BOOKING ACCEPT]   - buyerId:",h.buyerId?"‚úÖ":"‚ùå"),g.debug("[BOOKING ACCEPT]   - therapistId:",h.therapistId?"‚úÖ":"‚ùå"),g.debug("[BOOKING ACCEPT]   - bookingId:",h.bookingId?"‚úÖ":"‚ùå"),g.debug("[BOOKING ACCEPT]   - status:",h.status==="pending"?"‚úÖ":"‚ùå"),g.debug("[BOOKING ACCEPT]   - createdAt:",h.createdAt?"‚úÖ":"‚ùå"),f.collections.chatSessions&&f.collections.chatSessions!==""){const N=await O.createDocument(f.databaseId,f.collections.chatSessions,a,h);g.debug("[BOOKING ACCEPT] ‚úÖ Chat session created:",N.$id),g.debug("[BOOKING ACCEPT] Therapist can now access chat for this booking")}else g.warn("[BOOKING ACCEPT] ‚ö†Ô∏è Chat sessions collection disabled")}catch(h){g.error("[BOOKING ACCEPT] ‚ùå Failed to create chat session:",{message:h==null?void 0:h.message,code:h==null?void 0:h.code,type:h==null?void 0:h.type,response:h==null?void 0:h.response})}I(!0),T(!0),D(a),j.stopBookingAlert(a),z("bookingAccepted")}catch(b){g.error("Error accepting booking:",b),alert("Failed to accept booking. Please try again."),$(!1)}};return n?t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[100] p-4",children:t.jsx("div",{className:"bg-white rounded-2xl max-w-md w-full shadow-2xl max-h-[90vh] ",children:_?t.jsxs("div",{className:"p-6",children:[t.jsxs("div",{className:"text-center mb-6",children:[t.jsx("div",{className:"w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4",children:t.jsx(J,{size:48,className:"text-green-600"})}),t.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Booking Accepted! ‚úÖ"}),t.jsx("p",{className:"text-gray-600 mb-4",children:"Customer has been notified."})]}),t.jsx(ue,{bookingId:a,therapistId:u,therapistName:i||"Therapist",customerName:i,customerPhone:s,customerAddress:c||"Customer Location",isBookingAccepted:x,onStatusUpdate:b=>{g.debug("Journey status updated:",b)}}),t.jsx("button",{onClick:e,className:"w-full mt-4 bg-gray-200 hover:bg-gray-300 text-gray-700 py-2 px-4 rounded-lg font-medium transition-colors",children:"Close"})]}):t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"bg-gradient-to-r from-orange-500 to-orange-600 p-6 rounded-t-2xl",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("h2",{className:"text-2xl font-bold text-white",children:"üîî New Booking Request"}),t.jsx("button",{onClick:e,className:"p-1 hover:bg-orange-700 rounded-full transition-colors",children:t.jsx(ae,{size:24,className:"text-white"})})]}),t.jsx("p",{className:"text-orange-100 mt-1",children:"Immediate service needed"})]}),t.jsxs("div",{className:"p-6 space-y-4",children:[t.jsx("div",{className:"bg-orange-50 border-2 border-orange-200 rounded-xl p-4",children:t.jsxs("div",{className:"flex items-center justify-center gap-2",children:[t.jsx(M,{className:"text-orange-600",size:20}),t.jsx("span",{className:"font-bold text-orange-900",children:"URGENT - Respond within 5 minutes!"})]})}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"flex items-start gap-3 p-3 bg-gray-50 rounded-lg",children:[t.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center flex-shrink-0",children:"üë§"}),t.jsxs("div",{children:[t.jsx("div",{className:"text-sm text-gray-600",children:"Customer"}),t.jsx("div",{className:"font-semibold text-gray-800",children:i})]})]}),t.jsxs("div",{className:"flex items-start gap-3 p-3 bg-gray-50 rounded-lg",children:[t.jsx("div",{className:"w-10 h-10 bg-purple-100 rounded-full flex items-center justify-center flex-shrink-0",children:t.jsx(M,{size:20,className:"text-purple-600"})}),t.jsxs("div",{children:[t.jsx("div",{className:"text-sm text-gray-600",children:"Duration"}),t.jsxs("div",{className:"font-semibold text-gray-800",children:[o," minutes"]})]})]}),t.jsxs("div",{className:"flex items-start gap-3 p-3 bg-gray-50 rounded-lg",children:[t.jsx("div",{className:"w-10 h-10 bg-green-100 rounded-full flex items-center justify-center flex-shrink-0",children:t.jsx(ie,{size:20,className:"text-green-600"})}),t.jsxs("div",{children:[t.jsx("div",{className:"text-sm text-gray-600",children:"Payment"}),t.jsxs("div",{className:"font-semibold text-gray-800",children:["$",l]})]})]}),c&&t.jsxs("div",{className:"flex items-start gap-3 p-3 bg-gray-50 rounded-lg",children:[t.jsx("div",{className:"w-10 h-10 bg-red-100 rounded-full flex items-center justify-center flex-shrink-0",children:t.jsx(H,{size:20,className:"text-red-600"})}),t.jsxs("div",{children:[t.jsx("div",{className:"text-sm text-gray-600",children:"Location"}),t.jsx("div",{className:"font-semibold text-gray-800",children:c})]})]}),t.jsxs("div",{className:"flex items-start gap-3 p-3 bg-gray-50 rounded-lg",children:[t.jsx("div",{className:"w-10 h-10 bg-orange-100 rounded-full flex items-center justify-center flex-shrink-0",children:"‚è∞"}),t.jsxs("div",{children:[t.jsx("div",{className:"text-sm text-gray-600",children:"Requested Time"}),t.jsx("div",{className:"font-semibold text-gray-800",children:r})]})]})]}),t.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3 mt-4",children:t.jsx("p",{className:"text-sm text-yellow-800 text-center",children:"‚ö†Ô∏è If you don't respond, this booking will be sent to other therapists"})})]}),t.jsxs("div",{className:"p-6 pt-0 space-y-3",children:[t.jsx("button",{onClick:S,disabled:v,className:"w-full py-4 rounded-xl font-bold text-lg transition-all flex items-center justify-center gap-2 ".concat(v?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-gradient-to-r from-green-500 to-green-600 text-white hover:from-green-600 hover:to-green-700 shadow-lg"),children:v?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-2 border-white border-t-transparent"}),t.jsx("span",{children:"Accepting..."})]}):t.jsxs(t.Fragment,{children:[t.jsx(J,{size:24}),t.jsx("span",{children:"Accept Booking"})]})}),t.jsx("button",{onClick:async()=>{if(!v)try{D(a),j.stopBookingAlert(a),f.collections.bookings&&f.collections.bookings!==""&&await O.updateDocument(f.databaseId,f.collections.bookings,a,{status:"rejected",rejectedAt:new Date().toISOString(),rejectedBy:u}),z("bookingDeclined"),await U({bookingId:a,customerName:i,customerWhatsApp:s,durationMinutes:o,price:l},u),pe(["bookingBroadcast"])}catch(b){g.warn("Decline broadcast failed",b)}finally{e()}},disabled:v,className:"w-full py-3 text-gray-600 hover:text-gray-800 font-semibold transition-colors",children:"Decline"})]})]})})}):null},be=()=>{let{bookingId:n}=Y();if(!n&&typeof window!="undefined"){const c=(window.location.pathname||"").split("/").filter(Boolean);c[0]==="accept-booking"&&c[1]&&(n=c[1])}const[e,a]=p.useState(null),[i,s]=p.useState(!0),[o,l]=p.useState(null);return p.useEffect(()=>{(async()=>{if(!n){l("Invalid booking link"),s(!1);return}try{if(!f.collections.bookings||f.collections.bookings===""){l("Bookings are not available at this time"),s(!1);return}const r=await O.getDocument(f.databaseId,f.collections.bookings,n);r.status!=="pending"?l("This booking is no longer available"):a(r)}catch{l("Booking not found")}finally{s(!1)}})()},[n]),i?t.jsx("div",{className:"min-h-[calc(100vh-env(safe-area-inset-top)-env(safe-area-inset-bottom))] bg-gray-50 flex items-center justify-center",children:t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-2 border-blue-600 mx-auto mb-4"}),t.jsx("p",{className:"text-gray-600",children:"Loading booking..."})]})}):o||!e?t.jsx("div",{className:"min-h-[calc(100vh-env(safe-area-inset-top)-env(safe-area-inset-bottom))] bg-gray-50 flex items-center justify-center p-4 pb-20",children:t.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-8 max-w-md w-full text-center",children:[t.jsx("div",{className:"text-red-500 text-6xl mb-4"}),t.jsx("h1",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Booking Not Available"}),t.jsx("p",{className:"text-gray-600 mb-6",children:o||"Unable to load booking"}),t.jsx("button",{onClick:()=>window.location.href="/",className:"bg-blue-600 text-white px-6 py-3 rounded-xl hover:bg-blue-700 transition-all",children:"Go to Home"})]})}):t.jsx("div",{className:"min-h-[calc(100vh-env(safe-area-inset-top)-env(safe-area-inset-bottom))] bg-gray-50",children:t.jsx(ye,{isOpen:!0,onClose:()=>window.location.href="/",bookingId:e.$id,therapistId:e.therapistId,customerName:e.customerName||"Customer",customerWhatsApp:e.customerWhatsApp||"",duration:e.duration,price:e.price,location:e.location||"Not specified",bookingTime:e.createdAt,providerType:e.providerType||e.therapistType||"therapist",bookingType:e.bookingType||"immediate",scheduledTime:e.scheduledTime})})},Te=Object.freeze(Object.defineProperty({__proto__:null,default:be},Symbol.toStringTag,{value:"Module"})),we=()=>{let{bookingId:n}=Y();if(!n&&typeof window!="undefined"){const w=(window.location.pathname||"").split("/").filter(Boolean);w[0]==="decline-booking"&&w[1]&&(n=w[1])}const[e,a]=p.useState(null),[i,s]=p.useState(!0),[o,l]=p.useState(null),[c,r]=p.useState(!1),[u,y]=p.useState(!1),[B,C]=p.useState("");p.useEffect(()=>{if(!n){l("Invalid booking link"),s(!1);return}(async()=>{try{if(!f.collections.bookings||f.collections.bookings===""){l("Bookings unavailable"),s(!1);return}const v=await O.getDocument(f.databaseId,f.collections.bookings,n);v.status!=="pending"?l("This booking is no longer pending"):a(v)}catch{l("Booking not found")}finally{s(!1)}})()},[n]),p.useEffect(()=>{if(n&&e&&!u)return j.enableAutoplay(),Q(n),j.startBookingAlert(n,"pending"),()=>{D(n),j.stopBookingAlert(n)}},[n,e,u]);const k=async()=>{if(!(!n||!e)){r(!0);try{if(f.collections.bookings&&f.collections.bookings!==""&&await O.updateDocument(f.databaseId,f.collections.bookings,n,{status:"declined",declinedAt:new Date().toISOString(),declinedBy:e.therapistId}),D(n),j.stopBookingAlert(n),z("bookingDeclined"),y(!0),L("Booking declined","success"),(e.providerType||e.therapistType)==="therapist"){const w=await U({bookingId:n,customerName:e.customerName||"Customer",durationMinutes:e.duration,price:e.price},e.therapistId);C(w.message||"Broadcast complete")}}catch{L("Failed declining booking","error"),r(!1)}}};return i?t.jsx("div",{className:"min-h-[calc(100vh-env(safe-area-inset-top)-env(safe-area-inset-bottom))] flex items-center justify-center bg-gray-50",children:t.jsx("div",{className:"text-gray-600",children:"Loading booking..."})}):o||!e?t.jsx("div",{className:"min-h-[calc(100vh-env(safe-area-inset-top)-env(safe-area-inset-bottom))] flex items-center justify-center bg-gray-50 p-4",children:t.jsxs("div",{className:"bg-white p-6 rounded-xl shadow",children:[t.jsx("h1",{className:"text-lg font-bold mb-2",children:"Booking Not Available"}),t.jsx("p",{className:"text-sm text-gray-600 mb-4",children:o||"Unable to load booking"}),t.jsx("button",{onClick:()=>window.location.href="/",className:"px-4 py-2 bg-orange-600 text-white rounded",children:"Home"})]})}):t.jsx("div",{className:"min-h-[calc(100vh-env(safe-area-inset-top)-env(safe-area-inset-bottom))] flex items-center justify-center bg-gray-50 p-4",children:t.jsx("div",{className:"bg-white rounded-2xl shadow-xl w-full max-w-md p-6",children:u?t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:"‚ùå"}),t.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-2",children:"Booking Declined"}),B&&t.jsx("p",{className:"text-xs text-gray-600 mb-3",children:B}),t.jsx("button",{onClick:()=>window.location.href="/",className:"bg-orange-600 text-white px-4 py-2 rounded w-full",children:"Return Home"})]}):t.jsxs(t.Fragment,{children:[t.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-2",children:"Decline Booking Request"}),t.jsxs("p",{className:"text-sm text-gray-600 mb-4",children:["Customer: ",t.jsx("span",{className:"font-medium",children:e.customerName||"Customer"})]}),t.jsx("div",{className:"bg-yellow-50 border-l-4 border-yellow-400 p-3 rounded text-xs text-yellow-800 mb-4",children:"This action will notify Indastreet & broadcast to other available therapists."}),t.jsx("button",{onClick:k,disabled:c,className:"w-full py-3 rounded-lg font-bold text-white ".concat(c?"bg-gray-300":"bg-red-600 hover:bg-red-700"),children:c?"Declining...":"Confirm Decline"}),t.jsx("button",{onClick:()=>{D(n),window.location.href="/"},className:"w-full mt-3 text-gray-600 text-sm",children:"Cancel & Silence"})]})})})},Se=Object.freeze(Object.defineProperty({__proto__:null,default:we},Symbol.toStringTag,{value:"Module"}));export{Te as A,re as B,Se as D,ue as T,Q as a,j as b,ke as c,E as m,D as s};
