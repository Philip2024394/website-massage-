import{a,j as e,S as j,t as L,m as M,h as F,a5 as B,W as z,v as k,ae as f,ak as _,n as q}from"./vendor-react.DJgHGAhw.js";import{f as o}from"./App.1fxTHtx8.js";import{l as C}from"./route-therapist.DVVqC6AH.js";import"./vendor-misc.BCNplu90.js";import"./vendor-ui.D6Y-8hbd.js";import"./vendor-appwrite.BT2H32tF.js";import"./route-portals.BJGRQhN_.js";import"./route-booking.yuk30L8G.js";import"./route-payment.T2FKxZVj.js";const Z=()=>{const[b,R]=a.useState([]),[i,I]=a.useState(null),[D,v]=a.useState(!0),[d,E]=a.useState("all"),[l,N]=a.useState(null),[U,y]=a.useState(!1),[t,w]=a.useState(null),[c,h]=a.useState(""),[S,p]=a.useState(""),[u,m]=a.useState(!1);a.useEffect(()=>{P()},[d]);const P=async()=>{v(!0);try{const[s,r]=await Promise.all([o.getStats(),o.listApplications(d==="all"?void 0:d)]);I(s),R(r)}catch(s){C.error("Error loading SafePass data:",s)}finally{v(!1)}},V=async()=>{if(!(!l||!t)){m(!0);try{const s=localStorage.getItem("adminId")||"admin";switch(t){case"approve":await o.approveApplication({applicationId:l.$id,approved:!0,adminId:s});break;case"reject":if(!c.trim()){alert("Please provide a rejection reason"),m(!1);return}await o.approveApplication({applicationId:l.$id,approved:!1,adminId:s,rejectionReason:c});break;case"activate":await o.activateApplication({applicationId:l.$id,safePassCardUrl:S||void 0});break;case"revoke":if(!c.trim()){alert("Please provide a revocation reason"),m(!1);return}await o.revokeApplication(l.$id,c);break}await P(),A()}catch(s){C.error("Error processing action:",s),alert("Error processing action. Please try again.")}finally{m(!1)}}},x=(s,r)=>{N(s),w(r),h(""),p(""),y(!0)},A=()=>{y(!1),N(null),w(null),h(""),p("")},T=s=>{const r={pending:{color:"bg-yellow-100 text-yellow-800",icon:q,label:"Pending Review"},approved:{color:"bg-blue-100 text-blue-800",icon:k,label:"Approved"},active:{color:"bg-green-100 text-green-800",icon:j,label:"Active"},rejected:{color:"bg-red-100 text-red-800",icon:f,label:"Rejected"}},n=r[s]||r.pending,$=n.icon;return e.jsxs("span",{className:"inline-flex items-center gap-1 px-3 py-1 rounded-full text-sm font-medium ".concat(n.color),children:[e.jsx($,{className:"w-4 h-4"}),n.label]})},g=s=>new Date(s).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});return e.jsxs("div",{className:"min-h-screen bg-gray-50 p-6",children:[e.jsxs("div",{className:"max-w-7xl mx-auto mb-8",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(j,{className:"w-8 h-8 text-orange-600"}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"SafePass Management"})]}),i&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Total Applications"}),e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:i.total})]}),e.jsxs("div",{className:"bg-yellow-50 p-4 rounded-lg shadow",children:[e.jsx("div",{className:"text-sm text-yellow-700",children:"Pending"}),e.jsx("div",{className:"text-2xl font-bold text-yellow-900",children:i.pending})]}),e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg shadow",children:[e.jsx("div",{className:"text-sm text-blue-700",children:"Approved"}),e.jsx("div",{className:"text-2xl font-bold text-blue-900",children:i.approved})]}),e.jsxs("div",{className:"bg-green-50 p-4 rounded-lg shadow",children:[e.jsx("div",{className:"text-sm text-green-700",children:"Active"}),e.jsx("div",{className:"text-2xl font-bold text-green-900",children:i.active})]}),e.jsxs("div",{className:"bg-red-50 p-4 rounded-lg shadow",children:[e.jsx("div",{className:"text-sm text-red-700",children:"Rejected"}),e.jsx("div",{className:"text-2xl font-bold text-red-900",children:i.rejected})]})]}),e.jsx("div",{className:"flex gap-2 mb-6 flex-wrap",children:["all","pending","approved","active","rejected"].map(s=>e.jsx("button",{onClick:()=>E(s),className:"px-4 py-2 rounded-lg font-medium transition-colors ".concat(d===s?"bg-orange-600 text-white":"bg-white text-gray-700 hover:bg-gray-100"),children:s.charAt(0).toUpperCase()+s.slice(1)},s))})]}),e.jsx("div",{className:"max-w-7xl mx-auto",children:D?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-orange-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Loading applications..."})]}):b.length===0?e.jsxs("div",{className:"bg-white rounded-lg shadow p-12 text-center",children:[e.jsx(L,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"No Applications Found"}),e.jsx("p",{className:"text-gray-600",children:"No SafePass applications match the selected filter."})]}):e.jsx("div",{className:"space-y-4",children:b.map(s=>e.jsxs("div",{className:"bg-white rounded-lg shadow hover:shadow-lg transition-shadow p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"p-3 rounded-lg ".concat(s.entityType==="therapist"?"bg-purple-100":"bg-blue-100"),children:s.entityType==="therapist"?e.jsx(M,{className:"w-6 h-6 text-purple-600"}):e.jsx(F,{className:"w-6 h-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:s.entityName}),e.jsx("p",{className:"text-sm text-gray-600 capitalize",children:s.entityType}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["ID: ",s.entityId]})]})]}),e.jsx("div",{children:T(s.hotelVillaSafePassStatus)})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Submitted:"}),e.jsx("span",{className:"ml-2 font-medium",children:g(s.safePassSubmittedAt)})]}),s.safePassApprovedAt&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Approved:"}),e.jsx("span",{className:"ml-2 font-medium",children:g(s.safePassApprovedAt)})]}),s.safePassIssuedAt&&s.hotelVillaSafePassStatus==="active"&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Issued:"}),e.jsx("span",{className:"ml-2 font-medium",children:g(s.safePassIssuedAt)})]}),s.safePassExpiry&&s.hotelVillaSafePassStatus==="active"&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Expires:"}),e.jsx("span",{className:"ml-2 font-medium",children:g(s.safePassExpiry)})]}),s.safePassPaymentId&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Payment ID:"}),e.jsx("span",{className:"ml-2 font-medium",children:s.safePassPaymentId})]})]}),s.hotelVillaLetters&&e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"Supporting Documents:"}),e.jsx("div",{className:"flex gap-2 flex-wrap",children:JSON.parse(s.hotelVillaLetters).map((r,n)=>e.jsxs("a",{href:r,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1 px-3 py-1 bg-gray-100 hover:bg-gray-200 rounded text-sm text-gray-700",children:[e.jsx(B,{className:"w-4 h-4"}),"Document ",n+1,e.jsx(z,{className:"w-3 h-3"})]},n))})]}),s.safePassRejectionReason&&e.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded",children:e.jsxs("p",{className:"text-sm text-red-800",children:[e.jsx("strong",{children:"Rejection Reason:"})," ",s.safePassRejectionReason]})}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[s.hotelVillaSafePassStatus==="pending"&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>x(s,"approve"),className:"px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg font-medium transition-colors flex items-center gap-2",children:[e.jsx(k,{className:"w-4 h-4"}),"Approve"]}),e.jsxs("button",{onClick:()=>x(s,"reject"),className:"px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg font-medium transition-colors flex items-center gap-2",children:[e.jsx(f,{className:"w-4 h-4"}),"Reject"]})]}),s.hotelVillaSafePassStatus==="approved"&&e.jsxs("button",{onClick:()=>x(s,"activate"),className:"px-4 py-2 bg-orange-600 hover:bg-orange-700 text-white rounded-lg font-medium transition-colors flex items-center gap-2",children:[e.jsx(j,{className:"w-4 h-4"}),"Activate SafePass"]}),s.hotelVillaSafePassStatus==="active"&&e.jsxs("button",{onClick:()=>x(s,"revoke"),className:"px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg font-medium transition-colors flex items-center gap-2",children:[e.jsx(f,{className:"w-4 h-4"}),"Revoke SafePass"]}),s.safePassCardUrl&&e.jsxs("a",{href:s.safePassCardUrl,target:"_blank",rel:"noopener noreferrer",className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors flex items-center gap-2",children:[e.jsx(_,{className:"w-4 h-4"}),"View Card"]})]})]},s.$id))})}),U&&l&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full p-6",children:[e.jsxs("h3",{className:"text-xl font-bold text-gray-900 mb-4",children:[t==="approve"&&"Approve Application",t==="reject"&&"Reject Application",t==="activate"&&"Activate SafePass",t==="revoke"&&"Revoke SafePass"]}),e.jsxs("p",{className:"text-gray-600 mb-4",children:[l.entityName," (",l.entityType,")"]}),(t==="reject"||t==="revoke")&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Reason for ",t==="reject"?"Rejection":"Revocation"]}),e.jsx("textarea",{value:c,onChange:s=>h(s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500",rows:4,placeholder:"Provide a clear reason...",required:!0})]}),t==="activate"&&e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"SafePass Card URL (optional)"}),e.jsx("input",{type:"url",value:S,onChange:s=>p(s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500",placeholder:"https://..."})]}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx("button",{onClick:A,disabled:u,className:"px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-800 rounded-lg font-medium transition-colors disabled:opacity-50",children:"Cancel"}),e.jsx("button",{onClick:V,disabled:u,className:"px-4 py-2 bg-orange-600 hover:bg-orange-700 text-white rounded-lg font-medium transition-colors disabled:opacity-50 flex items-center gap-2",children:u?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Processing..."]}):"Confirm"})]})]})})]})};export{Z as default};
