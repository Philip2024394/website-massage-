<!DOCTYPE html>
<html>
<head>
    <title>Populate Appwrite Reviews</title>
    <script src="https://cdn.jsdelivr.net/npm/appwrite@15.0.0"></script>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 50px auto; padding: 20px; }
        .log { background: #f5f5f5; padding: 10px; margin: 10px 0; border-radius: 5px; }
        .success { color: green; }
        .error { color: red; }
        button { background: #4CAF50; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; margin: 10px 5px; }
        button:hover { background: #45a049; }
        .warning { background: #fff3cd; padding: 10px; border-left: 4px solid #ffc107; margin: 10px 0; }
    </style>
</head>
<body>
    <h1>üåü Populate Therapist Reviews</h1>
    <div class="warning">
        ‚ö†Ô∏è First, check your Appwrite Console to find the Reviews Collection ID:<br>
        1. Go to <a href="https://syd.cloud.appwrite.io/console/project-68f23b11000d25eb3664/databases/database-68f76ee1000e64ca8d05" target="_blank">Appwrite Console</a><br>
        2. Look for a collection with "review" in the name<br>
        3. Copy its ID and paste below
    </div>
    
    <div style="margin: 20px 0;">
        <label for="collectionId">Reviews Collection ID:</label><br>
        <input type="text" id="collectionId" value="reviews_collection_id" style="width: 400px; padding: 5px; margin: 10px 0;">
        <button onclick="testCollectionId()">Test Collection ID</button>
    </div>
    
    <button onclick="populateAllReviews()">Generate Reviews for All Therapists</button>
    <button onclick="populateBimanReviews()">Generate Reviews for Biman Only</button>
    <button onclick="checkReviews()">Check Existing Reviews</button>
    
    <div id="logs"></div>

    <script>
        const { Client, Databases, ID } = Appwrite;

        const client = new Client()
            .setEndpoint('https://syd.cloud.appwrite.io/v1')
            .setProject('68f23b11000d25eb3664');

        const databases = new Databases(client);
        const databaseId = '68f76ee1000e64ca8d05';
        
        function getCollectionId() {
            return document.getElementById('collectionId').value;
        }

        // Therapist list with IDs
        const therapists = [
            { id: '694fa81cd8ff39b89351', name: 'Biman' },
            { id: '694fa7f100075d6b2bf0', name: 'Winda' },
            { id: '694fa81a002c33bf5eb2', name: 'Ela' },
            { id: '694fa81a00226dc23eff', name: 'Wiwid' },
            { id: '694fa819001ddc2a0a0c', name: 'Dyan' },
            { id: '694fa7ed0035084e2cd6', name: 'Budi' }
        ];

        // Sample review templates
        const reviewTemplates = [
            { rating: 5, text: "Excellent massage! Very professional and relaxing. Highly recommend!" },
            { rating: 5, text: "Amazing experience! The therapist was skilled and attentive." },
            { rating: 5, text: "Best massage I've had in Yogyakarta. Will definitely come back!" },
            { rating: 4, text: "Great massage, very relaxing. The atmosphere was perfect." },
            { rating: 5, text: "Outstanding service! Very professional and the technique was superb." },
            { rating: 5, text: "Incredible massage therapy. My back pain is completely gone!" },
            { rating: 4, text: "Very good massage. The therapist knew exactly what I needed." },
            { rating: 5, text: "Perfect massage! Great technique and very relaxing environment." },
            { rating: 5, text: "Absolutely wonderful! The therapist was amazing and very skilled." },
            { rating: 5, text: "Fantastic experience! I feel so much better after the massage." }
        ];

        const reviewerNames = [
            'Sarah Johnson', 'Michael Chen', 'Emma Williams', 'David Lee',
            'Sophie Martin', 'James Brown', 'Olivia Garcia', 'Daniel Rodriguez',
            'Isabella Martinez', 'Alexander Kim', 'Mia Anderson', 'Ethan Taylor'
        ];

        function log(message, type = 'info') {
            const logsDiv = document.getElementById('logs');
            const logEntry = document.createElement('div');
            logEntry.className = `log ${type}`;
            logEntry.innerHTML = `${new Date().toLocaleTimeString()}: ${message}`;
            logsDiv.appendChild(logEntry);
            console.log(message);
        }

        async function createReview(therapistId, therapistName, rating, reviewText, reviewerName) {
            try {
                const reviewsCollectionId = getCollectionId();
                const now = new Date().toISOString();
                const reviewerId = `anonymous_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
                
                const response = await databases.createDocument(
                    databaseId,
                    reviewsCollectionId,
                    ID.unique(),
                    {
                        reviewId: ID.unique(),
                        providerId: therapistId,
                        providerType: 'therapist',
                        rating: rating,
                        reviewContent: reviewText,
                        reviewerId: reviewerId,
                        reviewDate: now,
                        createdAt: now,
                        userName: reviewerName,
                        userId: null,
                        status: 'approved',
                        likes: Math.floor(Math.random() * 10),
                        comment: null
                    }
                );
                
                log(`‚úÖ Created review for ${therapistName} by ${reviewerName}`, 'success');
                return response;
            } catch (error) {
                log(`‚ùå Error creating review for ${therapistName}: ${error.message}`, 'error');
                throw error;
            }
        }

        async function populateReviewsForTherapist(therapist, count = 5) {
            log(`üìù Generating ${count} reviews for ${therapist.name}...`);
            
            for (let i = 0; i < count; i++) {
                const template = reviewTemplates[i % reviewTemplates.length];
                const reviewerName = reviewerNames[Math.floor(Math.random() * reviewerNames.length)];
                
                await createReview(
                    therapist.id,
                    therapist.name,
                    template.rating,
                    template.text,
                    reviewerName
                );
                
                // Small delay to avoid rate limiting
                await new Promise(resolve => setTimeout(resolve, 300));
            }
            
            log(`üéâ Completed ${count} reviews for ${therapist.name}`, 'success');
        }

        async function testCollectionId() {
            const collectionId = getCollectionId();
            log(`üß™ Testing collection ID: ${collectionId}`);
            
            try {
                const response = await databases.listDocuments(databaseId, collectionId);
                log(`‚úÖ Collection ID is valid! Found ${response.total} existing reviews`, 'success');
            } catch (error) {
                log(`‚ùå Invalid collection ID: ${error.message}`, 'error');
                log('üí° Please check your Appwrite Console for the correct Reviews collection ID', 'error');
            }
        }

        async function populateAllReviews() {
            log('ÔøΩüöÄ Starting to populate reviews for all therapists...');
            
            try {
                for (const therapist of therapists) {
                    await populateReviewsForTherapist(therapist, 5);
                }
                
                log('üéä Successfully populated reviews for all therapists!', 'success');
                log('üëâ Refresh your website to see the reviews!', 'success');
            } catch (error) {
                log(`‚ùå Error: ${error.message}`, 'error');
            }
        }

        async function populateBimanReviews() {
            log('üöÄ Starting to populate reviews for Biman...');
            
            try {
                const biman = therapists.find(t => t.name === 'Biman');
                await populateReviewsForTherapist(biman, 7);
                
                log('üéä Successfully populated reviews for Biman!', 'success');
                log('üëâ Refresh your website to see the reviews!', 'success');
            } catch (error) {
                log(`‚ùå Error: ${error.message}`, 'error');
            }
        }

        async function checkReviews() {
            log('üîç Checking existing reviews...');
            
            try {
                const reviewsCollectionId = getCollectionId();
                const response = await databases.listDocuments(
                    databaseId,
                    reviewsCollectionId
                );
                
                log(`üìä Found ${response.total} total reviews in database`, 'success');
                
                // Count by therapist
                const countByTherapist = {};
                response.documents.forEach(review => {
                    const therapist = therapists.find(t => t.id === review.providerId);
                    const name = therapist ? therapist.name : review.providerId;
                    countByTherapist[name] = (countByTherapist[name] || 0) + 1;
                });
                
                Object.entries(countByTherapist).forEach(([name, count]) => {
                    log(`  - ${name}: ${count} reviews`);
                });
                
            } catch (error) {
                log(`‚ùå Error checking reviews: ${error.message}`, 'error');
                console.error('Full error:', error);
            }
        }
    </script>
</body>
</html>
