<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Populate Appwrite Reviews</title>
    <script src="https://cdn.jsdelivr.net/npm/appwrite@13/dist/browser/appwrite.min.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 900px;
            margin: 30px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 { color: #2c3e50; }
        button {
            background: #3498db;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
        }
        button:hover { background: #2980b9; }
        button:disabled { background: #95a5a6; cursor: not-allowed; }
        .success { background: #27ae60; }
        .danger { background: #e74c3c; }
        #output {
            margin-top: 20px;
            padding: 15px;
            background: #ecf0f1;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            white-space: pre-wrap;
            max-height: 500px;
            overflow-y: auto;
        }
        .progress {
            width: 100%;
            height: 30px;
            background: #ecf0f1;
            border-radius: 15px;
            overflow: hidden;
            margin: 15px 0;
        }
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #3498db, #2ecc71);
            transition: width 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéØ Populate Appwrite Reviews</h1>
        <p>Generate initial reviews for all Yogyakarta therapists</p>
        
        <div>
            <button id="startBtn" class="success" onclick="populateReviews()">‚ú® Generate Reviews for All Therapists</button>
            <button onclick="checkExisting()">üìä Check Existing Reviews</button>
        </div>
        
        <div class="progress" id="progressContainer" style="display: none;">
            <div class="progress-bar" id="progressBar">0%</div>
        </div>
        
        <div id="output"></div>
    </div>

    <script>
        const ENDPOINT = 'https://syd.cloud.appwrite.io/v1';
        const PROJECT_ID = '68f23b11000d25eb3664';
        const DATABASE_ID = '68f76ee1000e64ca8d05';
        const REVIEWS_COLLECTION = 'reviews_collection_id';

        const client = new Appwrite.Client()
            .setEndpoint(ENDPOINT)
            .setProject(PROJECT_ID);

        const databases = new Appwrite.Databases(client);

        const THERAPISTS = [
            { id: '692467a3001f6f05aaa1', name: 'Budi' },
            { id: '69499239000c90bfd283', name: 'ww' },
            { id: '694a02cd0036089583db', name: 'ww' },
            { id: '694ed78e002b0c06171e', name: 'Wiwid' },
            { id: '694fa14f54e047d47576', name: 'Ela' },
            { id: '694fa81cd8ff39b89351', name: 'Biman' }
        ];

        const NAMES = [
            'Sarah Mitchell', 'John Davis', 'Emma Rodriguez', 'Michael Chen',
            'Lisa Thompson', 'David Kim', 'Anna Schmidt', 'James Wilson',
            'Maria Garcia', 'Robert Lee', 'Sophie Turner', 'Chris Anderson',
            'Rachel Brown', 'Tom Martinez', 'Amy Johnson', 'Mark Williams'
        ];

        const COMMENTS = [
            'Excellent massage! Very professional and skilled.',
            'Amazing experience, felt completely relaxed.',
            'Best massage I\'ve had in Yogyakarta!',
            'Highly recommend! Very attentive to my needs.',
            'Professional service from start to finish.',
            'Great technique and wonderful atmosphere.',
            'Outstanding therapist, will definitely return.',
            'Perfect pressure and timing throughout.',
            'Helped tremendously with my back pain.',
            'Very skilled with deep tissue massage.',
            'Relaxing and rejuvenating experience.',
            'Exceeded my expectations completely.',
            'Wonderful service, very satisfied.',
            'Expert technique and friendly manner.',
            'Fantastic massage, highly professional.'
        ];

        async function checkExisting() {
            const output = document.getElementById('output');
            output.textContent = 'Checking existing reviews...\n\n';

            try {
                for (const therapist of THERAPISTS) {
                    const reviews = await databases.listDocuments(
                        DATABASE_ID,
                        REVIEWS_COLLECTION,
                        [
                            Appwrite.Query.equal('providerId', therapist.id),
                            Appwrite.Query.equal('providerType', 'therapist')
                        ]
                    );
                    output.textContent += `${therapist.name}: ${reviews.documents.length} reviews\n`;
                }
            } catch (error) {
                output.textContent += `\n‚ùå Error: ${error.message}`;
            }
        }

        async function populateReviews() {
            const output = document.getElementById('output');
            const startBtn = document.getElementById('startBtn');
            const progressContainer = document.getElementById('progressContainer');
            const progressBar = document.getElementById('progressBar');

            startBtn.disabled = true;
            progressContainer.style.display = 'block';
            output.textContent = 'üöÄ Starting review generation...\n\n';

            let totalReviews = 0;
            let totalGenerated = 0;
            const reviewsPerTherapist = 10;

            for (let i = 0; i < THERAPISTS.length; i++) {
                const therapist = THERAPISTS[i];
                output.textContent += `\nüìù Generating reviews for ${therapist.name}...\n`;

                // Check existing reviews first
                try {
                    const existing = await databases.listDocuments(
                        DATABASE_ID,
                        REVIEWS_COLLECTION,
                        [
                            Appwrite.Query.equal('providerId', therapist.id),
                            Appwrite.Query.equal('providerType', 'therapist')
                        ]
                    );

                    if (existing.documents.length > 0) {
                        output.textContent += `   ‚è≠Ô∏è  Already has ${existing.documents.length} reviews (skipped)\n`;
                        continue;
                    }
                } catch (e) {
                    // Continue if check fails
                }

                // Generate reviews
                for (let j = 0; j < reviewsPerTherapist; j++) {
                    try {
                        const rating = Math.random() > 0.15 ? 5 : 4; // 85% 5-star
                        const daysAgo = Math.floor(Math.random() * 30) + 1; // 1-30 days ago
                        const reviewDate = new Date(Date.now() - (daysAgo * 86400000)).toISOString();

                        await databases.createDocument(
                            DATABASE_ID,
                            REVIEWS_COLLECTION,
                            Appwrite.ID.unique(),
                            {
                                reviewId: Appwrite.ID.unique(),
                                providerId: therapist.id,
                                providerType: 'therapist',
                                rating: rating,
                                reviewContent: COMMENTS[(i * 3 + j) % COMMENTS.length],
                                reviewerId: `user_${Date.now()}_${j}`,
                                reviewDate: reviewDate,
                                createdAt: reviewDate,
                                userName: NAMES[(i * 2 + j) % NAMES.length],
                                userId: null,
                                status: 'approved',
                                likes: Math.floor(Math.random() * 5),
                                comment: null
                            }
                        );

                        totalGenerated++;
                        totalReviews++;

                        // Update progress
                        const progress = Math.round((totalReviews / (THERAPISTS.length * reviewsPerTherapist)) * 100);
                        progressBar.style.width = progress + '%';
                        progressBar.textContent = progress + '%';

                    } catch (error) {
                        output.textContent += `   ‚ùå Error: ${error.message}\n`;
                    }
                }

                output.textContent += `   ‚úÖ Generated ${reviewsPerTherapist} reviews\n`;
                output.scrollTop = output.scrollHeight;
            }

            output.textContent += `\n\nüéâ COMPLETE!\n`;
            output.textContent += `Generated ${totalGenerated} total reviews\n`;
            output.textContent += `\nüìã Next steps:\n`;
            output.textContent += `1. Refresh your app\n`;
            output.textContent += `2. Visit therapist profiles\n`;
            output.textContent += `3. Reviews should now display from Appwrite!\n`;

            startBtn.disabled = false;
        }

        // Check on load
        window.addEventListener('load', checkExisting);
    </script>
</body>
</html>
