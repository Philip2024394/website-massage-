<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîç Find Appwrite Collection IDs</title>
    <script src="https://cdn.jsdelivr.net/npm/appwrite@16.0.2/dist/umd/sdk.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            min-height: 100vh; 
            padding: 20px;
        }
        .container { 
            max-width: 900px; 
            margin: 0 auto; 
            background: white; 
            border-radius: 20px; 
            padding: 30px; 
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        h1 { 
            text-align: center; 
            color: #333; 
            margin-bottom: 30px; 
            font-size: 2rem;
        }
        .info { 
            background: #e3f2fd; 
            border: 1px solid #2196f3; 
            padding: 15px; 
            border-radius: 8px; 
            margin: 15px 0; 
            color: #1565c0;
        }
        .success { 
            background: #e8f5e8; 
            border: 1px solid #4caf50; 
            padding: 15px; 
            border-radius: 8px; 
            margin: 15px 0; 
            color: #2e7d32;
        }
        .error { 
            background: #ffebee; 
            border: 1px solid #f44336; 
            padding: 15px; 
            border-radius: 8px; 
            margin: 15px 0; 
            color: #c62828;
        }
        .warning { 
            background: #fff3e0; 
            border: 1px solid #ff9800; 
            padding: 15px; 
            border-radius: 8px; 
            margin: 15px 0; 
            color: #ef6c00;
        }
        button {
            background: linear-gradient(45deg, #667eea, #764ba2);
            border: none;
            color: white;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
            transition: all 0.3s ease;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }
        .code-block {
            background: #f5f5f5;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            margin: 10px 0;
        }
        .collection-id {
            background: #e8f5e8;
            border: 2px solid #4caf50;
            padding: 10px;
            border-radius: 6px;
            font-family: monospace;
            font-weight: bold;
            color: #2e7d32;
            margin: 5px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Find Real Appwrite Collection IDs</h1>
        
        <div class="info">
            <strong>üéØ Goal:</strong> Find the actual collection IDs in your Appwrite database to replace the placeholder values like 'therapists_collection_id'
        </div>

        <button onclick="findCollections()">üîç Find All Collections</button>
        <button onclick="testTherapistConnection()">üß™ Test Therapist Collection</button>

        <div id="results"></div>

        <div id="config-fix" style="display: none;">
            <h3>üìù Configuration Fix Code</h3>
            <div class="info">Copy this code to update your lib/appwrite.config.ts file:</div>
            <div class="code-block" id="fix-code"></div>
        </div>
    </div>

    <script>
        // Appwrite configuration 
        const APPWRITE_CONFIG = {
            endpoint: 'https://syd.cloud.appwrite.io/v1',
            projectId: '68f23b11000d25eb3664',
            databaseId: '68f76ee1000e64ca8d05'
        };

        // Initialize Appwrite
        const client = new Appwrite.Client()
            .setEndpoint(APPWRITE_CONFIG.endpoint)
            .setProject(APPWRITE_CONFIG.projectId);

        const databases = new Appwrite.Databases(client);

        function log(message, type = 'info') {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = type;
            div.innerHTML = message;
            results.appendChild(div);
            console.log(message);
        }

        async function findCollections() {
            try {
                log('üîç Connecting to Appwrite database...', 'info');
                
                const response = await databases.list();
                
                log(`‚úÖ Connected! Found ${response.databases.length} databases`, 'success');
                
                // Find our specific database
                const targetDatabase = response.databases.find(db => db.$id === APPWRITE_CONFIG.databaseId);
                
                if (!targetDatabase) {
                    log(`‚ùå Database ${APPWRITE_CONFIG.databaseId} not found`, 'error');
                    return;
                }
                
                log(`üìã Found target database: ${targetDatabase.name || 'Unnamed'}`, 'info');
                
                // Now get collections from this database
                const collections = await databases.listCollections(APPWRITE_CONFIG.databaseId);
                
                log(`üìÅ Found ${collections.collections.length} collections:`, 'success');
                
                const foundCollections = {};
                
                collections.collections.forEach(collection => {
                    const name = collection.name.toLowerCase();
                    const id = collection.$id;
                    
                    log(`  ‚Ä¢ ${collection.name} (ID: <span class="collection-id">${id}</span>)`, 'info');
                    
                    // Try to identify collection types by name
                    if (name.includes('therapist')) {
                        foundCollections.therapists = id;
                        log(`    üéØ Found THERAPISTS collection!`, 'success');
                    }
                    if (name.includes('place') || name.includes('venue')) {
                        foundCollections.places = id;
                        log(`    üè¢ Found PLACES collection!`, 'success');
                    }
                    if (name.includes('user') && !name.includes('registration')) {
                        foundCollections.users = id;
                        log(`    üë§ Found USERS collection!`, 'success');
                    }
                    if (name.includes('booking')) {
                        foundCollections.bookings = id;
                        log(`    üìÖ Found BOOKINGS collection!`, 'success');
                    }
                    if (name.includes('agent')) {
                        foundCollections.agents = id;
                        log(`    ü§ù Found AGENTS collection!`, 'success');
                    }
                });

                if (Object.keys(foundCollections).length > 0) {
                    generateConfigFix(foundCollections);
                } else {
                    log('‚ö†Ô∏è No matching collections found. Please check collection names manually.', 'warning');
                }

            } catch (error) {
                log(`‚ùå Error connecting to Appwrite: ${error.message}`, 'error');
                
                if (error.message.includes('401') || error.message.includes('Unauthorized')) {
                    log('üîë This might be a permissions issue. Make sure your Appwrite project allows public access to list collections.', 'warning');
                }
            }
        }

        async function testTherapistConnection() {
            try {
                log('üß™ Testing therapist collection with placeholder ID...', 'info');
                
                // Try with the placeholder ID first
                try {
                    await databases.listDocuments(
                        APPWRITE_CONFIG.databaseId,
                        'therapists_collection_id'
                    );
                    log('‚ùå Placeholder ID "therapists_collection_id" does not work as expected', 'error');
                } catch (placeholderError) {
                    log('‚úÖ Confirmed: Placeholder "therapists_collection_id" fails (this is expected)', 'success');
                    log(`Error: ${placeholderError.message}`, 'warning');
                }
                
            } catch (error) {
                log(`‚ùå Connection test failed: ${error.message}`, 'error');
            }
        }

        function generateConfigFix(collections) {
            let configCode = `// Updated collection IDs for lib/appwrite.config.ts\n\ncollections: {\n`;
            
            if (collections.therapists) {
                configCode += `    therapists: '${collections.therapists}', // ‚úÖ Real collection ID\n`;
            }
            if (collections.places) {
                configCode += `    places: '${collections.places}', // ‚úÖ Real collection ID\n`;
            }
            if (collections.users) {
                configCode += `    users: '${collections.users}', // ‚úÖ Real collection ID\n`;
            }
            if (collections.bookings) {
                configCode += `    bookings: '${collections.bookings}', // ‚úÖ Real collection ID\n`;
            }
            if (collections.agents) {
                configCode += `    agents: '${collections.agents}', // ‚úÖ Real collection ID\n`;
            }
            
            configCode += `    // Keep other collections as they are...\n    admins: 'admin_messages',\n    // ... rest of collections\n}\n`;
            
            document.getElementById('fix-code').textContent = configCode;
            document.getElementById('config-fix').style.display = 'block';
            
            log('üéâ Configuration fix generated! See the code block below.', 'success');
        }

        // Auto-run on page load
        window.addEventListener('load', () => {
            log('üöÄ Ready to find your Appwrite collection IDs!', 'info');
            log('Click "Find All Collections" to scan your database.', 'info');
        });
    </script>
</body>
</html>