# Bank Account Settings - Appwrite Setup Guide

This guide will help you set up the bank account management system in Appwrite.

## 🎯 Overview

The bank account settings allow admins to:
- Add/edit/delete bank accounts from the admin dashboard
- Activate/deactivate banks dynamically
- Have all active banks automatically displayed on the payment page
- Allow users to choose which bank to transfer to

---

## 📋 Step 1: Create Appwrite Collection

### Go to your Appwrite Console:
1. Navigate to **Databases**
2. Select your database (e.g., `indaStreetDB`) or create a new one
3. Click **"Add Collection"**

### Collection Settings:
- **Collection ID**: `bankAccounts`
- **Collection Name**: `Bank Accounts`

---

## 🔧 Step 2: Add Attributes

✅ **Your Appwrite collection is already set up with these attributes:**

### 1. $id (String) - Auto-generated
- **Type**: String
- **Auto-generated by Appwrite**

### 2. accountNumber (String) - Required
- **Type**: String
- **Size**: 16
- **Required**: ✅ Yes

### 3. accountType (String) - Required
- **Type**: String  
- **Size**: 32
- **Required**: ✅ Yes
- **Example**: "savings", "checking", "business"

### 4. balance (Double) - Required
- **Type**: Double
- **Required**: ✅ Yes
- **Default**: 0

### 5. currency (String) - Required
- **Type**: String
- **Size**: 3
- **Required**: ✅ Yes
- **Example**: "IDR", "USD"

### 6. isJointAccount (Boolean)
- **Type**: Boolean
- **Required**: ❌ No
- **Default**: NULL

### 7. primaryHolderId (String) - Required
- **Type**: String
- **Size**: 64
- **Required**: ✅ Yes

### 8. secondaryHolderId (String)
- **Type**: String
- **Size**: 64
- **Required**: ❌ No
- **Default**: NULL

### 9. bankName (String) - Required
- **Type**: String
- **Size**: 255
- **Required**: ✅ Yes
- **Example**: "Bank Central Asia (BCA)"

### 10. accountName (String) - Required
- **Type**: String
- **Size**: 255
- **Required**: ✅ Yes
- **Example**: "INDA STREET LTD"

### 11. isActive (Boolean) - Required
- **Type**: Boolean
- **Required**: ✅ Yes
- **Default**: true

### 12. createdAt (DateTime)
- **Type**: DateTime
- **Required**: ❌ No
- **Default**: NULL

### 13. $createdAt (DateTime) - Auto-generated
- **Type**: DateTime
- **Auto-generated by Appwrite**

### 14. $updatedAt (DateTime) - Auto-generated
- **Type**: DateTime
- **Auto-generated by Appwrite**

---

## ✅ Your Collection is Already Complete!

All attributes match your Appwrite setup. The code has been updated to work with your exact schema.

---

## 🔐 Step 3: Set Permissions

### Collection Permissions:
1. Go to **Settings** tab of the collection
2. Add the following permissions:

#### For Admin Users:
- **Create**: Role: Any (or specific admin role)
- **Read**: Role: Any (needed for payment page)
- **Update**: Role: Any (or specific admin role)
- **Delete**: Role: Any (or specific admin role)

> **Note**: Set `Read` to `Any` so the payment page can fetch active banks. Create/Update/Delete should be restricted to admin only if you have authentication.

---

## 📝 Step 4: Create Indexes (Optional but Recommended)

Create these indexes for better performance:

### Index 1: isActive
- **Key**: `isActive_index`
- **Type**: Key
- **Attributes**: `isActive` (ASC)

### Index 2: createdAt
- **Key**: `createdAt_index`
- **Type**: Key
- **Attributes**: `createdAt` (DESC)

---

## ⚙️ Step 5: Update Configuration in Code

### Update Database and Collection IDs:

**In `pages/AdminBankSettingsPage.tsx` (Line 23-24):**
```typescript
const DATABASE_ID = 'YOUR_DATABASE_ID'; // Replace with your actual database ID
const COLLECTION_ID = 'bankAccounts';   // Use this exact ID
```

**In `pages/JobUnlockPaymentPage.tsx` (Line 21-22):**
```typescript
const DATABASE_ID = 'YOUR_DATABASE_ID'; // Replace with your actual database ID
const COLLECTION_ID = 'bankAccounts';   // Use this exact ID
```

### How to find your Database ID:
1. Go to Appwrite Console → Databases
2. Click on your database
3. Copy the **Database ID** from the top of the page

---

## 🚀 Step 6: Test the System

### 1. Access Admin Bank Settings:
Navigate to: `http://localhost:3004/#adminBankSettings` (or your domain)

### 2. Add Your First Bank Account:
- Click **"Add New Bank Account"**
- Enter bank details:
  - Bank Name: `Bank Central Asia (BCA)`
  - Account Number: `1234567890`
  - Account Name: `INDA STREET LTD`
  - Active: ✅ Checked
- Click **"Add Bank Account"**

### 3. Verify on Payment Page:
- Go to the job listings page
- Click **"Upgrade to Unlock Details"** (green button)
- You should see your bank account details displayed

### 4. Test Multiple Banks:
- Add 2-3 different banks
- Make sure some are active and some inactive
- Check payment page - only active banks should appear
- If multiple active banks exist, users can select which one to use

---

## 🎨 Features

### Admin Dashboard Features:
✅ Add new bank accounts  
✅ Edit existing bank accounts  
✅ Delete bank accounts  
✅ Toggle active/inactive status  
✅ View all banks with status indicators  
✅ Copy account numbers to clipboard  

### Payment Page Features:
✅ Automatically fetches only active banks  
✅ Shows bank selection if multiple banks available  
✅ Auto-selects first bank if only one available  
✅ Fallback to hardcoded bank if database fetch fails  
✅ Copy bank details to clipboard  
✅ Loading state while fetching banks  

---

## 🔄 How to Access Admin Bank Settings

### Option 1: Direct URL
Navigate to: `http://localhost:3004/#adminBankSettings`

### Option 2: Add to Admin Dashboard (Recommended)
Add a button in your `AdminDashboardPage.tsx`:

```typescript
<button
    onClick={() => window.location.href = '/#adminBankSettings'}
    className="bg-orange-500 hover:bg-orange-600 text-white font-semibold py-3 px-6 rounded-lg"
>
    💳 Manage Bank Accounts
</button>
```

---

## 🛠️ Troubleshooting

### Issue: "Failed to load bank accounts"
**Solution**: 
- Check if collection ID is correct
- Verify database ID is correct
- Ensure read permissions are set to "Any"
- Check browser console for detailed error

### Issue: Banks not showing on payment page
**Solution**:
- Make sure banks are marked as "Active"
- Check if `isActive` is set to `true` in database
- Verify the payment page is using correct database/collection IDs

### Issue: Cannot add/edit banks
**Solution**:
- Check if Create/Update permissions are properly set
- Verify you're logged in as admin (if authentication is enabled)
- Check browser console for detailed error

---

## 📱 WhatsApp Integration

Don't forget to update the admin WhatsApp number in:

**`pages/JobUnlockPaymentPage.tsx` (Line 23):**
```typescript
const adminWhatsApp = '6281234567890'; // Replace with your WhatsApp number
```

Use international format without + or spaces:
- ✅ Correct: `6281234567890`
- ❌ Wrong: `+62 812-3456-7890`

---

## 🎯 Summary

1. ✅ Create `bankAccounts` collection in Appwrite
2. ✅ Add 5 attributes (bankName, accountNumber, accountName, isActive, createdAt)
3. ✅ Set permissions (Read: Any, Create/Update/Delete: Admin)
4. ✅ Update DATABASE_ID in both pages
5. ✅ Update admin WhatsApp number
6. ✅ Access admin settings at `/#adminBankSettings`
7. ✅ Add your first bank account
8. ✅ Test on payment page

---

## 🎉 You're Done!

Your bank account management system is now fully operational. Admins can manage bank accounts from the dashboard, and users will see the updated banks automatically on the payment page!

**Need help?** Check the Appwrite documentation or contact support.
