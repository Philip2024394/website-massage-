<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Appwrite Auth Test</title>
    <script src="https://cdn.jsdelivr.net/npm/appwrite@21.4.0"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .log { margin: 10px 0; padding: 10px; background: #f5f5f5; border-radius: 5px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
        #testForm { margin: 20px 0; padding: 20px; border: 1px solid #ddd; border-radius: 5px; }
    </style>
</head>
<body>
    <h1>üîç Appwrite Authentication Test</h1>
    <div id="logs"></div>
    
    <form id="testForm">
        <h3>Test Sign In</h3>
        <div style="margin: 10px 0;">
            <label for="email">Email:</label><br>
            <input type="email" id="email" value="test@example.com" style="width: 300px; padding: 8px;">
        </div>
        <div style="margin: 10px 0;">
            <label for="password">Password:</label><br>
            <input type="password" id="password" value="testpassword" style="width: 300px; padding: 8px;">
        </div>
        <button type="submit" style="padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 5px;">Test Sign In</button>
    </form>
    
    <script>
        const logs = document.getElementById('logs');
        
        function addLog(message, type = 'info') {
            console.log(message);
            const logElement = document.createElement('div');
            logElement.className = `log ${type}`;
            logElement.innerHTML = `<strong>[${new Date().toLocaleTimeString()}]</strong> ${message}`;
            logs.appendChild(logElement);
            logs.scrollTop = logs.scrollHeight;
        }
        
        addLog('üîç Testing Appwrite SDK availability...');
        
        if (typeof window.Appwrite !== 'undefined') {
            addLog('‚úÖ Appwrite SDK loaded successfully', 'success');
            
            // Create client and account exactly like in SimpleSignupFlow.tsx
            const client = new Appwrite.Client()
                .setEndpoint('https://syd.cloud.appwrite.io/v1')
                .setProject('68f23b11000d25eb3664');
            
            const account = new Appwrite.Account(client);
            
            addLog('‚úÖ Client and Account created', 'success');
            
            // Check if createEmailSession method exists
            if (typeof account.createEmailSession === 'function') {
                addLog('‚úÖ createEmailSession method is available', 'success');
                addLog(`üîç Method signature: ${account.createEmailSession.toString().substring(0, 100)}...`);
            } else {
                addLog('‚ùå createEmailSession method is NOT available', 'error');
                addLog('üîç Available methods: ' + Object.getOwnPropertyNames(account.__proto__).filter(name => !name.startsWith('_')).join(', '));
            }
            
            // Check current session
            account.get()
                .then(user => {
                    addLog(`‚úÖ Already logged in as: ${user.email} (ID: ${user.$id})`, 'success');
                })
                .catch(err => {
                    addLog(`‚ÑπÔ∏è Not logged in: ${err.message}`);
                });
            
            // Test form submission
            document.getElementById('testForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                
                const email = document.getElementById('email').value.toLowerCase().trim();
                const password = document.getElementById('password').value;
                
                addLog(`üîÑ Testing createEmailSession with email: ${email}`);
                
                try {
                    // Clear existing session first
                    try {
                        await account.deleteSession('current');
                        addLog('üóëÔ∏è Cleared existing session');
                    } catch {
                        addLog('‚ÑπÔ∏è No existing session to clear');
                    }
                    
                    // Test createEmailSession
                    const session = await account.createEmailSession(email, password);
                    addLog(`‚úÖ createEmailSession SUCCESS! Session ID: ${session.$id}`, 'success');
                    
                    // Get user info
                    const user = await account.get();
                    addLog(`‚úÖ Retrieved user info: ${user.email}`, 'success');
                    
                } catch (error) {
                    addLog(`‚ùå createEmailSession FAILED: ${error.message}`, 'error');
                    addLog(`üîç Error type: ${error.constructor.name}`);
                    addLog(`üîç Error code: ${error.code || 'N/A'}`);
                }
            });
            
        } else {
            addLog('‚ùå Appwrite SDK not loaded', 'error');
        }
    </script>
</body>
</html>