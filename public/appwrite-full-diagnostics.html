<!DOCTYPE html>
<html>
<head>
    <title>Appwrite Connection Debugger</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .result { background: #f0f0f0; padding: 10px; margin: 10px 0; border-radius: 5px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
        .warning { background: #fff3cd; color: #856404; }
    </style>
</head>
<body>
    <h1>üîç Appwrite Connection & Collection Debugger</h1>
    <div id="results"></div>
    <button onclick="runDiagnostics()">üîÑ Re-run Diagnostics</button>

    <script src="https://cdn.jsdelivr.net/npm/appwrite@21.4.0"></script>
    <script>
        const { Client, Databases, Account } = Appwrite;

        async function runDiagnostics() {
            const results = document.getElementById('results');
            results.innerHTML = '<div class="info">üîç Starting comprehensive diagnostics...</div>';
            
            // Configuration
            const client = new Client();
            client
                .setEndpoint('https://syd.cloud.appwrite.io/v1')
                .setProject('68f23b11000d25eb3664');

            const databases = new Databases(client);
            const account = new Account(client);

            // Test both database IDs
            const DATABASE_IDS = [
                '672b0d7b00249d81e129', // From debug tools
                '68f76ee1000e64ca8d05'  // From original config
            ];

            // Test multiple collection ID formats
            const COLLECTION_VARIATIONS = {
                therapists: ['therapists_collection_id', 'therapists', 'Therapists'],
                places: ['places', 'places_collection_id', 'Places']
            };

            try {
                // Step 1: Check authentication
                results.innerHTML += '<div class="info">Step 1: Checking authentication...</div>';
                try {
                    const user = await account.get();
                    results.innerHTML += `<div class="success">‚úÖ Authentication: Logged in as ${user.email}</div>`;
                } catch (error) {
                    results.innerHTML += `<div class="warning">‚ö†Ô∏è Authentication: Not logged in (${error.message})</div>`;
                }

                // Step 2: Test database access
                results.innerHTML += '<div class="info">Step 2: Testing database access...</div>';
                
                for (const databaseId of DATABASE_IDS) {
                    results.innerHTML += `<div class="info">Testing database: ${databaseId}</div>`;
                    
                    try {
                        // Try to list collections in this database
                        const response = await fetch(`https://syd.cloud.appwrite.io/v1/databases/${databaseId}/collections`, {
                            method: 'GET',
                            headers: {
                                'X-Appwrite-Project': '68f23b11000d25eb3664',
                                'Content-Type': 'application/json'
                            }
                        });
                        
                        if (response.ok) {
                            const data = await response.json();
                            results.innerHTML += `<div class="success">‚úÖ Database ${databaseId}: Found ${data.total || 0} collections</div>`;
                            
                            // List actual collection names
                            if (data.collections && data.collections.length > 0) {
                                const collectionNames = data.collections.map(c => c.name || c.$id).join(', ');
                                results.innerHTML += `<div class="info">üìã Collections: ${collectionNames}</div>`;
                            }
                        } else {
                            results.innerHTML += `<div class="error">‚ùå Database ${databaseId}: HTTP ${response.status}</div>`;
                        }
                    } catch (error) {
                        results.innerHTML += `<div class="error">‚ùå Database ${databaseId}: ${error.message}</div>`;
                    }

                    // Step 3: Test collection access for each database
                    results.innerHTML += '<div class="info">Step 3: Testing collection access...</div>';
                    
                    for (const [type, variations] of Object.entries(COLLECTION_VARIATIONS)) {
                        for (const collectionId of variations) {
                            try {
                                const docs = await databases.listDocuments(databaseId, collectionId, []);
                                results.innerHTML += `<div class="success">‚úÖ ${databaseId}/${collectionId}: Found ${docs.documents.length} ${type}</div>`;
                                
                                // If we found data, this is the correct combination!
                                if (docs.documents.length > 0) {
                                    results.innerHTML += `<div class="success">üéØ FOUND WORKING COMBINATION: Database: ${databaseId}, Collection: ${collectionId}</div>`;
                                }
                            } catch (error) {
                                results.innerHTML += `<div class="error">‚ùå ${databaseId}/${collectionId}: ${error.message}</div>`;
                            }
                        }
                    }
                }

                results.innerHTML += '<div class="success">üèÅ Diagnostics completed!</div>';
                
            } catch (error) {
                results.innerHTML += `<div class="error">‚ùå Fatal error: ${error.message}</div>`;
            }
        }

        // Auto-run on load
        runDiagnostics();
    </script>
</body>
</html>