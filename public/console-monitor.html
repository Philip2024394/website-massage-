<!DOCTYPE html>
<html>
<head>
    <title>ğŸ” Real-Time Console Monitor</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; }
        .error { background: #f8d7da; border: 2px solid #dc3545; padding: 10px; margin: 5px 0; border-radius: 5px; font-size: 12px; }
        .success { background: #d4edda; border: 2px solid #28a745; padding: 10px; margin: 5px 0; border-radius: 5px; font-size: 12px; }
        .warning { background: #fff3cd; border: 2px solid #ffc107; padding: 10px; margin: 5px 0; border-radius: 5px; font-size: 12px; }
        .info { background: #d1ecf1; border: 2px solid #17a2b8; padding: 10px; margin: 5px 0; border-radius: 5px; font-size: 12px; }
        #console { height: 400px; overflow-y: auto; border: 2px solid #ddd; padding: 10px; background: #f8f9fa; font-family: monospace; font-size: 11px; }
        button { background: #007bff; color: white; padding: 8px 15px; border: none; border-radius: 3px; cursor: pointer; margin: 5px; }
        button:hover { background: #0056b3; }
        .status-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” Real-Time Console Monitor</h1>
        
        <div class="status-grid">
            <div>
                <h3>ğŸ¯ Current Status</h3>
                <div id="status-summary">Checking...</div>
            </div>
            <div>
                <h3>ğŸ”§ Quick Actions</h3>
                <button onclick="openMainApp()">ğŸ“± Open Main App</button>
                <button onclick="openTherapistDashboard()">ğŸ‘¨â€âš•ï¸ Therapist Dashboard</button>
                <button onclick="clearConsole()">ğŸ§¹ Clear Console</button>
                <button onclick="refreshErrors()">ğŸ”„ Refresh</button>
            </div>
        </div>
        
        <h3>ğŸ“Š Live Console Output</h3>
        <div id="console"></div>
        
        <div id="error-analysis"></div>
    </div>

    <script>
        let consoleOutput = [];
        let errorCount = 0;
        let warningCount = 0;
        let successCount = 0;
        
        // Capture console messages
        const originalConsole = {
            log: console.log,
            error: console.error,
            warn: console.warn,
            info: console.info
        };
        
        function addToConsole(type, message, ...args) {
            const timestamp = new Date().toLocaleTimeString();
            const fullMessage = [message, ...args].map(arg => 
                typeof arg === 'object' ? JSON.stringify(arg, null, 2) : String(arg)
            ).join(' ');
            
            consoleOutput.push({
                type,
                timestamp,
                message: fullMessage
            });
            
            // Update counters
            if (type === 'error') errorCount++;
            if (type === 'warn') warningCount++;
            if (type === 'log' && fullMessage.includes('âœ…')) successCount++;
            
            updateConsoleDisplay();
            updateStatus();
            
            // Call original console method
            originalConsole[type](message, ...args);
        }
        
        console.log = (...args) => addToConsole('log', ...args);
        console.error = (...args) => addToConsole('error', ...args);
        console.warn = (...args) => addToConsole('warn', ...args);
        console.info = (...args) => addToConsole('info', ...args);
        
        function updateConsoleDisplay() {
            const consoleDiv = document.getElementById('console');
            const recent = consoleOutput.slice(-50); // Show last 50 messages
            
            consoleDiv.innerHTML = recent.map(entry => {
                const className = entry.type === 'error' ? 'error' : 
                                entry.type === 'warn' ? 'warning' :
                                entry.message.includes('âœ…') ? 'success' : 'info';
                
                return `<div class="${className}">
                    <strong>[${entry.timestamp}] ${entry.type.toUpperCase()}:</strong> ${entry.message}
                </div>`;
            }).join('');
            
            consoleDiv.scrollTop = consoleDiv.scrollHeight;
        }
        
        function updateStatus() {
            const statusDiv = document.getElementById('status-summary');
            const recentErrors = consoleOutput.slice(-20).filter(e => e.type === 'error');
            const recentWarnings = consoleOutput.slice(-20).filter(e => e.type === 'warn');
            
            let html = '<div class="info">';
            html += `<strong>ğŸ“Š Console Stats (Last 50 messages):</strong><br>`;
            html += `â€¢ âŒ Errors: ${errorCount}<br>`;
            html += `â€¢ âš ï¸ Warnings: ${warningCount}<br>`;
            html += `â€¢ âœ… Success: ${successCount}<br>`;
            html += '</div>';
            
            if (recentErrors.length > 0) {
                html += '<div class="error">';
                html += '<strong>ğŸš¨ Recent Errors:</strong><br>';
                recentErrors.slice(-3).forEach(error => {
                    html += `â€¢ ${error.message.substring(0, 100)}...<br>`;
                });
                html += '</div>';
            }
            
            if (recentWarnings.length > 0) {
                html += '<div class="warning">';
                html += '<strong>âš ï¸ Recent Warnings:</strong><br>';
                recentWarnings.slice(-3).forEach(warning => {
                    html += `â€¢ ${warning.message.substring(0, 100)}...<br>`;
                });
                html += '</div>';
            }
            
            statusDiv.innerHTML = html;
            
            // Auto-analyze errors
            analyzeErrors();
        }
        
        function analyzeErrors() {
            const analysisDiv = document.getElementById('error-analysis');
            const recentErrors = consoleOutput.slice(-10).filter(e => e.type === 'error');
            
            if (recentErrors.length === 0) {
                analysisDiv.innerHTML = '<div class="success"><h3>âœ… No Recent Errors!</h3><p>System appears to be running cleanly.</p></div>';
                return;
            }
            
            let html = '<h3>ğŸ” Error Analysis</h3>';
            
            const errorPatterns = {
                '401': 'Authentication/Permission Issues',
                '404': 'Resource Not Found',
                'Failed to load resource': 'Network/CORS Issues',
                'AppwriteException': 'Appwrite API Issues',
                'Anonymous session': 'Session Creation Problems',
                'Unknown page case': 'Routing Issues'
            };
            
            const categorizedErrors = {};
            
            recentErrors.forEach(error => {
                for (const [pattern, category] of Object.entries(errorPatterns)) {
                    if (error.message.includes(pattern)) {
                        if (!categorizedErrors[category]) categorizedErrors[category] = [];
                        categorizedErrors[category].push(error);
                        break;
                    }
                }
            });
            
            for (const [category, errors] of Object.entries(categorizedErrors)) {
                html += `<div class="error">`;
                html += `<h4>ğŸ”§ ${category} (${errors.length} errors)</h4>`;
                errors.slice(0, 2).forEach(error => {
                    html += `<p><strong>â€¢</strong> ${error.message.substring(0, 150)}...</p>`;
                });
                html += `</div>`;
            }
            
            analysisDiv.innerHTML = html;
        }
        
        function openMainApp() {
            window.open('http://localhost:3006/', '_blank');
        }
        
        function openTherapistDashboard() {
            // Simulate therapist login and dashboard access
            console.log('ğŸ¯ Attempting to access therapist dashboard...');
            window.open('http://localhost:3006/#therapist-dashboard', '_blank');
        }
        
        function clearConsole() {
            consoleOutput = [];
            errorCount = 0;
            warningCount = 0;
            successCount = 0;
            updateConsoleDisplay();
            updateStatus();
        }
        
        function refreshErrors() {
            location.reload();
        }
        
        // Initial setup
        console.log('ğŸ” Console monitor started at ' + new Date().toLocaleString());
        console.log('ğŸ“Š Tracking errors, warnings, and success messages...');
        
        // Auto-refresh status every 5 seconds
        setInterval(updateStatus, 5000);
    </script>
</body>
</html>