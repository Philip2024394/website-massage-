<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>V2 Architecture Demo - Therapist Dashboard with Feature Flags</title>
    
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React and ReactDOM from CDN for quick demo -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- TypeScript compiler for in-browser compilation -->
    <script src="https://unpkg.com/typescript@5.2.2/lib/typescript.js"></script>
    
    <style>
        /* Enhanced mobile styles */
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background-color: #f9fafb;
            overflow-x: hidden;
            -webkit-text-size-adjust: 100%;
        }
        
        /* V2 Architecture specific styles */
        .v2-container {
            min-height: 100vh;
            position: relative;
        }
        
        .feature-flag-demo {
            animation: slideIn 0.5s ease-out;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* Console styling */
        .console-output {
            background: #1a202c;
            color: #e2e8f0;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 12px;
            padding: 16px;
            margin: 20px 0;
            border-radius: 8px;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-line;
        }
        
        /* Loading spinner */
        .loading-spinner {
            border: 4px solid #f3f4f6;
            border-top: 4px solid #3b82f6;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- V2 Architecture Demo Container -->
    <div id="v2-root" class="v2-container">
        <!-- Loading state while V2 initializes -->
        <div class="min-h-screen flex items-center justify-center bg-gray-50">
            <div class="text-center">
                <div class="loading-spinner"></div>
                <h1 class="text-2xl font-bold text-gray-900 mb-2">
                    üöÄ Loading V2 Architecture
                </h1>
                <p class="text-gray-600 mb-4">
                    Initializing isolated features with shell protection...
                </p>
                <div class="text-sm text-gray-500">
                    <p>‚úÖ Step 8: Migrate Real Screen (Therapist Dashboard)</p>
                    <p>‚úÖ Feature Flags: Toggle V2 vs Legacy</p>
                    <p>‚úÖ Shell Isolation: Boundaries Enforced</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Demo Information Panel -->
    <div id="demo-info" style="
        position: fixed; 
        bottom: 20px; 
        left: 20px; 
        background: white; 
        border: 2px solid #e5e7eb; 
        border-radius: 8px; 
        padding: 16px; 
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        max-width: 300px;
        z-index: 1000;
        display: none;
    ">
        <h3 style="margin: 0 0 12px 0; font-size: 14px; font-weight: bold; color: #374151;">
            üéõÔ∏è V2 Demo Controls
        </h3>
        <div style="font-size: 12px; color: #6b7280; line-height: 1.4;">
            <p><strong>Open Console</strong> to see V2Utils:</p>
            <code style="background: #f3f4f6; padding: 2px 4px; border-radius: 4px;">
                V2Utils.enableV2Dashboard()
            </code>
            <br><br>
            <p><strong>Navigation:</strong></p>
            <p>‚Ä¢ Feature Flags Panel</p>
            <p>‚Ä¢ Therapist Dashboard V2</p>
            <p>‚Ä¢ Legacy Compatibility</p>
        </div>
        <button onclick="document.getElementById('demo-info').style.display='none'" 
                style="
                    position: absolute; 
                    top: 4px; 
                    right: 8px; 
                    background: none; 
                    border: none; 
                    font-size: 16px; 
                    cursor: pointer;
                    color: #9ca3af;
                ">
            √ó
        </button>
    </div>

    <!-- Show demo info after 3 seconds -->
    <script>
        setTimeout(() => {
            document.getElementById('demo-info').style.display = 'block';
        }, 3000);
    </script>

    <!-- V2 Architecture Initialization Script -->
    <script type="text/javascript">
        // Set development environment
        window.process = { env: { NODE_ENV: 'development' } };
        
        // Simple React components for demo (normally would be from bundled TypeScript)
        const { useState, useEffect, createElement: h } = React;
        
        // Mock V2 Components for Demo
        const TherapistDashboardView = ({ useV2Dashboard = true }) => {
            const [stats, setStats] = useState({
                bookingsToday: 5,
                earningsToday: 450,
                profileCompletion: 85,
                rating: 4.8
            });
            
            return h('div', { className: 'p-6 space-y-6' }, [
                // Header
                h('div', { key: 'header', className: 'flex items-center justify-between' }, [
                    h('div', { key: 'title' }, [
                        h('h1', { className: 'text-2xl font-bold text-gray-900' }, 
                          useV2Dashboard ? 'üéØ Therapist Dashboard V2' : 'Therapist Dashboard (Legacy)'),
                        h('p', { className: 'text-gray-600 mt-1' }, 
                          useV2Dashboard ? 'Enhanced with feature flags and isolation' : 'Original implementation')
                    ]),
                    h('div', { key: 'badge', className: `px-3 py-1 rounded-full text-sm font-medium ${useV2Dashboard ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-600'}` },
                      useV2Dashboard ? 'V2 ACTIVE' : 'LEGACY MODE')
                ]),
                
                // Stats Grid
                h('div', { key: 'stats', className: 'grid grid-cols-1 md:grid-cols-4 gap-6' }, [
                    h('div', { key: 'stat1', className: 'bg-white p-6 rounded-lg shadow border' }, [
                        h('h3', { className: 'text-sm font-medium text-gray-600' }, 'Today\'s Bookings'),
                        h('p', { className: 'text-3xl font-bold text-blue-600 mt-2' }, stats.bookingsToday)
                    ]),
                    h('div', { key: 'stat2', className: 'bg-white p-6 rounded-lg shadow border' }, [
                        h('h3', { className: 'text-sm font-medium text-gray-600' }, 'Today\'s Earnings'),
                        h('p', { className: 'text-3xl font-bold text-green-600 mt-2' }, `$${stats.earningsToday}`)
                    ]),
                    h('div', { key: 'stat3', className: 'bg-white p-6 rounded-lg shadow border' }, [
                        h('h3', { className: 'text-sm font-medium text-gray-600' }, 'Profile Complete'),
                        h('p', { className: 'text-3xl font-bold text-purple-600 mt-2' }, `${stats.profileCompletion}%`)
                    ]),
                    h('div', { key: 'stat4', className: 'bg-white p-6 rounded-lg shadow border' }, [
                        h('h3', { className: 'text-sm font-medium text-gray-600' }, 'Rating'),
                        h('p', { className: 'text-3xl font-bold text-yellow-600 mt-2' }, `‚≠ê ${stats.rating}`)
                    ])
                ]),
                
                // V2 Features
                useV2Dashboard && h('div', { key: 'v2features', className: 'bg-blue-50 border border-blue-200 rounded-lg p-6' }, [
                    h('h3', { className: 'text-lg font-semibold text-blue-900 mb-4' }, '‚ú® V2 Enhanced Features'),
                    h('div', { className: 'grid grid-cols-1 md:grid-cols-2 gap-4 text-sm' }, [
                        h('div', { key: 'f1' }, 'üéõÔ∏è Feature Flag System'),
                        h('div', { key: 'f2' }, 'üè† Shell Isolation'),
                        h('div', { key: 'f3' }, 'üìä Advanced Analytics'),
                        h('div', { key: 'f4' }, 'üîÑ Real-time Updates'),
                        h('div', { key: 'f5' }, 'üõ°Ô∏è Boundary Protection'),
                        h('div', { key: 'f6' }, 'üß© Modular Architecture')
                    ])
                ])
            ]);
        };
        
        const FeatureFlagDemo = ({ onFlagChange }) => {
            const [flags, setFlags] = useState({
                USE_V2_THERAPIST_DASHBOARD: localStorage.getItem('enableV2Dashboard') === 'true' || true
            });
            
            const toggleFlag = (flagName) => {
                const newValue = !flags[flagName];
                setFlags(prev => ({ ...prev, [flagName]: newValue }));
                localStorage.setItem('enableV2Dashboard', newValue.toString());
                if (onFlagChange) onFlagChange(flagName, newValue);
            };
            
            return h('div', { className: 'bg-white rounded-lg shadow-lg border p-6' }, [
                h('h2', { key: 'title', className: 'text-xl font-bold mb-6' }, 'üéõÔ∏è Feature Flag Control Panel'),
                
                h('div', { key: 'flag', className: 'flex items-center justify-between p-4 border rounded-lg' }, [
                    h('div', { key: 'info' }, [
                        h('h3', { className: 'font-medium' }, 'V2 Therapist Dashboard'),
                        h('p', { className: 'text-sm text-gray-600' }, 'Toggle between V2 and Legacy dashboard')
                    ]),
                    h('button', {
                        key: 'toggle',
                        className: `relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${flags.USE_V2_THERAPIST_DASHBOARD ? 'bg-blue-600' : 'bg-gray-200'}`,
                        onClick: () => toggleFlag('USE_V2_THERAPIST_DASHBOARD')
                    }, [
                        h('span', {
                            className: `inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${flags.USE_V2_THERAPIST_DASHBOARD ? 'translate-x-6' : 'translate-x-1'}`
                        })
                    ])
                ]),
                
                h('div', { key: 'refresh', className: 'mt-6 p-4 bg-yellow-50 border border-yellow-200 rounded-lg' }, [
                    h('p', { className: 'text-sm text-yellow-800 mb-3' }, 'Changes will take effect after page refresh'),
                    h('button', {
                        className: 'px-4 py-2 bg-yellow-600 text-white rounded hover:bg-yellow-700',
                        onClick: () => window.location.reload()
                    }, 'Refresh Page')
                ])
            ]);
        };
        
        const V2AppRouter = () => {
            const [currentPath, setCurrentPath] = useState(window.location.hash.slice(1) || '/therapist');
            const [featureFlags, setFeatureFlags] = useState({
                USE_V2_THERAPIST_DASHBOARD: localStorage.getItem('enableV2Dashboard') === 'true' || true
            });
            
            const navigate = (path) => {
                setCurrentPath(path);
                window.location.hash = path;
            };
            
            const handleFlagChange = (flag, enabled) => {
                setFeatureFlags(prev => ({ ...prev, [flag]: enabled }));
            };
            
            const renderContent = () => {
                if (currentPath === '/feature-flags') {
                    return h(FeatureFlagDemo, { onFlagChange: handleFlagChange });
                }
                
                return h(TherapistDashboardView, { 
                    useV2Dashboard: featureFlags.USE_V2_THERAPIST_DASHBOARD 
                });
            };
            
            return h('div', { className: 'min-h-screen bg-gray-50' }, [
                // Navigation
                h('div', { 
                    key: 'nav',
                    className: 'fixed top-0 left-0 w-full bg-black text-white text-xs p-2 z-50 flex items-center justify-between'
                }, [
                    h('div', { key: 'nav-left', className: 'flex items-center space-x-4' }, [
                        h('span', { className: 'font-bold' }, 'V2 DEMO:'),
                        h('button', {
                            className: `px-2 py-1 rounded ${currentPath.includes('therapist') ? 'bg-blue-600' : 'bg-gray-700 hover:bg-gray-600'}`,
                            onClick: () => navigate('/therapist')
                        }, 'Therapist Dashboard'),
                        h('button', {
                            className: `px-2 py-1 rounded ${currentPath.includes('feature-flags') ? 'bg-blue-600' : 'bg-gray-700 hover:bg-gray-600'}`,
                            onClick: () => navigate('/feature-flags')
                        }, 'Feature Flags')
                    ]),
                    h('div', { key: 'nav-right' }, [
                        h('span', {}, `V2 Dashboard: ${featureFlags.USE_V2_THERAPIST_DASHBOARD ? '‚úÖ' : '‚ùå'}`)
                    ])
                ]),
                
                // Main content
                h('div', { key: 'content', className: 'pt-8' }, [
                    h('div', { className: 'max-w-7xl mx-auto p-6' }, renderContent())
                ])
            ]);
        };
        
        // Initialize the app
        const initApp = () => {
            console.log('üöÄ V2 Architecture Demo Initializing...');
            console.log('üìç Step 8 Complete: Real screen migrated with feature flags');
            
            // Expose utilities
            window.V2Utils = {
                enableV2Dashboard: () => {
                    localStorage.setItem('enableV2Dashboard', 'true');
                    window.location.reload();
                },
                disableV2Dashboard: () => {
                    localStorage.setItem('enableV2Dashboard', 'false');
                    window.location.reload();
                },
                showFeatureFlags: () => {
                    console.log('Current Feature Flags:', {
                        USE_V2_THERAPIST_DASHBOARD: localStorage.getItem('enableV2Dashboard') === 'true' || true
                    });
                }
            };
            
            console.log('üõ†Ô∏è V2Utils available:', window.V2Utils);
            
            const root = ReactDOM.createRoot(document.getElementById('v2-root'));
            root.render(h(V2AppRouter));
            
            console.log('‚úÖ V2 Architecture Demo Ready!');
        };
        
        // Initialize when ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initApp);
        } else {
            initApp();
        }
    </script>
</body>
</html>