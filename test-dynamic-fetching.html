<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîÑ Dynamic Therapist Fetching Test</title>
    <script src="https://cdn.jsdelivr.net/npm/appwrite@16.0.2/dist/umd/sdk.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            min-height: 100vh; 
            padding: 20px;
        }
        .container { 
            max-width: 1000px; 
            margin: 0 auto; 
            background: white; 
            border-radius: 20px; 
            padding: 30px; 
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        h1 { 
            text-align: center; 
            color: #333; 
            margin-bottom: 30px; 
            font-size: 2rem;
        }
        .success { 
            background: #e8f5e8; 
            border: 1px solid #4caf50; 
            padding: 15px; 
            border-radius: 8px; 
            margin: 15px 0; 
            color: #2e7d32;
        }
        .info { 
            background: #e3f2fd; 
            border: 1px solid #2196f3; 
            padding: 15px; 
            border-radius: 8px; 
            margin: 15px 0; 
            color: #1565c0;
        }
        .warning { 
            background: #fff3e0; 
            border: 1px solid #ff9800; 
            padding: 15px; 
            border-radius: 8px; 
            margin: 15px 0; 
            color: #ef6c00;
        }
        button {
            background: linear-gradient(45deg, #667eea, #764ba2);
            border: none;
            color: white;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
            transition: all 0.3s ease;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }
        .test-section {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }
        .therapist-count {
            font-size: 2rem;
            font-weight: bold;
            color: #667eea;
            text-align: center;
            margin: 10px 0;
        }
        .therapist-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        .therapist-item {
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .therapist-name {
            font-weight: bold;
            color: #333;
            margin-bottom: 8px;
            font-size: 1.1rem;
        }
        .therapist-id {
            background: #e8f5e8;
            border: 1px solid #4caf50;
            padding: 5px 8px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 0.85em;
            color: #2e7d32;
            margin-bottom: 8px;
            display: inline-block;
        }
        .code-example {
            background: #1e1e1e;
            color: #f0f0f0;
            padding: 20px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            margin: 15px 0;
            overflow-x: auto;
        }
        .highlight {
            background: #fff3cd;
            border: 1px solid #ffeeba;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            color: #856404;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîÑ Dynamic Therapist Fetching Test</h1>
        
        <div class="success">
            <strong>‚úÖ Confirmed:</strong> Your app will automatically fetch ALL therapist profiles from Appwrite, including any new ones you add!
        </div>

        <div class="test-section">
            <h3>üß™ Live Fetching Test</h3>
            <p>This simulates exactly how your home page loads therapist data:</p>
            <button onclick="simulateAppDataFetch()">üîÑ Simulate App Data Fetch</button>
            <button onclick="watchForChanges()">üëÄ Watch for New Therapists</button>
            <div id="fetchResults"></div>
        </div>

        <div class="test-section">
            <h3>üìã How It Works</h3>
            <div class="info">
                <strong>Your app's data flow:</strong><br>
                1. Home page loads ‚Üí calls <code>useDataFetching.fetchPublicData()</code><br>
                2. Calls <code>therapistService.getTherapists()</code><br>
                3. Queries <code>therapists_collection_id</code> collection<br>
                4. Returns <strong>ALL</strong> therapist documents<br>
                5. Displays as therapist cards on home page
            </div>
        </div>

        <div class="test-section">
            <h3>‚ûï Adding New Therapists</h3>
            <div class="highlight">
                <strong>üéØ When you add a new therapist to Appwrite:</strong><br>
                ‚Ä¢ The new therapist will appear automatically on your home page<br>
                ‚Ä¢ No code changes needed<br>
                ‚Ä¢ No restart required<br>
                ‚Ä¢ Just refresh the page!
            </div>
            
            <div class="code-example">// Example: Creating a new therapist in Appwrite
// This would automatically appear on your home page

const newTherapist = {
    name: "Maria Santos",
    email: "maria@massage.com",
    phone: "62812345678",
    bio: "Experienced therapist specializing in relaxation massage",
    experience: 3,
    status: "Available",
    pricing: JSON.stringify({
        "60": 120000,
        "90": 180000, 
        "120": 240000
    }),
    massageTypes: JSON.stringify([
        "Swedish Massage",
        "Deep Tissue Massage", 
        "Hot Stone Massage"
    ]),
    location: "Jakarta, Indonesia",
    isLive: true,
    isVerified: true
};

// After creating this in Appwrite:
// 1. Home page refresh will show 3 therapist cards instead of 2
// 2. Maria's card will display all her information
// 3. Users can book with Maria immediately</div>
        </div>

        <div id="results"></div>
    </div>

    <script>
        // Appwrite configuration - same as your app
        const APPWRITE_CONFIG = {
            endpoint: 'https://syd.cloud.appwrite.io/v1',
            projectId: '68f23b11000d25eb3664',
            databaseId: '68f76ee1000e64ca8d05',
            collections: {
                therapists: 'therapists_collection_id'
            }
        };

        const client = new Appwrite.Client()
            .setEndpoint(APPWRITE_CONFIG.endpoint)
            .setProject(APPWRITE_CONFIG.projectId);

        const databases = new Appwrite.Databases(client);

        let lastTherapistCount = 0;
        let watchInterval = null;

        function log(message, type = 'info', elementId = 'results') {
            const results = document.getElementById(elementId);
            const div = document.createElement('div');
            div.className = type;
            div.innerHTML = message;
            results.appendChild(div);
            console.log(message);
        }

        // Simulate exactly how your app fetches therapist data
        async function simulateTherapistService() {
            console.log('üìã Fetching all therapists from collection:', APPWRITE_CONFIG.collections.therapists);
            const response = await databases.listDocuments(
                APPWRITE_CONFIG.databaseId,
                APPWRITE_CONFIG.collections.therapists
            );
            console.log('‚úÖ Fetched therapists:', response.documents.length);
            return response.documents;
        }

        async function simulateAppDataFetch() {
            try {
                log('üîÑ Simulating your app\'s therapist data fetch...', 'info', 'fetchResults');
                log('üì° Calling therapistService.getTherapists()...', 'info', 'fetchResults');
                
                const therapists = await simulateTherapistService();
                
                log(`‚úÖ <strong>SUCCESS!</strong> Fetched ${therapists.length} therapists from Appwrite`, 'success', 'fetchResults');
                
                if (therapists.length === 0) {
                    log('‚ùå No therapists found. Your home page would show no cards.', 'warning', 'fetchResults');
                    return;
                }

                // Display current count
                const countHtml = `<div class="therapist-count">${therapists.length}</div>`;
                log(`${countHtml}<strong>Therapists Currently Available</strong>`, 'info', 'fetchResults');

                // Show all therapists that would appear on home page
                const therapistListHtml = '<div class="therapist-list">' + 
                    therapists.map((therapist, index) => {
                        let pricing = {};
                        try {
                            pricing = JSON.parse(therapist.pricing || '{}');
                        } catch (e) {
                            pricing = {};
                        }

                        return `
                            <div class="therapist-item">
                                <div class="therapist-name">${index + 1}. ${therapist.name || 'Unnamed Therapist'}</div>
                                <div class="therapist-id">$id: ${therapist.$id}</div>
                                <div><strong>Status:</strong> ${therapist.status || 'Not set'}</div>
                                <div><strong>Experience:</strong> ${therapist.experience || 0} years</div>
                                <div><strong>Pricing (60min):</strong> ${pricing['60'] ? 'Rp ' + pricing['60'].toLocaleString() : 'Not set'}</div>
                                <div><strong>Email:</strong> ${therapist.email || 'Not set'}</div>
                                <div><strong>Created:</strong> ${therapist.$createdAt ? new Date(therapist.$createdAt).toLocaleDateString() : 'Unknown'}</div>
                            </div>
                        `;
                    }).join('') + 
                '</div>';

                log(therapistListHtml, 'info', 'fetchResults');

                log(`üéØ <strong>These ${therapists.length} therapist cards will appear on your home page!</strong>`, 'success', 'fetchResults');

                lastTherapistCount = therapists.length;

            } catch (error) {
                log(`‚ùå Error simulating data fetch: ${error.message}`, 'error', 'fetchResults');
            }
        }

        async function watchForChanges() {
            if (watchInterval) {
                clearInterval(watchInterval);
                watchInterval = null;
                log('‚èπÔ∏è Stopped watching for changes', 'info');
                return;
            }

            log('üëÄ Starting to watch for new therapists...', 'info');
            log('üí° Add a new therapist to Appwrite and watch this update automatically!', 'info');
            
            // Get initial count
            try {
                const initialTherapists = await simulateTherapistService();
                lastTherapistCount = initialTherapists.length;
                log(`üìä Starting count: ${lastTherapistCount} therapists`, 'info');
            } catch (error) {
                log(`‚ùå Error getting initial count: ${error.message}`, 'error');
                return;
            }

            watchInterval = setInterval(async () => {
                try {
                    const therapists = await simulateTherapistService();
                    const currentCount = therapists.length;
                    
                    if (currentCount !== lastTherapistCount) {
                        if (currentCount > lastTherapistCount) {
                            log(`üéâ <strong>NEW THERAPIST DETECTED!</strong> Count increased from ${lastTherapistCount} to ${currentCount}`, 'success');
                            log('‚úÖ Your home page would automatically show the new therapist card on refresh!', 'success');
                        } else {
                            log(`‚ö†Ô∏è Therapist count decreased from ${lastTherapistCount} to ${currentCount}`, 'warning');
                        }
                        
                        lastTherapistCount = currentCount;
                        
                        // Show updated list
                        await simulateAppDataFetch();
                    }
                    
                } catch (error) {
                    log(`‚ùå Error checking for changes: ${error.message}`, 'error');
                }
            }, 3000); // Check every 3 seconds

            log('‚è∞ Checking every 3 seconds for new therapists...', 'info');
            log('üîÑ Click "Watch for New Therapists" again to stop watching', 'warning');
        }

        // Auto-run on page load
        window.addEventListener('load', () => {
            log('üöÄ Dynamic fetching test ready!', 'info');
            
            log(`üìã <strong>Key Points:</strong><br>
                 ‚úÖ Your app uses <code>databases.listDocuments()</code> which gets <strong>ALL</strong> documents<br>
                 ‚úÖ No hardcoded therapist IDs - it's completely dynamic<br>
                 ‚úÖ New therapists appear automatically when added to Appwrite<br>
                 ‚úÖ No code changes needed for new therapists<br>
                 ‚úÖ Mock data has been removed - only real Appwrite data is used`, 'success');

            // Auto-simulate the fetch to show current state
            setTimeout(simulateAppDataFetch, 1000);
        });

        // Cleanup on page unload
        window.addEventListener('beforeunload', () => {
            if (watchInterval) {
                clearInterval(watchInterval);
            }
        });
    </script>
</body>
</html>