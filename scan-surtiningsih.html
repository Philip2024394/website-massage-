<!DOCTYPE html>
<html>
<head>
    <title>Scan Surtiningsih Profile</title>
    <script src="https://cdn.jsdelivr.net/npm/appwrite@15.0.0"></script>
</head>
<body>
    <h1>Scan Surtiningsih Profile</h1>
    <button onclick="findSurtiningsih()">Find Surtiningsih (indastreet1@gmail.com)</button>
    <div id="result"></div>

    <script>
        const { Client, Databases, Account } = Appwrite;
        
        const client = new Client()
            .setEndpoint('https://syd.cloud.appwrite.io/v1')
            .setProject('68f23b11000d25eb3664');
        
        const databases = new Databases(client);
        const account = new Account(client);
        
        async function findSurtiningsih() {
            const result = document.getElementById('result');
            result.innerHTML = 'Scanning for Surtiningsih...<br>';
            
            try {
                // Create anonymous session
                try {
                    await account.createAnonymousSession();
                    result.innerHTML += '‚úÖ Anonymous session created<br><br>';
                } catch (error) {
                    if (error.message.includes('already exists')) {
                        result.innerHTML += '‚ÑπÔ∏è Using existing session<br><br>';
                    }
                }
                
                // Try the working collection ID
                const response = await databases.listDocuments('68f76ee1000e64ca8d05', 'therapists_collection_id');
                
                result.innerHTML += `<h3>Found ${response.documents.length} therapists total</h3>`;
                
                // Look for Surtiningsih specifically
                const surtiningsih = response.documents.find(doc => 
                    doc.email === 'indastreet1@gmail.com' || 
                    (doc.name || '').toLowerCase().includes('surtiningsih')
                );
                
                if (surtiningsih) {
                    result.innerHTML += '<div style="background: #e8f5e8; padding: 15px; border: 2px solid #4CAF50;">';
                    result.innerHTML += '<h2>üéØ FOUND SURTININGSIH!</h2>';
                    result.innerHTML += '<h3>Profile Details:</h3>';
                    result.innerHTML += `<strong>Name:</strong> ${surtiningsih.name}<br>`;
                    result.innerHTML += `<strong>Email:</strong> ${surtiningsih.email}<br>`;
                    result.innerHTML += `<strong>Profile ID:</strong> ${surtiningsih.$id}<br>`;
                    result.innerHTML += `<strong>User ID:</strong> ${surtiningsih.userId || 'Not set'}<br>`;
                    result.innerHTML += `<strong>Status:</strong> ${surtiningsih.status}<br>`;
                    result.innerHTML += `<strong>Is Live:</strong> ${surtiningsih.isLive}<br>`;
                    result.innerHTML += `<strong>Verified:</strong> ${surtiningsih.verified}<br>`;
                    result.innerHTML += `<strong>Location:</strong> ${surtiningsih.location}<br>`;
                    result.innerHTML += `<strong>Phone:</strong> ${surtiningsih.phone}<br>`;
                    result.innerHTML += `<strong>WhatsApp:</strong> ${surtiningsih.whatsapp}<br>`;
                    result.innerHTML += `<strong>Specialization:</strong> ${surtiningsih.specialization}<br>`;
                    result.innerHTML += `<strong>Years Experience:</strong> ${surtiningsih.yearsOfExperience}<br>`;
                    result.innerHTML += `<strong>Membership Tier:</strong> ${surtiningsih.membershipTier}<br>`;
                    
                    if (surtiningsih.massageTypes) {
                        try {
                            const types = JSON.parse(surtiningsih.massageTypes);
                            result.innerHTML += `<strong>Massage Types:</strong> ${types.join(', ')}<br>`;
                        } catch (e) {
                            result.innerHTML += `<strong>Massage Types:</strong> ${surtiningsih.massageTypes}<br>`;
                        }
                    }
                    
                    if (surtiningsih.pricing) {
                        result.innerHTML += '<h4>Pricing:</h4>';
                        try {
                            const pricing = JSON.parse(surtiningsih.pricing);
                            Object.entries(pricing).forEach(([duration, price]) => {
                                result.innerHTML += `${duration} min: ${price.price} ${price.currency}<br>`;
                            });
                        } catch (e) {
                            result.innerHTML += `${surtiningsih.pricing}<br>`;
                        }
                    }
                    
                    result.innerHTML += '<br><h3>üîó Authentication Linkage:</h3>';
                    if (surtiningsih.userId) {
                        if (surtiningsih.userId === '693cfadf000997d3cd66') {
                            result.innerHTML += '‚úÖ <strong>PERFECT!</strong> Profile is already linked to Appwrite user ID 693cfadf000997d3cd66<br>';
                            result.innerHTML += '‚úÖ This means indastreet1@gmail.com should be able to sign in!<br>';
                        } else {
                            result.innerHTML += `‚ö†Ô∏è Profile linked to different user ID: ${surtiningsih.userId}<br>`;
                            result.innerHTML += '‚ùå This might cause sign-in issues<br>';
                        }
                    } else {
                        result.innerHTML += '‚ùå No userId field - profile not linked to Appwrite auth<br>';
                        result.innerHTML += '<button onclick="linkProfile()">Link to User 693cfadf000997d3cd66</button><br>';
                    }
                    
                    result.innerHTML += '</div>';
                    
                    // Show all fields for debugging
                    result.innerHTML += '<details><summary>üîç Raw Profile Data</summary>';
                    result.innerHTML += '<pre>' + JSON.stringify(surtiningsih, null, 2) + '</pre>';
                    result.innerHTML += '</details>';
                    
                } else {
                    result.innerHTML += '<div style="background: #ffe8e8; padding: 15px; border: 2px solid #f44336;">';
                    result.innerHTML += '<h2>‚ùå SURTININGSIH NOT FOUND</h2>';
                    result.innerHTML += '<p>No therapist found with:</p>';
                    result.innerHTML += '<ul>';
                    result.innerHTML += '<li>Email: indastreet1@gmail.com</li>';
                    result.innerHTML += '<li>Name containing: surtiningsih</li>';
                    result.innerHTML += '</ul>';
                    
                    // Show first few profiles for reference
                    result.innerHTML += '<h3>Available Profiles:</h3>';
                    response.documents.slice(0, 3).forEach(doc => {
                        result.innerHTML += `<div>Name: ${doc.name}, Email: ${doc.email}</div>`;
                    });
                    result.innerHTML += '</div>';
                }
                
            } catch (error) {
                result.innerHTML += '‚ùå Error: ' + error.message + '<br>';
                console.error(error);
            }
        }
        
        async function linkProfile() {
            // This would require write permissions, likely won't work with anonymous
            const result = document.getElementById('result');
            result.innerHTML += '<br>‚ö†Ô∏è Linking profile requires admin permissions. Use the backend script instead.<br>';
        }
    </script>
</body>
</html>