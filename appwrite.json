{
  "projectId": "YOUR_PROJECT_ID",
  "functions": [
    {
      "functionId": "submitReview",
      "name": "Submit Review (Server-Enforced)",
      "runtime": "node-18.0",
      "path": "functions/submitReview",
      "entrypoint": "src/main.js",
      "enabled": true,
      "events": [],
      "schedule": "",
      "timeout": 15,
      "execute": ["users"]
    },
    {
      "functionId": "confirmPaymentReceived",
      "name": "Confirm Payment Received (Auto Review Request)",
      "runtime": "node-18.0",
      "path": "functions/confirmPaymentReceived",
      "entrypoint": "src/main.js",
      "enabled": true,
      "events": [],
      "schedule": "",
      "timeout": 15,
      "execute": ["users"]
    },
    {
      "functionId": "sendChatMessage",
      "name": "Send Chat Message (Server-Enforced)",
      "runtime": "node-18.0",
      "path": "functions/sendChatMessage",
      "entrypoint": "src/main.js",
      "enabled": true,
      "events": [],
      "schedule": "",
      "timeout": 15,
      "execute": ["users"]
    },
    {
      "functionId": "booking_confirm",
      "name": "booking-confirm",
      "runtime": "node-20.0",
      "path": "functions/booking-confirm",
      "entrypoint": "index.ts",
      "enabled": true,
      "events": [],
      "schedule": "",
      "timeout": 15
    },
    {
      "functionId": "booking_decline",
      "name": "booking-decline",
      "runtime": "node-20.0",
      "path": "functions/booking-decline",
      "entrypoint": "index.ts",
      "enabled": true,
      "events": [],
      "schedule": "",
      "timeout": 15
    },
    {
      "functionId": "createBooking",
      "name": "Create Booking",
      "runtime": "node-18.0",
      "path": "functions/createBooking",
      "entrypoint": "src/main.js",
      "enabled": true,
      "events": [],
      "schedule": "",
      "timeout": 30,
      "execute": ["guests"]
    },
    {
      "functionId": "searchTherapists",
      "name": "Search Therapists",
      "runtime": "node-18.0", 
      "path": "functions/searchTherapists",
      "entrypoint": "src/main.js",
      "enabled": true,
      "events": [],
      "schedule": "",
      "timeout": 30,
      "execute": ["guests"]
    },
    {
      "functionId": "acceptTherapist",
      "name": "Accept Therapist",
      "runtime": "node-18.0",
      "path": "functions/acceptTherapist", 
      "entrypoint": "src/main.js",
      "enabled": true,
      "events": [],
      "schedule": "",
      "timeout": 15,
      "execute": ["guests"]
    },
    {
      "functionId": "cancelBooking",
      "name": "Cancel Booking",
      "runtime": "node-18.0",
      "path": "functions/cancelBooking",
      "entrypoint": "src/main.js", 
      "enabled": true,
      "events": [],
      "schedule": "",
      "timeout": 15,
      "execute": ["guests"]
    }
  ],
  "collections": [],
  "buckets": [],
  "teams": [],
  "databases": [
    {
      "databaseId": "68f76ee1000e64ca8d05",
      "name": "main",
      "enabled": true,
      "collections": [
        {
          "collectionId": "677a5d1b002097c0b5d6",
          "name": "Agents",
          "enabled": true,
          "documentSecurity": true,
          "attributes": [
            {"type": "string", "key": "name", "size": 255, "required": true, "array": false},
            {"type": "string", "key": "email", "size": 255, "required": true, "array": false},
            {"type": "string", "key": "password", "size": 255, "required": true, "array": false},
            {"type": "string", "key": "whatsappNumber", "size": 50, "required": true, "array": false},
            {"type": "string", "key": "code", "size": 20, "required": true, "array": false},
            {"type": "enum", "key": "commissionTier", "elements": ["base20", "base23"], "required": true, "array": false},
            {"type": "integer", "key": "streakMonths", "required": true, "array": false},
            {"type": "integer", "key": "newSignUpsThisMonth", "required": true, "array": false},
            {"type": "integer", "key": "recurringSignUpsThisMonth", "required": true, "array": false},
            {"type": "boolean", "key": "termsAccepted", "required": true, "array": false},
            {"type": "boolean", "key": "complianceAccepted", "required": true, "array": false},
            {"type": "boolean", "key": "marketingAccepted", "required": true, "array": false},
            {"type": "datetime", "key": "termsAcceptedAt", "required": false, "array": false},
            {"type": "datetime", "key": "complianceAcceptedAt", "required": false, "array": false},
            {"type": "datetime", "key": "marketingAcceptedAt", "required": false, "array": false},
            {"type": "string", "key": "bankIban", "size": 50, "required": false, "array": false},
            {"type": "string", "key": "bankSwift", "size": 20, "required": false, "array": false},
            {"type": "boolean", "key": "payoutEnabled", "required": true, "array": false},
            {"type": "float", "key": "totalEarnings", "required": false, "array": false},
            {"type": "datetime", "key": "createdAt", "required": true, "array": false}
          ],
          "indexes": [
            {"key": "idx_code_unique", "type": "unique", "attributes": ["code"], "orders": ["ASC"]},
            {"key": "idx_commissionTier", "type": "key", "attributes": ["commissionTier"], "orders": ["ASC"]},
            {"key": "idx_createdAt", "type": "key", "attributes": ["createdAt"], "orders": ["DESC"]}
          ]
        },
        {
          "collectionId": "677a5d28002b8d2b8c9f",
          "name": "Agent Visits",
          "enabled": true,
          "documentSecurity": true,
          "attributes": [
            {"type": "string", "key": "agentId", "size": 255, "required": true, "array": false},
            {"type": "string", "key": "agentCode", "size": 50, "required": true, "array": false},
            {"type": "enum", "key": "providerType", "elements": ["therapist", "place"], "required": true, "array": false},
            {"type": "string", "key": "providerId", "size": 255, "required": false, "array": false},
            {"type": "string", "key": "providerName", "size": 255, "required": true, "array": false},
            {"type": "datetime", "key": "visitDate", "required": true, "array": false},
            {"type": "float", "key": "locationLat", "required": true, "array": false},
            {"type": "float", "key": "locationLng", "required": true, "array": false},
            {"type": "string", "key": "locationAddress", "size": 1000, "required": true, "array": false},
            {"type": "datetime", "key": "locationTimestamp", "required": true, "array": false},
            {"type": "string", "key": "meetingNotes", "size": 5000, "required": true, "array": false},
            {"type": "datetime", "key": "callbackAt", "required": false, "array": false},
            {"type": "enum", "key": "membershipAgreed", "elements": ["none", "1month", "3month", "6month", "1year"], "required": true, "array": false},
            {"type": "enum", "key": "status", "elements": ["pending", "completed", "followup_required"], "required": true, "array": false},
            {"type": "datetime", "key": "createdAt", "required": true, "array": false},
            {"type": "datetime", "key": "updatedAt", "required": false, "array": false}
          ],
          "indexes": [
            {"key": "idx_agentId", "type": "key", "attributes": ["agentId"], "orders": ["ASC"]},
            {"key": "idx_visitDate", "type": "key", "attributes": ["visitDate"], "orders": ["DESC"]},
            {"key": "idx_status", "type": "key", "attributes": ["status"], "orders": ["ASC"]},
            {"key": "idx_membershipAgreed", "type": "key", "attributes": ["membershipAgreed"], "orders": ["ASC"]},
            {"key": "idx_providerType", "type": "key", "attributes": ["providerType"], "orders": ["ASC"]}
          ]
        },
        {
          "collectionId": "677a5d32001c8708c2a4",
          "name": "Monthly Agent Metrics",
          "enabled": true,
          "documentSecurity": true,
          "attributes": [
            {"type": "string", "key": "agentId", "size": 255, "required": true, "array": false},
            {"type": "string", "key": "agentCode", "size": 50, "required": true, "array": false},
            {"type": "string", "key": "month", "size": 7, "required": true, "array": false},
            {"type": "integer", "key": "newSignUpsCount", "required": true, "array": false},
            {"type": "integer", "key": "recurringSignUpsCount", "required": true, "array": false},
            {"type": "boolean", "key": "targetMet", "required": true, "array": false},
            {"type": "integer", "key": "streakCount", "required": true, "array": false},
            {"type": "float", "key": "commissionRateApplied", "required": true, "array": false},
            {"type": "datetime", "key": "calculatedAt", "required": true, "array": false}
          ],
          "indexes": [
            {"key": "idx_agent_month", "type": "key", "attributes": ["agentId", "month"], "orders": ["ASC", "ASC"]},
            {"key": "idx_month", "type": "key", "attributes": ["month"], "orders": ["DESC"]},
            {"key": "idx_targetMet", "type": "key", "attributes": ["targetMet"], "orders": ["ASC"]}
          ]
        },
        {
          "collectionId": "affiliate_clicks",
          "name": "Affiliate Clicks",
          "enabled": true,
          "documentSecurity": true,
          "attributes": [
            {"type": "string", "key": "affiliateCode", "size": 64, "required": true, "array": false},
            {"type": "string", "key": "path", "size": 512, "required": true, "array": false},
            {"type": "string", "key": "referrer", "size": 512, "required": false, "array": false},
            {"type": "string", "key": "userAgent", "size": 500, "required": false, "array": false},
            {"type": "datetime", "key": "createdAt", "required": true, "array": false}
          ],
          "indexes": [
            {"key": "idx_code_time", "type": "key", "attributes": ["affiliateCode", "createdAt"], "orders": ["ASC", "DESC"]},
            {"key": "idx_createdAt", "type": "key", "attributes": ["createdAt"], "orders": ["DESC"]}
          ]
        },
        {
          "collectionId": "affiliate_attributions",
          "name": "Affiliate Attributions",
          "enabled": true,
          "documentSecurity": true,
          "attributes": [
            {"type": "string", "key": "bookingId", "size": 100, "required": true, "array": false},
            {"type": "string", "key": "providerId", "size": 100, "required": true, "array": false},
            {"type": "string", "key": "providerName", "size": 255, "required": false, "array": false},
            {"type": "enum", "key": "providerType", "elements": ["therapist", "place"], "required": true, "array": false},
            {"type": "string", "key": "affiliateCode", "size": 64, "required": true, "array": false},
            {"type": "float", "key": "commissionRate", "required": true, "array": false},
            {"type": "float", "key": "commissionAmount", "required": true, "array": false},
            {"type": "enum", "key": "commissionStatus", "elements": ["pending", "approved", "paid"], "required": true, "array": false},
            {"type": "string", "key": "source", "size": 64, "required": false, "array": false},
            {"type": "string", "key": "venueId", "size": 100, "required": false, "array": false},
            {"type": "string", "key": "venueName", "size": 255, "required": false, "array": false},
            {"type": "string", "key": "venueType", "size": 20, "required": false, "array": false},
            {"type": "datetime", "key": "createdAt", "required": true, "array": false}
          ],
          "indexes": [
            {"key": "idx_code_time", "type": "key", "attributes": ["affiliateCode", "createdAt"], "orders": ["ASC", "DESC"]},
            {"key": "idx_provider_status", "type": "key", "attributes": ["providerId", "commissionStatus", "createdAt"], "orders": ["ASC", "ASC", "DESC"]},
            {"key": "idx_status_time", "type": "key", "attributes": ["commissionStatus", "createdAt"], "orders": ["ASC", "DESC"]}
          ]
        },
        {
          "collectionId": "677a5d0d0035b0f8a1e2",
          "name": "Bookings",
          "enabled": true,
          "documentSecurity": true,
          "attributes": [
            {"type": "string", "key": "bookingId", "size": 36, "required": true, "array": false},
            {"type": "datetime", "key": "bookingDate", "required": true, "array": false},
            {"type": "string", "key": "status", "size": 64, "required": false, "array": false, "default": "Pending"},
            {"type": "float", "key": "totalCost", "required": false, "array": false, "default": null, "min": 0},
            {"type": "string", "key": "paymentMethod", "size": 64, "required": false, "array": false, "default": "Unpaid"},
            {"type": "integer", "key": "duration", "required": false, "array": false, "default": 1, "min": 1, "max": 365},
            {"type": "string", "key": "providerId", "size": 255, "required": true, "array": false},
            {"type": "string", "key": "providerType", "size": 16, "required": true, "array": false},
            {"type": "string", "key": "providerName", "size": 255, "required": true, "array": false},
            {"type": "string", "key": "service", "size": 16, "required": true, "array": false},
            {"type": "datetime", "key": "startTime", "required": true, "array": false},
            {"type": "string", "key": "userId", "size": 32, "required": false, "array": false},
            {"type": "string", "key": "userName", "size": 255, "required": false, "array": false},
            {"type": "string", "key": "hotelId", "size": 32, "required": false, "array": false},
            {"type": "string", "key": "hotelGuestName", "size": 255, "required": false, "array": false},
            {"type": "string", "key": "hotelRoomNumber", "size": 16, "required": false, "array": false},
            {"type": "string", "key": "therapistId", "size": 255, "required": false, "array": false},
            {"type": "string", "key": "therapistName", "size": 255, "required": false, "array": false},
            {"type": "string", "key": "therapistType", "size": 50, "required": false, "array": false},
            {"type": "integer", "key": "price", "required": true, "array": false, "min": 0, "max": 1000},
            {"type": "datetime", "key": "createdAt", "required": true, "array": false},
            {"type": "datetime", "key": "responseDeadline", "required": true, "array": false},
            {"type": "datetime", "key": "scheduledTime", "required": false, "array": false},
            {"type": "string", "key": "customerName", "size": 255, "required": false, "array": false},
            {"type": "string", "key": "customerWhatsApp", "size": 50, "required": false, "array": false},
            {"type": "string", "key": "bookingType", "size": 50, "required": false, "array": false},
            {"type": "string", "key": "pending", "size": 255, "required": false, "array": false},
            {"type": "string", "key": "confirmed", "size": 255, "required": false, "array": false},
            {"type": "string", "key": "expired", "size": 255, "required": false, "array": false},
            {"type": "string", "key": "completed", "size": 255, "required": false, "array": false},
            {"type": "string", "key": "depositReference", "size": 120, "required": false, "array": false},
            {"type": "string", "key": "depositProofUrl", "size": 500, "required": false, "array": false},
            {"type": "enum", "key": "depositStatus", "elements": ["pending", "uploaded", "approved", "rejected"], "required": false, "array": false},
            {"type": "datetime", "key": "depositUploadedAt", "required": false, "array": false},
            {"type": "datetime", "key": "depositReviewedAt", "required": false, "array": false},
            {"type": "datetime", "key": "arrivalDetectedAt", "required": false, "array": false},
            {"type": "integer", "key": "arrivalDistanceMeters", "required": false, "array": false},
            {"type": "enum", "key": "arrivalDetectedBy", "elements": ["gps", "geofence", "beacon", "manual"], "required": false, "array": false},
            {"type": "float", "key": "customerLat", "required": false, "array": false},
            {"type": "float", "key": "customerLng", "required": false, "array": false},
            {"type": "float", "key": "therapistLat", "required": false, "array": false},
            {"type": "float", "key": "therapistLng", "required": false, "array": false},
            {"type": "boolean", "key": "offPlatformFlag", "required": false, "array": false},
            {"type": "datetime", "key": "$createdAt", "required": false, "array": false},
            {"type": "datetime", "key": "$updatedAt", "required": false, "array": false}
          ],
          "indexes": []
        },
        {
          "collectionId": "location_events",
          "name": "Location Events",
          "enabled": true,
          "documentSecurity": true,
          "attributes": [
            {"type": "string", "key": "eventId", "size": 64, "required": true, "array": false},
            {"type": "enum", "key": "eventType", "elements": ["arrival", "departure", "heartbeat", "geofence_enter", "geofence_exit"], "required": true, "array": false},
            {"type": "datetime", "key": "timestamp", "required": true, "array": false},
            {"type": "boolean", "key": "isEventActive", "required": true, "array": false},
            {"type": "string", "key": "description", "size": 255, "required": false, "array": false},
            {"type": "integer", "key": "attendanceCap", "required": false, "array": false, "min": 0, "max": 10000},
            {"type": "string", "key": "bookingId", "size": 100, "required": false, "array": false},
            {"type": "enum", "key": "actor", "elements": ["customer", "therapist", "system"], "required": true, "array": false},
            {"type": "float", "key": "lat", "required": true, "array": false},
            {"type": "float", "key": "lng", "required": true, "array": false},
            {"type": "float", "key": "accuracy", "required": false, "array": false},
            {"type": "enum", "key": "source", "elements": ["mobile", "web", "system"], "required": true, "array": false},
            {"type": "float", "key": "distanceToTarget", "required": false, "array": false},
            {"type": "boolean", "key": "withinRadius", "required": false, "array": false},
            {"type": "datetime", "key": "createdAt", "required": true, "array": false},
            {"type": "string", "key": "off_platform_flags", "size": 255, "required": false, "array": false},
            {"type": "string", "key": "userId", "size": 100, "required": false, "array": false},
            {"type": "string", "key": "therapistId", "size": 150, "required": false, "array": false},
            {"type": "datetime", "key": "firstSeenAt", "required": true, "array": false},
            {"type": "datetime", "key": "lastSeenAt", "required": true, "array": false},
            {"type": "float", "key": "minDistanceMeters", "required": true, "array": false},
            {"type": "string", "key": "evidence", "size": 150, "required": false, "array": false},
            {"type": "enum", "key": "status", "elements": ["pending", "validated", "flagged", "dismissed"], "required": true, "array": false},
            {"type": "datetime", "key": "$createdAt", "required": false, "array": false},
            {"type": "datetime", "key": "$updatedAt", "required": false, "array": false}
          ],
          "indexes": []
        },
        {
          "collectionId": "commission_records",
          "name": "Commission Records",
          "enabled": true,
          "documentSecurity": true,
          "attributes": [
            {"type": "string", "key": "commissionId", "size": 64, "required": true, "array": false},
            {"type": "float", "key": "amount", "required": true, "array": false, "min": 0},
            {"type": "datetime", "key": "paymentDate", "required": true, "array": false},
            {"type": "string", "key": "status", "size": 32, "required": true, "array": false},
            {"type": "string", "key": "paymentMethod", "size": 32, "required": true, "array": false},
            {"type": "string", "key": "note", "size": 256, "required": false, "array": false},
            {"type": "string", "key": "agentId", "size": 64, "required": false, "array": false},
            {"type": "integer", "key": "hotelVillaId", "required": true, "array": false},
            {"type": "integer", "key": "bookingId", "required": true, "array": false},
            {"type": "integer", "key": "providerId", "required": true, "array": false},
            {"type": "string", "key": "providerType", "size": 50, "required": true, "array": false},
            {"type": "string", "key": "providerName", "size": 255, "required": true, "array": false},
            {"type": "float", "key": "serviceAmount", "required": true, "array": false},
            {"type": "float", "key": "commissionRate", "required": true, "array": false},
            {"type": "float", "key": "commissionAmount", "required": true, "array": false},
            {"type": "string", "key": "paymentProofImage", "size": 500, "required": false, "array": false},
            {"type": "string", "key": "paymentProofUploadedAt", "size": 50, "required": false, "array": false},
            {"type": "integer", "key": "verifiedBy", "required": false, "array": false},
            {"type": "string", "key": "verifiedAt", "size": 50, "required": false, "array": false},
            {"type": "string", "key": "rejectionReason", "size": 500, "required": false, "array": false},
            {"type": "string", "key": "bookingDate", "size": 50, "required": true, "array": false},
            {"type": "string", "key": "paidDate", "size": 50, "required": false, "array": false},
            {"type": "string", "key": "createdAt", "size": 50, "required": true, "array": false},
            {"type": "string", "key": "updatedAt", "size": 50, "required": true, "array": false},
            {"type": "string", "key": "paymentReference", "size": 120, "required": false, "array": false},
            {"type": "datetime", "key": "$createdAt", "required": false, "array": false},
            {"type": "datetime", "key": "$updatedAt", "required": false, "array": false}
          ],
          "indexes": []
        }
      ]
    }
  ],
  "hosting": {
    "rules": [
      {
        "source": "/api/**",
        "target": "/api/index.js",
        "type": "rewrite"
      },
      {
        "source": "/**",
        "target": "/index.html",
        "type": "rewrite"
      }
    ]
  }
}