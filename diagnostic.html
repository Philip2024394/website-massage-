<!DOCTYPE html>
<html>
<head>
    <title>Location & Places Diagnostic</title>
    <style>
        body { font-family: Arial; padding: 20px; background: #f5f5f5; }
        .test { background: white; padding: 15px; margin: 10px 0; border-radius: 5px; }
        .pass { border-left: 5px solid #4CAF50; }
        .fail { border-left: 5px solid #f44336; }
        .warn { border-left: 5px solid #ff9800; }
        h2 { margin-top: 0; }
        pre { background: #f0f0f0; padding: 10px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>üîç Location & Places Diagnostic Tool</h1>
    
    <div id="results"></div>
    
    <script src="https://cdn.jsdelivr.net/npm/appwrite@14.0.1"></script>
    <script>
        const results = document.getElementById('results');
        
        function addResult(title, status, data) {
            const div = document.createElement('div');
            div.className = `test ${status}`;
            div.innerHTML = `
                <h2>${status === 'pass' ? '‚úÖ' : status === 'fail' ? '‚ùå' : '‚ö†Ô∏è'} ${title}</h2>
                <pre>${JSON.stringify(data, null, 2)}</pre>
            `;
            results.appendChild(div);
        }
        
        async function runTests() {
            // Test 1: Appwrite Connection
            try {
                const client = new Appwrite.Client()
                    .setEndpoint('https://syd.cloud.appwrite.io/v1')
                    .setProject('68f23b11000d25eb3664');
                    
                const databases = new Appwrite.Databases(client);
                
                addResult('Appwrite Connection', 'pass', { message: 'Connected successfully' });
                
                // Test 2: Fetch Cities
                try {
                    const cities = await databases.listDocuments('68f76ee1000e64ca8d05', 'cities_collection_id');
                    addResult('Cities Collection', 'pass', {
                        total: cities.documents.length,
                        cities: cities.documents.map(c => ({
                            name: c.cityName,
                            coordinates: c.coordinates,
                            isArray: Array.isArray(c.coordinates)
                        }))
                    });
                } catch (e) {
                    addResult('Cities Collection', 'fail', { error: e.message });
                }
                
                // Test 3: Fetch Places
                try {
                    const places = await databases.listDocuments('68f76ee1000e64ca8d05', 'places_collection_id');
                    const liveCount = places.documents.filter(p => p.isLive === true).length;
                    
                    addResult('Places Collection', places.documents.length > 0 && liveCount > 0 ? 'pass' : 'warn', {
                        total: places.documents.length,
                        live: liveCount,
                        places: places.documents.map(p => ({
                            name: p.name,
                            isLive: p.isLive,
                            isLiveType: typeof p.isLive,
                            coordinates: p.coordinates,
                            coordsType: typeof p.coordinates,
                            coordsIsArray: Array.isArray(p.coordinates),
                            location: p.location
                        }))
                    });
                } catch (e) {
                    addResult('Places Collection', 'fail', { error: e.message });
                }
                
                // Test 4: Google Maps API
                const googleMapsKey = localStorage.getItem('googleMapsApiKey');
                if (googleMapsKey) {
                    addResult('Google Maps API Key', 'pass', { keyLength: googleMapsKey.length, configured: true });
                } else {
                    addResult('Google Maps API Key', 'warn', { configured: false, message: 'No API key in localStorage' });
                }
                
                // Test 5: Google Maps Loaded
                if (window.google && window.google.maps) {
                    addResult('Google Maps Library', 'pass', { 
                        loaded: true,
                        places: !!window.google.maps.places,
                        geometry: !!window.google.maps.geometry
                    });
                } else {
                    addResult('Google Maps Library', 'warn', { loaded: false, message: 'Not loaded yet' });
                }
                
                // Test 6: Location Services
                if (navigator.geolocation) {
                    addResult('Browser Geolocation', 'pass', { available: true });
                } else {
                    addResult('Browser Geolocation', 'fail', { available: false });
                }
                
            } catch (e) {
                addResult('Appwrite Connection', 'fail', { error: e.message });
            }
        }
        
        runTests();
    </script>
</body>
</html>