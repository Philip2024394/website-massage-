<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Consistency Test - Live Cards vs Dashboard</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
        .container { max-width: 1000px; margin: 0 auto; background: white; padding: 20px; border-radius: 10px; }
        .test-section { background: #f8f9fa; padding: 15px; margin: 10px 0; border-radius: 5px; }
        .result { background: #e7f3ff; padding: 10px; margin: 10px 0; border-radius: 5px; border-left: 4px solid #007bff; }
        .success { background: #e6ffe6; padding: 10px; margin: 10px 0; border-radius: 5px; border-left: 4px solid #28a745; }
        .error { background: #ffe6e6; padding: 10px; margin: 10px 0; border-radius: 5px; border-left: 4px solid #dc3545; }
        button { background: #007bff; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; margin: 5px; }
        .comparison { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .card-data, .dashboard-data { padding: 15px; border: 2px solid #ddd; border-radius: 8px; }
        .card-data { border-color: #28a745; background: #f8fff8; }
        .dashboard-data { border-color: #007bff; background: #f8f9ff; }
        pre { white-space: pre-wrap; word-wrap: break-word; font-size: 12px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Data Consistency Test: Live Cards ‚Üî Dashboard</h1>
        <p><strong>Purpose:</strong> Verify that data displayed on live therapist cards matches the data on the dashboard profile page</p>
        
        <div class="test-section">
            <h3>Test Steps:</h3>
            <ol>
                <li>Load all therapists (same as live cards)</li>
                <li>Simulate dashboard data loading process</li>
                <li>Compare the data to ensure consistency</li>
            </ol>
            
            <button onclick="runDataConsistencyTest()">üß™ Run Data Consistency Test</button>
            <button onclick="clearResults()">üßπ Clear Results</button>
        </div>

        <div id="results"></div>
    </div>

    <script type="module">
        import { therapistService } from './lib/appwriteService.js';
        
        window.runDataConsistencyTest = async () => {
            log('üß™ Starting Data Consistency Test...', 'info');
            
            try {
                // Step 1: Get all therapists (same as live cards)
                log('1Ô∏è‚É£ Loading all therapists (Live Card Data Source)...', 'info');
                const allTherapists = await therapistService.getAll();
                log(`‚úÖ Found ${allTherapists.length} therapists`, 'success');
                
                if (allTherapists.length === 0) {
                    log('‚ùå No therapists found!', 'error');
                    return;
                }
                
                // Step 2: Test with phil4@gmail.com
                log('2Ô∏è‚É£ Testing with phil4@gmail.com...', 'info');
                const phil4Card = allTherapists.find(t => t.email === 'phil4@gmail.com');
                
                if (!phil4Card) {
                    log('‚ùå phil4@gmail.com not found in live card data!', 'error');
                    return;
                }
                
                log('‚úÖ Found phil4 in live card data', 'success');
                
                // Step 3: Simulate dashboard data loading
                log('3Ô∏è‚É£ Simulating dashboard data loading...', 'info');
                
                // Get current user (same as dashboard does)
                const currentUser = await therapistService.getCurrentUser();
                log(`Current user: ${currentUser?.email}`, 'result');
                
                // Get by email (same as dashboard does)
                const dashboardProfiles = await therapistService.getByEmail('phil4@gmail.com');
                log(`Dashboard profiles found: ${dashboardProfiles.length}`, 'result');
                
                const phil4Dashboard = dashboardProfiles[0];
                
                // Step 4: Compare the data
                log('4Ô∏è‚É£ Comparing Live Card Data vs Dashboard Data...', 'info');
                
                const comparison = {
                    liveCard: {
                        name: phil4Card.name,
                        description: phil4Card.description,
                        whatsappNumber: phil4Card.whatsappNumber,
                        location: phil4Card.location,
                        pricing: phil4Card.pricing,
                        status: phil4Card.status,
                        email: phil4Card.email,
                        id: phil4Card.$id || phil4Card.id
                    },
                    dashboard: {
                        name: phil4Dashboard?.name,
                        description: phil4Dashboard?.description,
                        whatsappNumber: phil4Dashboard?.whatsappNumber,
                        location: phil4Dashboard?.location,
                        pricing: phil4Dashboard?.pricing,
                        status: phil4Dashboard?.status,
                        email: phil4Dashboard?.email,
                        id: phil4Dashboard?.$id || phil4Dashboard?.id
                    }
                };
                
                // Display comparison
                const resultsDiv = document.getElementById('results');
                resultsDiv.innerHTML += `
                    <div class="comparison">
                        <div class="card-data">
                            <h3>üè† Live Card Data</h3>
                            <pre>${JSON.stringify(comparison.liveCard, null, 2)}</pre>
                        </div>
                        <div class="dashboard-data">
                            <h3>üìä Dashboard Data</h3>
                            <pre>${JSON.stringify(comparison.dashboard, null, 2)}</pre>
                        </div>
                    </div>
                `;
                
                // Check for differences
                const differences = [];
                Object.keys(comparison.liveCard).forEach(key => {
                    if (comparison.liveCard[key] !== comparison.dashboard[key]) {
                        differences.push({
                            field: key,
                            liveCard: comparison.liveCard[key],
                            dashboard: comparison.dashboard[key]
                        });
                    }
                });
                
                if (differences.length === 0) {
                    log('üéâ SUCCESS: Live Card data exactly matches Dashboard data!', 'success');
                    log('‚úÖ Confirmation: Data displayed on live cards WILL display on dashboard', 'success');
                } else {
                    log(`‚ö†Ô∏è Found ${differences.length} differences:`, 'error');
                    differences.forEach(diff => {
                        log(`   ${diff.field}: Card="${diff.liveCard}" vs Dashboard="${diff.dashboard}"`, 'error');
                    });
                }
                
            } catch (error) {
                log(`‚ùå Test failed: ${error.message}`, 'error');
                console.error('Full error:', error);
            }
        };

        window.clearResults = () => {
            document.getElementById('results').innerHTML = '';
        };

        function log(message, type = 'info') {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = type;
            div.innerHTML = `<pre>${message}</pre>`;
            results.appendChild(div);
        }
        
        window.log = log;
        
        // Auto-run on page load
        setTimeout(() => {
            log('üöÄ Data Consistency Test Ready. Click the button to verify that live card data matches dashboard data.', 'info');
        }, 500);
    </script>
</body>
</html>