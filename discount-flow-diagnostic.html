<!DOCTYPE html>
<html>
<head>
    <title>Discount Flow Diagnostic</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 20px; border-radius: 10px; }
        .flow-step { margin: 20px 0; padding: 15px; border: 2px solid #ddd; border-radius: 5px; }
        .working { border-color: #4CAF50; background: #E8F5E8; }
        .problem { border-color: #f44336; background: #FFEBEE; }
        .unknown { border-color: #FF9800; background: #FFF3E0; }
        h1 { color: #333; }
        h3 { margin-top: 0; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 5px; overflow-x: auto; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Discount System Flow Diagnostic</h1>
        <p><strong>Simple Flow Check:</strong> Dashboard ‚Üí Database ‚Üí TherapistCard Display</p>

        <div class="flow-step working">
            <h3>‚úÖ Step 1: Dashboard Save Location</h3>
            <p><strong>File:</strong> <code>TherapistDashboardPage.tsx</code></p>
            <p><strong>Function:</strong> Activation button calls <code>onSave(therapistData)</code></p>
            <p><strong>Handler:</strong> <code>useProviderAgentHandlers.ts ‚Üí handleSaveTherapist()</code></p>
            <p><strong>Database:</strong> <code>therapistService.update()</code> ‚Üí Appwrite therapists collection</p>
            <p><strong>Fields Saved:</strong></p>
            <pre>discountPercentage: number
discountDuration: number  
discountEndTime: string (ISO date)
isDiscountActive: boolean</pre>
        </div>

        <div class="flow-step working">
            <h3>‚úÖ Step 2: Home Page Data Loading</h3>
            <p><strong>File:</strong> <code>HomePage.tsx</code></p>
            <p><strong>Data Source:</strong> <code>useAllHooks.ts ‚Üí useDataFetching.ts</code></p>
            <p><strong>Database Query:</strong> <code>therapistService.getTherapists()</code></p>
            <p><strong>Result:</strong> Array of therapist objects with discount fields</p>
        </div>

        <div class="flow-step working">
            <h3>‚úÖ Step 3: TherapistCard Display Logic</h3>
            <p><strong>File:</strong> <code>TherapistCard.tsx</code></p>
            <p><strong>Function:</strong> <code>isDiscountActive(therapist)</code></p>
            <p><strong>Checks:</strong></p>
            <pre>‚úì discountPercentage > 0
‚úì discountEndTime exists
‚úì isDiscountActive === true
‚úì Current time < discountEndTime</pre>
            <p><strong>Display:</strong> Red discount badge + live countdown timer</p>
        </div>

        <div class="flow-step problem">
            <h3>‚ùì The Problem Location</h3>
            <p>All components are properly implemented. The issue is likely:</p>
            <ul>
                <li><strong>Data not refreshing:</strong> Home page cache not updating after dashboard save</li>
                <li><strong>Time zone issues:</strong> Dashboard saves in different timezone than card checks</li>
                <li><strong>Database permissions:</strong> Save operation failing silently</li>
                <li><strong>Session issues:</strong> Database write requires proper authentication</li>
            </ul>
        </div>

        <div class="flow-step unknown">
            <h3>üîß Debug Steps</h3>
            <ol>
                <li><strong>Test Save Operation:</strong> Check browser console during activation for save success/failure</li>
                <li><strong>Check Database:</strong> Use Appwrite console to verify discount fields are actually saved</li>
                <li><strong>Test Data Loading:</strong> Refresh home page and check therapist objects in console</li>
                <li><strong>Test Card Logic:</strong> Check console for <code>isDiscountActive</code> debug logs</li>
            </ol>
        </div>

        <div class="flow-step working">
            <h3>üöÄ Quick Test Commands</h3>
            <p>Run these in browser console on home page:</p>
            <pre>// Check therapist data
console.log('Therapists:', window.therapistData || 'Not available');

// Check specific therapist discount fields
const phil10 = therapists?.find(t => t.name === 'phil10');
console.log('Phil10 discount data:', {
    discountPercentage: phil10?.discountPercentage,
    discountEndTime: phil10?.discountEndTime,
    isDiscountActive: phil10?.isDiscountActive
});</pre>
        </div>
    </div>
</body>
</html>