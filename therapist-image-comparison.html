<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîç Therapist Image Comparison</title>
    <script src="https://cdn.jsdelivr.net/npm/appwrite@16.0.2/dist/umd/sdk.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%); 
            min-height: 100vh; 
            padding: 20px;
        }
        .container { 
            max-width: 1000px; 
            margin: 0 auto;
            background: white; 
            border-radius: 20px; 
            padding: 40px; 
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        h1 { 
            color: #333; 
            margin-bottom: 30px; 
            font-size: 2.2rem;
            text-align: center;
        }
        .success { 
            background: #e8f5e8; 
            border: 2px solid #4caf50; 
            padding: 20px; 
            border-radius: 10px; 
            margin: 20px 0; 
            color: #2e7d32;
        }
        .therapist-comparison {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .therapist-item {
            background: white;
            border: 2px solid #ddd;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .therapist-item.working {
            border-color: #4CAF50;
            background: #f8fff8;
        }
        .therapist-item.missing {
            border-color: #f44336;
            background: #fff8f8;
        }
        .profile-img {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid #4CAF50;
            margin-bottom: 15px;
        }
        .profile-img.error {
            border-color: #f44336;
        }
        .status-badge {
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
            margin-top: 10px;
        }
        .status-success { background: #e8f5e8; color: #2e7d32; }
        .status-error { background: #ffebee; color: #c62828; }
        button {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            border: none;
            color: white;
            padding: 15px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px;
            transition: all 0.3s ease;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }
        .url-display {
            background: #f1f3f4;
            padding: 10px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 11px;
            word-break: break-all;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Therapist Image Comparison</h1>
        
        <div class="success">
            <strong>üéâ Great News!</strong> Tata's profile image is working correctly!<br>
            This confirms the profile picture system is functioning properly.<br><br>
            <strong>Now let's compare all therapists to see what's different:</strong>
        </div>

        <button onclick="compareTherapists()">üîç Compare All Therapist Images</button>
        <button onclick="window.open('http://localhost:3000', '_blank')">üè† View Live Home Page</button>

        <div id="comparison-results"></div>
    </div>

    <script>
        async function compareTherapists() {
            try {
                console.log('üîç Comparing all therapist images...');

                // Initialize Appwrite
                const { Client, Databases } = Appwrite;
                const client = new Client();
                client
                    .setEndpoint('https://syd.cloud.appwrite.io/v1')
                    .setProject('68f23b11000d25eb3664');

                const databases = new Databases(client);

                // Get all therapists
                const response = await databases.listDocuments(
                    '68f23b11001c632c9c77',
                    'therapists_collection_id',
                    []
                );

                if (response.documents.length === 0) {
                    document.getElementById('comparison-results').innerHTML = `
                        <div class="error">No therapists found in database.</div>
                    `;
                    return;
                }

                console.log(`üìã Found ${response.documents.length} therapists`);

                let resultsHtml = `
                    <div style="margin: 30px 0;">
                        <h2>üë• Therapist Profile Images Analysis</h2>
                        <p>Comparing all ${response.documents.length} therapist profiles:</p>
                    </div>
                    <div class="therapist-comparison">
                `;

                let workingImages = 0;
                let tataFound = false;

                for (let therapist of response.documents) {
                    const hasImage = therapist.profilePicture && therapist.profilePicture.trim().length > 0;
                    const isAppwriteUrl = hasImage && therapist.profilePicture.includes('68f76bdd002387590584');
                    const isTata = therapist.name && therapist.name.toLowerCase().includes('tata');
                    
                    if (isTata) tataFound = true;
                    if (isAppwriteUrl) workingImages++;

                    const cardClass = isAppwriteUrl ? 'working' : 'missing';
                    const statusClass = isAppwriteUrl ? 'status-success' : 'status-error';
                    const statusText = isAppwriteUrl ? '‚úÖ Working Image' : hasImage ? '‚ö†Ô∏è Invalid URL' : '‚ùå No Image';

                    resultsHtml += `
                        <div class="therapist-item ${cardClass}">
                            <div style="text-align: center;">
                                ${hasImage ? 
                                    `<img src="${therapist.profilePicture}" class="profile-img ${isAppwriteUrl ? '' : 'error'}" 
                                         alt="${therapist.name}" 
                                         onload="console.log('‚úÖ Loaded:', '${therapist.name}')"
                                         onerror="console.log('‚ùå Failed:', '${therapist.name}'); this.style.display='none'; this.nextElementSibling.style.display='flex';">
                                     <div style="display: none; width: 80px; height: 80px; border-radius: 50%; background: #ddd; align-items: center; justify-content: center; font-size: 2rem; border: 3px solid #f44336; margin-bottom: 15px;">üë§</div>` :
                                    `<div style="width: 80px; height: 80px; border-radius: 50%; background: #ddd; display: flex; align-items: center; justify-content: center; font-size: 2rem; border: 3px solid #f44336; margin: 0 auto 15px;">üë§</div>`
                                }
                                
                                <h3 style="color: #333; margin-bottom: 5px;">
                                    ${therapist.name || 'Unnamed Therapist'}
                                    ${isTata ? ' üéØ' : ''}
                                </h3>
                                
                                <div class="status-badge ${statusClass}">
                                    ${statusText}
                                </div>
                                
                                ${isTata ? '<div style="background: #fff3e0; color: #e65100; padding: 8px; border-radius: 8px; margin-top: 10px; font-size: 12px; font-weight: bold;">üéâ This is the working one!</div>' : ''}
                                
                                ${hasImage ? `
                                    <div class="url-display">
                                        <strong>Image URL:</strong><br>
                                        ${therapist.profilePicture}
                                        <br><br>
                                        <strong>Bucket Match:</strong> ${isAppwriteUrl ? '‚úÖ Yes' : '‚ùå No'}<br>
                                        <strong>URL Format:</strong> ${therapist.profilePicture.startsWith('https://') ? '‚úÖ HTTPS' : '‚ùå Invalid'}
                                    </div>
                                ` : ''}
                            </div>
                        </div>
                    `;
                }

                resultsHtml += `</div>`;

                // Add summary
                resultsHtml += `
                    <div style="margin: 30px 0; padding: 20px; background: #f8f9fa; border-radius: 10px;">
                        <h3>üìä Summary:</h3>
                        <p><strong>Total Therapists:</strong> ${response.documents.length}</p>
                        <p><strong>Working Images:</strong> ${workingImages}</p>
                        <p><strong>Missing Images:</strong> ${response.documents.length - workingImages}</p>
                        <p><strong>Tata Found:</strong> ${tataFound ? '‚úÖ Yes (working correctly!)' : '‚ùå Not found'}</p>
                        
                        <div style="margin-top: 15px; padding: 15px; background: ${workingImages === response.documents.length ? '#e8f5e8' : '#fff3e0'}; border-radius: 8px;">
                            ${workingImages === response.documents.length ? 
                                '<strong>üéâ Perfect! All therapists have working profile images.</strong>' :
                                workingImages > 0 ?
                                `<strong>‚úÖ Partially Working:</strong> ${workingImages} out of ${response.documents.length} therapists have profile images.<br>
                                 <strong>üìù Action needed:</strong> Upload profile pictures for the remaining ${response.documents.length - workingImages} therapists in their dashboard.` :
                                '<strong>‚ö†Ô∏è Only Tata is working:</strong> Other therapists need to upload profile pictures via their dashboard.'
                            }
                        </div>
                    </div>
                `;

                document.getElementById('comparison-results').innerHTML = resultsHtml;

                console.log(`‚úÖ Analysis complete: ${workingImages}/${response.documents.length} working images`);

            } catch (error) {
                console.error('‚ùå Comparison failed:', error);
                document.getElementById('comparison-results').innerHTML = `
                    <div style="background: #ffebee; border: 2px solid #f44336; padding: 20px; border-radius: 10px; color: #c62828;">
                        <strong>‚ùå Failed to compare therapist images:</strong><br>
                        ${error.message}
                    </div>
                `;
            }
        }

        // Auto-run comparison
        window.addEventListener('load', () => {
            setTimeout(compareTherapists, 1000);
        });
    </script>
</body>
</html>