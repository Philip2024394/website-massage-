#!/bin/bash
# üõ°Ô∏è ELITE FILE NAMING PRE-COMMIT HOOK
# Prevents commits with non-compliant file names

echo "üõ°Ô∏è Enforcing elite file naming standards..."

# Elite naming pattern: Domain.Feature.Layer.Component.Version.tsx
ELITE_PATTERN="^[A-Z][a-zA-Z]*Domain\.[A-Z][a-zA-Z]*\.(Presentation|Application|Domain|Infrastructure)\.(Page|Component|Service|Entity)\.v[0-9]+\.tsx$"

# Legacy acceptable patterns (temporary)
LEGACY_PATTERN="^[A-Z][a-zA-Z]*(Page|Component)\.tsx$"

# Get list of staged .tsx files
STAGED_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep -E "\.(tsx|ts)$")

VIOLATIONS_FOUND=false

for file in $STAGED_FILES; do
    filename=$(basename "$file")
    
    # Skip non-component files
    if [[ $filename =~ \.(test|spec|config|d)\.ts(x)?$ ]]; then
        continue
    fi
    
    # Check elite pattern
    if [[ $filename =~ $ELITE_PATTERN ]]; then
        echo "‚úÖ Elite standard: $filename"
        continue
    fi
    
    # Check legacy pattern (temporary allowance)
    if [[ $filename =~ $LEGACY_PATTERN ]]; then
        echo "‚ö†Ô∏è  Legacy acceptable: $filename (consider upgrading to elite)"
        continue
    fi
    
    # Violation found
    echo "‚ùå VIOLATION: $filename"
    echo "   Must follow: Domain.Feature.Layer.Component.Version.tsx"
    echo "   Example: TherapistDomain.Dashboard.Presentation.Page.v1.tsx"
    VIOLATIONS_FOUND=true
done

if [ "$VIOLATIONS_FOUND" = true ]; then
    echo ""
    echo "üö® COMMIT BLOCKED: File naming violations found!"
    echo ""
    echo "üéØ ELITE NAMING STANDARDS:"
    echo "   ‚úÖ TherapistDomain.Dashboard.Presentation.Page.v1.tsx"
    echo "   ‚úÖ CustomerDomain.Booking.Application.Service.v1.tsx"
    echo "   ‚úÖ PlatformDomain.Error.Infrastructure.Component.v1.tsx"
    echo ""
    echo "üìö Run: node scripts/implement-elite-structure.mjs"
    echo "    To automatically transform your files to elite standards"
    echo ""
    exit 1
fi

echo "üèÜ All files comply with elite naming standards!"
exit 0